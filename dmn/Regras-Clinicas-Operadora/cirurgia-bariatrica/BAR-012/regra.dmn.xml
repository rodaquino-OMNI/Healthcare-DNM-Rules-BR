<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"
             xmlns:camunda="http://camunda.org/schema/1.0/dmn"
             id="Definitions_BAR012"
             name="Colecistectomia Pos-Bariatrica"
             namespace="http://camunda.org/schema/1.0/dmn">

  <!--
    ===============================================================================
    TUSS: BAR-012
    Procedimento: Colecistectomia Pos-Cirurgia Bariatrica
    Especialidade: Cirurgia Bariatrica / Cirurgia Geral
    Versao: 3.0.0-TIER1
    Data: 2026-02-07
    ===============================================================================

    INDICACOES CLINICAS (SBCBM 2022, SAGES 2020):
    - Colelitíase sintomática pos-perda ponderal rapida
    - Colecistite aguda
    - Coledocolitiase
    - Pancreatite biliar
    - Colelitiase assintomática com alto risco (em alguns protocolos)

    INCIDENCIA:
    - 30-50% desenvolvem colelitiase no primeiro ano pos-bariatrica
    - Perda rapida de peso e o principal fator de risco

    REFERENCIAS TECNICAS:
    - SBCBM 2022 - Complicacoes Biliares Pos-Bariatrica
    - SAGES Guidelines for Cholecystectomy 2020
    - ASMBS 2019 - Gallstone Prevention

    ===============================================================================
  -->

  <decision id="Decision_BAR012" name="Regra Clinica - Colecistectomia Pos-Bariatrica">
    <decisionTable id="DecisionTable_BAR012" hitPolicy="FIRST">

      <!-- ========== INPUTS (5) ========== -->

      <input id="Input_apresentacaoBiliar" label="Apresentacao Biliar" camunda:inputVariable="apresentacaoBiliar">
        <inputExpression id="InputExpression_apresentacaoBiliar" typeRef="string">
          <text>apresentacaoBiliar</text>
        </inputExpression>
        <inputValues id="InputValues_apresentacaoBiliar">
          <text>"ColecistiteAguda","Coledocolitiase","PancreatiteBiliar","ColicaBiliar","ColelitíaseAssintomática"</text>
        </inputValues>
      </input>

      <input id="Input_tempoPosCirurgiaBariatrica" label="Tempo Pos-Bariatrica (meses)" camunda:inputVariable="tempoPosCirurgiaBariatrica">
        <inputExpression id="InputExpression_tempoPosCirurgiaBariatrica" typeRef="number">
          <text>tempoPosCirurgiaBariatrica</text>
        </inputExpression>
      </input>

      <input id="Input_confirmacaoImagem" label="Confirmacao por Imagem" camunda:inputVariable="confirmacaoImagem">
        <inputExpression id="InputExpression_confirmacaoImagem" typeRef="string">
          <text>confirmacaoImagem</text>
        </inputExpression>
        <inputValues id="InputValues_confirmacaoImagem">
          <text>"Confirmado","Suspeito","NaoRealizado"</text>
        </inputValues>
      </input>

      <input id="Input_riscoCirurgico" label="Risco Cirurgico (ASA)" camunda:inputVariable="riscoCirurgico">
        <inputExpression id="InputExpression_riscoCirurgico" typeRef="string">
          <text>riscoCirurgico</text>
        </inputExpression>
        <inputValues id="InputValues_riscoCirurgico">
          <text>"ASA I","ASA II","ASA III","ASA IV"</text>
        </inputValues>
      </input>

      <input id="Input_colecistectomiaPrevia" label="Colecistectomia Previa ao Bypass" camunda:inputVariable="colecistectomiaPrevia">
        <inputExpression id="InputExpression_colecistectomiaPrevia" typeRef="boolean">
          <text>colecistectomiaPrevia</text>
        </inputExpression>
      </input>

      <!-- ========== OUTPUTS (3 - Padrao TIER-1) ========== -->

      <output id="Output_resultado" label="Resultado" name="resultado" typeRef="string">
        <outputValues id="OutputValues_resultado">
          <text>"Aprovado","Reprovado","Pendente"</text>
        </outputValues>
      </output>

      <output id="Output_observacao" label="Observacao Clinica" name="observacao" typeRef="string" />

      <output id="Output_fundamentacao" label="Fundamentacao Tecnica" name="fundamentacao" typeRef="string" />

      <!-- Output 4: Alertas Desperdicio -->
      <output id="Output_alertasDesperdicio" label="Alertas de Desperdicio" name="alertasDesperdicio" typeRef="string">
        <outputValues id="OutputValues_alertasDesperdicio">
          <text>"NENHUM","DUP","FREQ","ESC","DOC","PROT","MULTI"</text>
        </outputValues>
      </output>

      <!-- Output 5: Acao Recomendada -->
      <output id="Output_acaoRecomendada" label="Acao Recomendada" name="acaoRecomendada" typeRef="string">
        <outputValues id="OutputValues_acaoRecomendada">
          <text>"APROVAR","NEGAR","SOLICITAR_INFO","AGUARDAR_PRAZO","SUGERIR_ALTERNATIVA"</text>
        </outputValues>
      </output>

      <!-- ========== RULES ========== -->

      <!-- CONTRAINDICACAO - JA COLECISTECTOMIZADO -->
      <rule id="Rule_Contraind_JaColecistectomizado">
        <description>Contraindicacao: Paciente ja colecistectomizado</description>
        <inputEntry id="InputEntry_JC_1"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_JC_2"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_JC_3"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_JC_4"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_JC_5"><text>true</text></inputEntry>
        <outputEntry id="OutputEntry_JC_resultado"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OutputEntry_JC_observacao"><text>"Paciente ja submetido a colecistectomia previa - procedimento nao aplicavel"</text></outputEntry>
        <outputEntry id="OutputEntry_JC_fundamentacao"><text>"Ausencia de vesicula biliar - investigar outras causas de dor abdominal"</text></outputEntry>
      <outputEntry id="OE_Contraind_JaColecistectomizado_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_Contraind_JaColecistectomizado_5"><text>"NEGAR"</text></outputEntry>
      </rule>

      <!-- APROVACOES EMERGENCIAIS -->
      <rule id="Rule_Aprovado_ColecistiteAguda">
        <description>Aprovado Urgente: Colecistite aguda</description>
        <inputEntry id="InputEntry_CA_1"><text>"ColecistiteAguda"</text></inputEntry>
        <inputEntry id="InputEntry_CA_2"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_CA_3"><text>"Confirmado"</text></inputEntry>
        <inputEntry id="InputEntry_CA_4"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_CA_5"><text>false</text></inputEntry>
        <outputEntry id="OutputEntry_CA_resultado"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OutputEntry_CA_observacao"><text>"Colecistite aguda - colecistectomia laparoscopica precoce em ate 72h"</text></outputEntry>
        <outputEntry id="OutputEntry_CA_fundamentacao"><text>"SAGES 2020, Tokyo Guidelines 2018 - Colecistectomia precoce e padrao-ouro para colecistite aguda"</text></outputEntry>
      <outputEntry id="OE_Aprovado_ColecistiteAguda_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Aprovado_ColecistiteAguda_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <rule id="Rule_Aprovado_PancreatiteBiliar">
        <description>Aprovado Urgente: Pancreatite biliar</description>
        <inputEntry id="InputEntry_PB_1"><text>"PancreatiteBiliar"</text></inputEntry>
        <inputEntry id="InputEntry_PB_2"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_PB_3"><text>"Confirmado"</text></inputEntry>
        <inputEntry id="InputEntry_PB_4"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_PB_5"><text>false</text></inputEntry>
        <outputEntry id="OutputEntry_PB_resultado"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OutputEntry_PB_observacao"><text>"Pancreatite biliar - colecistectomia na mesma internacao apos melhora clinica"</text></outputEntry>
        <outputEntry id="OutputEntry_PB_fundamentacao"><text>"SAGES 2020 - Colecistectomia indice previne recorrencia de pancreatite biliar"</text></outputEntry>
      <outputEntry id="OE_Aprovado_PancreatiteBiliar_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Aprovado_PancreatiteBiliar_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <rule id="Rule_Aprovado_Coledocolitiase">
        <description>Aprovado: Coledocolitiase</description>
        <inputEntry id="InputEntry_CL_1"><text>"Coledocolitiase"</text></inputEntry>
        <inputEntry id="InputEntry_CL_2"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_CL_3"><text>"Confirmado"</text></inputEntry>
        <inputEntry id="InputEntry_CL_4"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_CL_5"><text>false</text></inputEntry>
        <outputEntry id="OutputEntry_CL_resultado"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OutputEntry_CL_observacao"><text>"Coledocolitiase - CPRE seguida de colecistectomia ou exploracao laparoscopica"</text></outputEntry>
        <outputEntry id="OutputEntry_CL_fundamentacao"><text>"SAGES 2020 - Tratamento da coledocolitiase seguido de colecistectomia"</text></outputEntry>
      <outputEntry id="OE_Aprovado_Coledocolitiase_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Aprovado_Coledocolitiase_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <!-- APROVACOES ELETIVAS -->
      <rule id="Rule_Aprovado_ColicaSintomatica">
        <description>Aprovado: Colica biliar sintomatica recorrente</description>
        <inputEntry id="InputEntry_CS_1"><text>"ColicaBiliar"</text></inputEntry>
        <inputEntry id="InputEntry_CS_2"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_CS_3"><text>"Confirmado"</text></inputEntry>
        <inputEntry id="InputEntry_CS_4"><text>"ASA I","ASA II","ASA III"</text></inputEntry>
        <inputEntry id="InputEntry_CS_5"><text>false</text></inputEntry>
        <outputEntry id="OutputEntry_CS_resultado"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OutputEntry_CS_observacao"><text>"Colelitiase sintomatica com colica biliar - indicacao de colecistectomia eletiva"</text></outputEntry>
        <outputEntry id="OutputEntry_CS_fundamentacao"><text>"SAGES 2020, SBCBM 2022 - Colelitiase sintomatica tem indicacao de colecistectomia eletiva"</text></outputEntry>
      <outputEntry id="OE_Aprovado_ColicaSintomatica_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Aprovado_ColicaSintomatica_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <rule id="Rule_Aprovado_AssintomáticaPrimeirAno">
        <description>Aprovado: Colelitiase assintomatica no primeiro ano (alto risco)</description>
        <inputEntry id="InputEntry_AA_1"><text>"ColelitíaseAssintomática"</text></inputEntry>
        <inputEntry id="InputEntry_AA_2"><text>&lt;= 12</text></inputEntry>
        <inputEntry id="InputEntry_AA_3"><text>"Confirmado"</text></inputEntry>
        <inputEntry id="InputEntry_AA_4"><text>"ASA I","ASA II"</text></inputEntry>
        <inputEntry id="InputEntry_AA_5"><text>false</text></inputEntry>
        <outputEntry id="OutputEntry_AA_resultado"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OutputEntry_AA_observacao"><text>"Colelitiase no primeiro ano pos-bariatrica - alto risco de sintomas, colecistectomia preventiva"</text></outputEntry>
        <outputEntry id="OutputEntry_AA_fundamentacao"><text>"SBCBM 2022, ASMBS 2019 - 30-50% tornam-se sintomáticos - alguns protocolos indicam colecistectomia preventiva"</text></outputEntry>
      <outputEntry id="OE_Aprovado_AssintomáticaPrimeirAno_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Aprovado_AssintomáticaPrimeirAno_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <!-- REPROVACOES -->
      <rule id="Rule_Reprovado_AssintomáticaTardia">
        <description>Reprovado: Colelitiase assintomática tardia</description>
        <inputEntry id="InputEntry_AT_1"><text>"ColelitíaseAssintomática"</text></inputEntry>
        <inputEntry id="InputEntry_AT_2"><text>&gt; 24</text></inputEntry>
        <inputEntry id="InputEntry_AT_3"><text>"Confirmado"</text></inputEntry>
        <inputEntry id="InputEntry_AT_4"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_AT_5"><text>false</text></inputEntry>
        <outputEntry id="OutputEntry_AT_resultado"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OutputEntry_AT_observacao"><text>"Colelitiase assintomatica tardia - observacao clinica, sem indicacao cirurgica profilatica"</text></outputEntry>
        <outputEntry id="OutputEntry_AT_fundamentacao"><text>"SAGES 2020 - Colelitiase assintomatica tardia e estavel nao tem indicacao de colecistectomia profilatica"</text></outputEntry>
      <outputEntry id="OE_Reprovado_AssintomáticaTardia_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_Reprovado_AssintomáticaTardia_5"><text>"NEGAR"</text></outputEntry>
      </rule>

      <rule id="Rule_Reprovado_ASAAlto">
        <description>Reprovado: Risco cirurgico muito elevado para eletiva</description>
        <inputEntry id="InputEntry_RA_1"><text>"ColicaBiliar","ColelitíaseAssintomática"</text></inputEntry>
        <inputEntry id="InputEntry_RA_2"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_RA_3"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_RA_4"><text>"ASA IV"</text></inputEntry>
        <inputEntry id="InputEntry_RA_5"><text>false</text></inputEntry>
        <outputEntry id="OutputEntry_RA_resultado"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OutputEntry_RA_observacao"><text>"Risco cirurgico ASA IV - otimizar comorbidades antes de cirurgia eletiva"</text></outputEntry>
        <outputEntry id="OutputEntry_RA_fundamentacao"><text>"SAGES 2020 - Risco-beneficio desfavoravel para colecistectomia eletiva em ASA IV"</text></outputEntry>
      <outputEntry id="OE_Reprovado_ASAAlto_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_Reprovado_ASAAlto_5"><text>"NEGAR"</text></outputEntry>
      </rule>

      <!-- PENDENTE -->
      <rule id="Rule_Pendente_ImagemNaoRealizada">
        <description>Pendente: Imagem nao realizada</description>
        <inputEntry id="InputEntry_IN_1"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_IN_2"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_IN_3"><text>"NaoRealizado"</text></inputEntry>
        <inputEntry id="InputEntry_IN_4"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_IN_5"><text>false</text></inputEntry>
        <outputEntry id="OutputEntry_IN_resultado"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OutputEntry_IN_observacao"><text>"Realizar ultrassonografia abdominal para confirmar colelitiase"</text></outputEntry>
        <outputEntry id="OutputEntry_IN_fundamentacao"><text>"SAGES 2020 - Confirmacao de colelitiase por imagem e obrigatoria antes de indicar colecistectomia"</text></outputEntry>
      <outputEntry id="OE_Pendente_ImagemNaoRealizada_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Pendente_ImagemNaoRealizada_5"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

      <!-- FALLBACK RULE -->
      <rule id="Rule_Fallback_BAR012">
        <description>Regra padrao - Analise adicional necessaria</description>
        <inputEntry id="InputEntry_Fallback_1"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_Fallback_2"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_Fallback_3"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_Fallback_4"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_Fallback_5"><text>-</text></inputEntry>
        <outputEntry id="OutputEntry_Fallback_resultado"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OutputEntry_Fallback_observacao"><text>"Avaliar indicacao especifica com equipe de cirurgia geral/bariatrica"</text></outputEntry>
        <outputEntry id="OutputEntry_Fallback_fundamentacao"><text>"SAGES 2020, SBCBM 2022 - Decisao individualizada para casos complexos"</text></outputEntry>
      <outputEntry id="OE_Fallback_BAR012_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Fallback_BAR012_5"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

    </decisionTable>
  </decision>
</definitions>
