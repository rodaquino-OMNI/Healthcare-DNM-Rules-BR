<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"
             xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/"
             xmlns:dc="http://www.omg.org/spec/DD/20100524/DC/"
             xmlns:di="http://www.omg.org/spec/DD/20100524/DI/"
             id="Definitions_GEN_COL_010"
             name="Polipectomia Falha - Encaminhamento Cirurgico"
             namespace="http://camunda.org/schema/1.0/dmn"
             exporter="Camunda Modeler"
             exporterVersion="5.0.0">
  <!--
    GEN-COL-010 - Polipectomia Endoscopica Falha - Criterios para Cirurgia
    Versao: 1.0.0 (2026-02-07)
    Especialidade: Cirurgia Geral - Coloproctologia
    Categoria: Procedimentos Cirurgicos

    Indicacoes para Referencia Cirurgica (ESGE/ASGE):
    - Polipo nao ressecavel endoscopicamente
    - Suspeita de invasao submucosa profunda
    - Perfuracao durante polipectomia
    - Sangramento incontrolavel
    - Histologia desfavoravel pos-polipectomia

    Fatores de Ressecabilidade Endoscopica:
    - Tamanho >2cm (controverso, depende da experiencia)
    - Morfologia: LST-NG, Paris 0-Is, invasao profunda
    - Localizacao: Proxima a valvula ileocecal, angulacoes
    - Non-lifting sign positivo

    Criterios de Alto Risco para Invasao (JSCCR):
    - Depressao central
    - Ulceracao
    - Convergencia de pregas
    - Consistencia firme
    - Non-lifting sign

    Histologia Pos-Polipectomia Desfavoravel:
    - Margem comprometida
    - Invasao sm3 (>1000um)
    - Invasao linfovascular
    - Budding tumoral grau 3
    - Diferenciacao pobre

    Documentacao Obrigatoria:
    - Laudo de colonoscopia com tentativa de resseccao
    - Histopatologico (se resseccao parcial)
    - Justificativa da impossibilidade endoscopica

    Referencias Normativas:
    - ESGE Guidelines Colorectal Polypectomy 2021
    - ASGE/NCCN Polyp Management 2020
    - JSCCR Guidelines Colorectal Cancer 2019
  -->

  <decision id="Decision_GEN_COL_010" name="Criterios de Autorizacao - Polipo Nao Ressecavel">
    <decisionTable id="DecisionTable_GEN_COL_010" hitPolicy="FIRST">

      <!-- Input 1: Motivo do Encaminhamento -->
      <input id="Input_motivo" label="Motivo do Encaminhamento Cirurgico">
        <inputExpression id="InputExpr_motivo" typeRef="string">
          <text>motivoEncaminhamento</text>
        </inputExpression>
        <inputValues id="InputValues_motivo">
          <text>"Nao_Ressecavel_Endoscopicamente","Perfuracao","Sangramento","Histologia_Desfavoravel","Suspeita_Invasao"</text>
        </inputValues>
      </input>

      <!-- Input 2: Tentativa de Resseccao Endoscopica -->
      <input id="Input_tentativaEndo" label="Tentativa de Resseccao Endoscopica">
        <inputExpression id="InputExpr_tentativaEndo" typeRef="string">
          <text>tentativaResseccaoEndo</text>
        </inputExpression>
        <inputValues id="InputValues_tentativaEndo">
          <text>"Tentada_Falhou","Nao_Tentada_Alto_Risco","Resseccao_Parcial","Centro_Referencia_Indicou_Cirurgia"</text>
        </inputValues>
      </input>

      <!-- Input 3: Laudo de Colonoscopia -->
      <input id="Input_laudoColono" label="Laudo de Colonoscopia Documentado">
        <inputExpression id="InputExpr_laudoColono" typeRef="boolean">
          <text>laudoColonoscopiaDocumentado</text>
        </inputExpression>
      </input>

      <!-- Input 4: Histopatologico -->
      <input id="Input_histopatologico" label="Histopatologico Disponivel">
        <inputExpression id="InputExpr_histopatologico" typeRef="string">
          <text>histopatologico</text>
        </inputExpression>
        <inputValues id="InputValues_histopatologico">
          <text>"Benigno","Displasia_Alto_Grau","Carcinoma_Invasivo","Nao_Disponivel"</text>
        </inputValues>
      </input>

      <!-- Input 5: Laudo de Indicacao -->
      <input id="Input_laudoIndicacao" label="Laudo de Indicacao">
        <inputExpression id="InputExpr_laudoIndicacao" typeRef="boolean">
          <text>laudoIndicacao</text>
        </inputExpression>
      </input>

      <!-- Output 1: Resultado -->
      <output id="Output_resultado" label="Resultado" name="resultado" typeRef="string">
        <outputValues id="OutputValues_resultado">
          <text>"Aprovado","Reprovado","Pendente"</text>
        </outputValues>
      </output>

      <!-- Output 2: Observacao -->
      <output id="Output_observacao" label="Observacao Clinica" name="observacao" typeRef="string" />

      <!-- Output 3: Fundamentacao -->
      <output id="Output_fundamentacao" label="Fundamentacao" name="fundamentacao" typeRef="string" />

      <!-- Output 4: Alertas Desperdicio -->
      <output id="Output_alertasDesperdicio" label="Alertas de Desperdicio" name="alertasDesperdicio" typeRef="string">
        <outputValues id="OutputValues_alertasDesperdicio">
          <text>"NENHUM","DUP","FREQ","ESC","DOC","PROT","MULTI"</text>
        </outputValues>
      </output>

      <!-- Output 5: Acao Recomendada -->
      <output id="Output_acaoRecomendada" label="Acao Recomendada" name="acaoRecomendada" typeRef="string">
        <outputValues id="OutputValues_acaoRecomendada">
          <text>"APROVAR","NEGAR","SOLICITAR_INFO","AGUARDAR_PRAZO","SUGERIR_ALTERNATIVA"</text>
        </outputValues>
      </output>

      <!-- REGRAS DE REPROVACAO -->

      <rule id="Rule_GEN_COL_010_Reprovado_SemTentativa">
        <description>Reprovado - Cirurgia sem tentativa endoscopica</description>
        <inputEntry id="IE_Rep1_1"><text>"Nao_Ressecavel_Endoscopicamente"</text></inputEntry>
        <inputEntry id="IE_Rep1_2"><text>"Nao_Tentada_Alto_Risco"</text></inputEntry>
        <inputEntry id="IE_Rep1_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep1_4"><text>"Benigno"</text></inputEntry>
        <inputEntry id="IE_Rep1_5"><text>-</text></inputEntry>
        <outputEntry id="OE_Rep1_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_Rep1_2"><text>"Polipo benigno deve ter tentativa de resseccao endoscopica antes de cirurgia. Encaminhar para centro de referencia em polipectomia complexa."</text></outputEntry>
        <outputEntry id="OE_Rep1_3"><text>"ESGE 2021 - Endoscopic Attempt Required"</text></outputEntry>
      <outputEntry id="OE_GEN_COL_010_Reprovado_SemTentativa_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_GEN_COL_010_Reprovado_SemTentativa_5"><text>"NEGAR"</text></outputEntry>
      </rule>

      <rule id="Rule_GEN_COL_010_Reprovado_SemLaudoColono">
        <description>Reprovado - Sem laudo de colonoscopia</description>
        <inputEntry id="IE_Rep2_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep2_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep2_3"><text>false</text></inputEntry>
        <inputEntry id="IE_Rep2_4"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep2_5"><text>-</text></inputEntry>
        <outputEntry id="OE_Rep2_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_Rep2_2"><text>"Laudo de colonoscopia obrigatorio documentando caracteristicas do polipo, localizacao, tentativa de resseccao e motivo da falha."</text></outputEntry>
        <outputEntry id="OE_Rep2_3"><text>"ESGE 2021 - Colonoscopy Documentation"</text></outputEntry>
      <outputEntry id="OE_GEN_COL_010_Reprovado_SemLaudoColono_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_GEN_COL_010_Reprovado_SemLaudoColono_5"><text>"NEGAR"</text></outputEntry>
      </rule>

      <rule id="Rule_GEN_COL_010_Reprovado_SemLaudo">
        <description>Reprovado - Sem laudo de indicacao</description>
        <inputEntry id="IE_Rep3_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep3_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep3_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep3_4"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep3_5"><text>false</text></inputEntry>
        <outputEntry id="OE_Rep3_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_Rep3_2"><text>"Laudo de indicacao cirurgica obrigatorio com justificativa da impossibilidade de resseccao endoscopica."</text></outputEntry>
        <outputEntry id="OE_Rep3_3"><text>"RN 465/2021 - Documentacao Obrigatoria"</text></outputEntry>
      <outputEntry id="OE_GEN_COL_010_Reprovado_SemLaudo_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_GEN_COL_010_Reprovado_SemLaudo_5"><text>"NEGAR"</text></outputEntry>
      </rule>

      <!-- REGRAS DE APROVACAO -->

      <rule id="Rule_GEN_COL_010_Aprovado_Urgencia">
        <description>Aprovado - Complicacao de polipectomia (urgencia)</description>
        <inputEntry id="IE_Apr1_1"><text>"Perfuracao","Sangramento"</text></inputEntry>
        <inputEntry id="IE_Apr1_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Apr1_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Apr1_4"><text>-</text></inputEntry>
        <inputEntry id="IE_Apr1_5"><text>-</text></inputEntry>
        <outputEntry id="OE_Apr1_1"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OE_Apr1_2"><text>"URGENCIA - Complicacao de polipectomia (perfuracao/sangramento incontrolavel). Cirurgia de urgencia indicada para controle."</text></outputEntry>
        <outputEntry id="OE_Apr1_3"><text>"ESGE 2021 - Polypectomy Complication"</text></outputEntry>
      <outputEntry id="OE_GEN_COL_010_Aprovado_Urgencia_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_GEN_COL_010_Aprovado_Urgencia_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <rule id="Rule_GEN_COL_010_Aprovado_Carcinoma">
        <description>Aprovado - Carcinoma invasivo em histopatologico</description>
        <inputEntry id="IE_Apr2_1"><text>"Histologia_Desfavoravel"</text></inputEntry>
        <inputEntry id="IE_Apr2_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Apr2_3"><text>true</text></inputEntry>
        <inputEntry id="IE_Apr2_4"><text>"Carcinoma_Invasivo"</text></inputEntry>
        <inputEntry id="IE_Apr2_5"><text>true</text></inputEntry>
        <outputEntry id="OE_Apr2_1"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OE_Apr2_2"><text>"Carcinoma invasivo em polipo (pos-polipectomia com criterios desfavoraveis) - colectomia oncologica indicada. Margem comprometida, sm3, LVI ou budding G3."</text></outputEntry>
        <outputEntry id="OE_Apr2_3"><text>"NCCN 2024 / JSCCR 2019 - Malignant Polyp Surgery"</text></outputEntry>
      <outputEntry id="OE_GEN_COL_010_Aprovado_Carcinoma_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_GEN_COL_010_Aprovado_Carcinoma_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <rule id="Rule_GEN_COL_010_Aprovado_Falha_Centro">
        <description>Aprovado - Falha em centro de referencia</description>
        <inputEntry id="IE_Apr3_1"><text>"Nao_Ressecavel_Endoscopicamente"</text></inputEntry>
        <inputEntry id="IE_Apr3_2"><text>"Centro_Referencia_Indicou_Cirurgia"</text></inputEntry>
        <inputEntry id="IE_Apr3_3"><text>true</text></inputEntry>
        <inputEntry id="IE_Apr3_4"><text>-</text></inputEntry>
        <inputEntry id="IE_Apr3_5"><text>true</text></inputEntry>
        <outputEntry id="OE_Apr3_1"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OE_Apr3_2"><text>"Polipo nao ressecavel endoscopicamente apos avaliacao em centro de referencia - colectomia segmentar aprovada. Laparoscopia preferida."</text></outputEntry>
        <outputEntry id="OE_Apr3_3"><text>"ESGE 2021 - Referral Center Decision"</text></outputEntry>
      <outputEntry id="OE_GEN_COL_010_Aprovado_Falha_Centro_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_GEN_COL_010_Aprovado_Falha_Centro_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <rule id="Rule_GEN_COL_010_Aprovado_Suspeita_Invasao">
        <description>Aprovado - Suspeita de invasao profunda</description>
        <inputEntry id="IE_Apr4_1"><text>"Suspeita_Invasao"</text></inputEntry>
        <inputEntry id="IE_Apr4_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Apr4_3"><text>true</text></inputEntry>
        <inputEntry id="IE_Apr4_4"><text>"Displasia_Alto_Grau"</text></inputEntry>
        <inputEntry id="IE_Apr4_5"><text>true</text></inputEntry>
        <outputEntry id="OE_Apr4_1"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OE_Apr4_2"><text>"Polipo com suspeita de invasao submucosa profunda (non-lifting, depressao, ulceracao) - colectomia oncologica aprovada. Evitar fragmentacao se possivel invasivo."</text></outputEntry>
        <outputEntry id="OE_Apr4_3"><text>"ESGE 2021 - Suspected Deep Invasion"</text></outputEntry>
      <outputEntry id="OE_GEN_COL_010_Aprovado_Suspeita_Invasao_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_GEN_COL_010_Aprovado_Suspeita_Invasao_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <!-- REGRAS DE PENDENCIA -->

      <rule id="Rule_GEN_COL_010_Pendente_Resseccao_Parcial">
        <description>Pendente - Resseccao parcial aguardando histopatologico</description>
        <inputEntry id="IE_Pend1_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Pend1_2"><text>"Resseccao_Parcial"</text></inputEntry>
        <inputEntry id="IE_Pend1_3"><text>true</text></inputEntry>
        <inputEntry id="IE_Pend1_4"><text>"Nao_Disponivel"</text></inputEntry>
        <inputEntry id="IE_Pend1_5"><text>-</text></inputEntry>
        <outputEntry id="OE_Pend1_1"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_Pend1_2"><text>"Resseccao endoscopica parcial - aguardar histopatologico completo para definir necessidade de complementacao cirurgica."</text></outputEntry>
        <outputEntry id="OE_Pend1_3"><text>"ESGE 2021 - Await Histology"</text></outputEntry>
      <outputEntry id="OE_GEN_COL_010_Pendente_Resseccao_Parcial_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_GEN_COL_010_Pendente_Resseccao_Parcial_5"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

      <rule id="Rule_GEN_COL_010_Pendente_CentroReferencia">
        <description>Pendente - Encaminhar para centro de referencia primeiro</description>
        <inputEntry id="IE_Pend2_1"><text>"Nao_Ressecavel_Endoscopicamente"</text></inputEntry>
        <inputEntry id="IE_Pend2_2"><text>"Tentada_Falhou"</text></inputEntry>
        <inputEntry id="IE_Pend2_3"><text>true</text></inputEntry>
        <inputEntry id="IE_Pend2_4"><text>"Benigno","Displasia_Alto_Grau"</text></inputEntry>
        <inputEntry id="IE_Pend2_5"><text>-</text></inputEntry>
        <outputEntry id="OE_Pend2_1"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_Pend2_2"><text>"Polipo complexo nao ressecado - encaminhar para centro de referencia em polipectomia (ESD, EMR avancada) antes de indicar cirurgia."</text></outputEntry>
        <outputEntry id="OE_Pend2_3"><text>"ESGE 2021 - Referral to Expert Center"</text></outputEntry>
      <outputEntry id="OE_GEN_COL_010_Pendente_CentroReferencia_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_GEN_COL_010_Pendente_CentroReferencia_5"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

      <!-- REGRA FALLBACK -->

      <rule id="Rule_GEN_COL_010_Fallback">
        <description>Fallback - Analise especializada</description>
        <inputEntry id="IE_Fallback_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_4"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_5"><text>-</text></inputEntry>
        <outputEntry id="OE_Fallback_1"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_Fallback_2"><text>"Caso de polipo nao ressecavel requer analise por equipe multidisciplinar (endoscopia + cirurgia)."</text></outputEntry>
        <outputEntry id="OE_Fallback_3"><text>"Auditoria multidisciplinar - RN 428/2017"</text></outputEntry>
      <outputEntry id="OE_GEN_COL_010_Fallback_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_GEN_COL_010_Fallback_5"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

    </decisionTable>
  </decision>
</definitions>
