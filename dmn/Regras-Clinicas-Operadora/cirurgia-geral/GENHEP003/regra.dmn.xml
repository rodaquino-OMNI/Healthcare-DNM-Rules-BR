<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"
             xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/"
             xmlns:dc="http://www.omg.org/spec/DD/20100524/DC/"
             xmlns:di="http://www.omg.org/spec/DD/20100524/DI/"
             id="Definitions_GEN_HEP_003"
             name="Exploracao CBD vs ERCP - Manejo de Calculos"
             namespace="http://camunda.org/schema/1.0/dmn"
             exporter="Camunda Modeler"
             exporterVersion="5.0.0">
  <!--
    GEN-HEP-003 - Exploracao de Coledoco vs ERCP para Coledocolitiase
    Versao: 1.0.0 (2026-02-07)
    Especialidade: Cirurgia Geral - Hepatobiliar
    Categoria: Procedimentos Cirurgicos

    Indicacoes Clinicas (ESGE 2019 / SAGES 2023):
    - ERCP pre-operatoria: Probabilidade alta de coledocolitiase (>50%)
    - Exploracao intraoperatoria (LCBDE): Descoberta incidental durante colecistectomia
    - Exploracao aberta CBD: Anatomia desfavoravel ou falha de ERCP
    - Single-stage (LCBDE + colecistectomia): Preferida em centros experientes

    Criterios de Probabilidade:
    - Alta (>50%): CBD >6mm + hiperbilirrubinemia + calculo visualizado
    - Intermediaria (10-50%): Alteracao laboratorial isolada
    - Baixa (<10%): Colelitiase sem alteracoes laboratoriais/imagem

    Documentacao Obrigatoria:
    - Colangioressonancia ou USG endoscopico
    - Bilirrubinas e enzimas canaliculares
    - Diametro do coledoco documentado

    Referencias Normativas:
    - ESGE Guideline 2019 - CBD Stones Management
    - SAGES 2023 - Intraoperative Cholangiography
    - ASGE 2019 - Role of ERCP
  -->

  <decision id="Decision_GEN_HEP_003" name="Criterios de Autorizacao - CBD Exploration vs ERCP">
    <decisionTable id="DecisionTable_GEN_HEP_003" hitPolicy="FIRST">

      <!-- Input 1: Probabilidade de Coledocolitiase -->
      <input id="Input_probabilidade" label="Probabilidade de Coledocolitiase">
        <inputExpression id="InputExpr_probabilidade" typeRef="string">
          <text>probabilidadeColedocolitiase</text>
        </inputExpression>
        <inputValues id="InputValues_probabilidade">
          <text>"Alta_Mais_50","Intermediaria_10_50","Baixa_Menos_10","Calculo_Visualizado"</text>
        </inputValues>
      </input>

      <!-- Input 2: Procedimento Solicitado -->
      <input id="Input_procedimento" label="Procedimento Solicitado">
        <inputExpression id="InputExpr_procedimento" typeRef="string">
          <text>procedimentoSolicitado</text>
        </inputExpression>
        <inputValues id="InputValues_procedimento">
          <text>"ERCP","LCBDE","Exploracao_Aberta_CBD","Single_Stage"</text>
        </inputValues>
      </input>

      <!-- Input 3: Imagem Confirmatoria (ColangioRM ou EUS) -->
      <input id="Input_imagemBiliar" label="ColangioRM ou EUS Realizado">
        <inputExpression id="InputExpr_imagemBiliar" typeRef="boolean">
          <text>imagemBiliarConfirmatoria</text>
        </inputExpression>
      </input>

      <!-- Input 4: Risco Cirurgico (ASA) -->
      <input id="Input_riscoCirurgico" label="Classificacao ASA">
        <inputExpression id="InputExpr_riscoCirurgico" typeRef="string">
          <text>riscoCirurgico</text>
        </inputExpression>
        <inputValues id="InputValues_riscoCirurgico">
          <text>"ASA_I","ASA_II","ASA_III","ASA_IV","ASA_V"</text>
        </inputValues>
      </input>

      <!-- Input 5: Laudo de Indicacao -->
      <input id="Input_laudoIndicacao" label="Laudo de Indicacao">
        <inputExpression id="InputExpr_laudoIndicacao" typeRef="boolean">
          <text>laudoIndicacao</text>
        </inputExpression>
      </input>

      <!-- Output 1: Resultado -->
      <output id="Output_resultado" label="Resultado" name="resultado" typeRef="string">
        <outputValues id="OutputValues_resultado">
          <text>"Aprovado","Reprovado","Pendente"</text>
        </outputValues>
      </output>

      <!-- Output 2: Observacao -->
      <output id="Output_observacao" label="Observacao Clinica" name="observacao" typeRef="string" />

      <!-- Output 3: Fundamentacao -->
      <output id="Output_fundamentacao" label="Fundamentacao" name="fundamentacao" typeRef="string" />

      <!-- Output 4: Alertas Desperdicio -->
      <output id="Output_alertasDesperdicio" label="Alertas de Desperdicio" name="alertasDesperdicio" typeRef="string">
        <outputValues id="OutputValues_alertasDesperdicio">
          <text>"NENHUM","DUP","FREQ","ESC","DOC","PROT","MULTI"</text>
        </outputValues>
      </output>

      <!-- Output 5: Acao Recomendada -->
      <output id="Output_acaoRecomendada" label="Acao Recomendada" name="acaoRecomendada" typeRef="string">
        <outputValues id="OutputValues_acaoRecomendada">
          <text>"APROVAR","NEGAR","SOLICITAR_INFO","AGUARDAR_PRAZO","SUGERIR_ALTERNATIVA"</text>
        </outputValues>
      </output>

      <!-- REGRAS DE REPROVACAO -->

      <rule id="Rule_GEN_HEP_003_Reprovado_SemImagem">
        <description>Reprovado - Sem imagem confirmatoria de via biliar</description>
        <inputEntry id="IE_Rep1_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep1_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep1_3"><text>false</text></inputEntry>
        <inputEntry id="IE_Rep1_4"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep1_5"><text>-</text></inputEntry>
        <outputEntry id="OE_Rep1_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_Rep1_2"><text>"Colangioressonancia ou USG endoscopico obrigatorio para estratificacao de risco e definicao de abordagem de coledocolitiase."</text></outputEntry>
        <outputEntry id="OE_Rep1_3"><text>"ESGE 2019 - Pre-procedural Imaging Required"</text></outputEntry>
      <outputEntry id="OE_GEN_HEP_003_Reprovado_SemImagem_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_GEN_HEP_003_Reprovado_SemImagem_5"><text>"NEGAR"</text></outputEntry>
      </rule>

      <rule id="Rule_GEN_HEP_003_Reprovado_SemLaudo">
        <description>Reprovado - Sem laudo de indicacao</description>
        <inputEntry id="IE_Rep2_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep2_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep2_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep2_4"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep2_5"><text>false</text></inputEntry>
        <outputEntry id="OE_Rep2_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_Rep2_2"><text>"Laudo de indicacao obrigatorio com estratificacao de probabilidade e justificativa da escolha terapeutica."</text></outputEntry>
        <outputEntry id="OE_Rep2_3"><text>"RN 465/2021 - Documentacao Obrigatoria"</text></outputEntry>
      <outputEntry id="OE_GEN_HEP_003_Reprovado_SemLaudo_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_GEN_HEP_003_Reprovado_SemLaudo_5"><text>"NEGAR"</text></outputEntry>
      </rule>

      <rule id="Rule_GEN_HEP_003_Reprovado_BaixaProb_Invasivo">
        <description>Reprovado - Baixa probabilidade nao justifica procedimento invasivo</description>
        <inputEntry id="IE_Rep3_1"><text>"Baixa_Menos_10"</text></inputEntry>
        <inputEntry id="IE_Rep3_2"><text>"ERCP","Exploracao_Aberta_CBD"</text></inputEntry>
        <inputEntry id="IE_Rep3_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep3_4"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep3_5"><text>-</text></inputEntry>
        <outputEntry id="OE_Rep3_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_Rep3_2"><text>"Probabilidade baixa de coledocolitiase (&lt;10%) nao justifica ERCP ou exploracao aberta. Realizar colecistectomia com colangiografia intraoperatoria se indicado."</text></outputEntry>
        <outputEntry id="OE_Rep3_3"><text>"ESGE 2019 - Low Probability Management"</text></outputEntry>
      <outputEntry id="OE_GEN_HEP_003_Reprovado_BaixaProb_Invasivo_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_GEN_HEP_003_Reprovado_BaixaProb_Invasivo_5"><text>"NEGAR"</text></outputEntry>
      </rule>

      <!-- REGRAS DE APROVACAO -->

      <rule id="Rule_GEN_HEP_003_Aprovado_AltaProb_ERCP">
        <description>Aprovado - Alta probabilidade com ERCP</description>
        <inputEntry id="IE_Apr1_1"><text>"Alta_Mais_50","Calculo_Visualizado"</text></inputEntry>
        <inputEntry id="IE_Apr1_2"><text>"ERCP"</text></inputEntry>
        <inputEntry id="IE_Apr1_3"><text>true</text></inputEntry>
        <inputEntry id="IE_Apr1_4"><text>"ASA_I","ASA_II","ASA_III","ASA_IV"</text></inputEntry>
        <inputEntry id="IE_Apr1_5"><text>true</text></inputEntry>
        <outputEntry id="OE_Apr1_1"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OE_Apr1_2"><text>"Alta probabilidade de coledocolitiase - ERCP pre-operatoria indicada conforme ESGE 2019. Seguir com colecistectomia apos clearance biliar."</text></outputEntry>
        <outputEntry id="OE_Apr1_3"><text>"ESGE 2019 / ASGE 2019 - High Probability CBD Stones"</text></outputEntry>
      <outputEntry id="OE_GEN_HEP_003_Aprovado_AltaProb_ERCP_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_GEN_HEP_003_Aprovado_AltaProb_ERCP_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <rule id="Rule_GEN_HEP_003_Aprovado_SingleStage">
        <description>Aprovado - Single-stage LCBDE + Colecistectomia</description>
        <inputEntry id="IE_Apr2_1"><text>"Alta_Mais_50","Calculo_Visualizado"</text></inputEntry>
        <inputEntry id="IE_Apr2_2"><text>"Single_Stage","LCBDE"</text></inputEntry>
        <inputEntry id="IE_Apr2_3"><text>true</text></inputEntry>
        <inputEntry id="IE_Apr2_4"><text>"ASA_I","ASA_II","ASA_III"</text></inputEntry>
        <inputEntry id="IE_Apr2_5"><text>true</text></inputEntry>
        <outputEntry id="OE_Apr2_1"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OE_Apr2_2"><text>"Single-stage (LCBDE + colecistectomia) aprovado para centro com experiencia. Abordagem custo-efetiva com menor tempo de internacao."</text></outputEntry>
        <outputEntry id="OE_Apr2_3"><text>"SAGES 2023 - Single-Stage Management"</text></outputEntry>
      <outputEntry id="OE_GEN_HEP_003_Aprovado_SingleStage_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_GEN_HEP_003_Aprovado_SingleStage_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <rule id="Rule_GEN_HEP_003_Aprovado_IntermediariaSeguimento">
        <description>Aprovado - Probabilidade intermediaria com imagem confirmatoria positiva</description>
        <inputEntry id="IE_Apr3_1"><text>"Intermediaria_10_50"</text></inputEntry>
        <inputEntry id="IE_Apr3_2"><text>"ERCP","LCBDE"</text></inputEntry>
        <inputEntry id="IE_Apr3_3"><text>true</text></inputEntry>
        <inputEntry id="IE_Apr3_4"><text>"ASA_I","ASA_II","ASA_III","ASA_IV"</text></inputEntry>
        <inputEntry id="IE_Apr3_5"><text>true</text></inputEntry>
        <outputEntry id="OE_Apr3_1"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OE_Apr3_2"><text>"Probabilidade intermediaria com imagem confirmatoria de calculo - procedimento de clearance biliar aprovado."</text></outputEntry>
        <outputEntry id="OE_Apr3_3"><text>"ESGE 2019 - Intermediate Probability with Positive Imaging"</text></outputEntry>
      <outputEntry id="OE_GEN_HEP_003_Aprovado_IntermediariaSeguimento_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_GEN_HEP_003_Aprovado_IntermediariaSeguimento_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <!-- REGRAS DE PENDENCIA -->

      <rule id="Rule_GEN_HEP_003_Pendente_IntermediariaAvaliar">
        <description>Pendente - Probabilidade intermediaria requer EUS/ColangioRM</description>
        <inputEntry id="IE_Pend1_1"><text>"Intermediaria_10_50"</text></inputEntry>
        <inputEntry id="IE_Pend1_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Pend1_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Pend1_4"><text>-</text></inputEntry>
        <inputEntry id="IE_Pend1_5"><text>-</text></inputEntry>
        <outputEntry id="OE_Pend1_1"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_Pend1_2"><text>"Probabilidade intermediaria - realizar EUS ou ColangioRM antes de definir abordagem terapeutica. Anexar resultado para reavaliacao."</text></outputEntry>
        <outputEntry id="OE_Pend1_3"><text>"ESGE 2019 - Intermediate Probability Algorithm"</text></outputEntry>
      <outputEntry id="OE_GEN_HEP_003_Pendente_IntermediariaAvaliar_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_GEN_HEP_003_Pendente_IntermediariaAvaliar_5"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

      <!-- REGRA FALLBACK -->

      <rule id="Rule_GEN_HEP_003_Fallback">
        <description>Fallback - Analise manual</description>
        <inputEntry id="IE_Fallback_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_4"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_5"><text>-</text></inputEntry>
        <outputEntry id="OE_Fallback_1"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_Fallback_2"><text>"Caso requer analise por auditor medico especializado em hepatobiliar."</text></outputEntry>
        <outputEntry id="OE_Fallback_3"><text>"Auditoria medica - RN 428/2017"</text></outputEntry>
      <outputEntry id="OE_GEN_HEP_003_Fallback_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_GEN_HEP_003_Fallback_5"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

    </decisionTable>
  </decision>
</definitions>
