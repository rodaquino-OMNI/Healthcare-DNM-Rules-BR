<?xml version="1.0" encoding="UTF-8"?>
<!--
  ============================================================================
  EWS-NEWS-001: NEWS2 Score Critical (≥7) - IMMEDIATE ALERT
  ============================================================================

  National Early Warning Score 2 (NEWS2) for acute illness in adults.
  This rule triggers IMMEDIATE clinical response for high-risk patients.

  Evidence Base: Royal College of Physicians, 2017
  Sensitivity: 89.4% for detecting clinical deterioration
  Specificity: 76.8%

  ============================================================================
-->
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"
             xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/"
             xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/"
             id="Definitions_EWS_NEWS_001"
             name="NEWS2 Critical Alert"
             targetNamespace="http://camunda.org/schema/1.0/dmn">

  <!--
    ═══════════════════════════════════════════════════════════════════════════
    EWS-NEWS-001: NEWS2 Critical Score Alert
    Version: 1.0.0 (2026-02-06)
    Clinical Domain: Emergency Medicine / Critical Care
    ═══════════════════════════════════════════════════════════════════════════

    TRIGGER CONDITIONS (Alerta):
    - NEWS2 total score ≥ 7 points (aggregate high risk)
    - OR any single parameter scoring 3 points (red flag)

    CLINICAL ACTIONS REQUIRED:
    - Immediate medical review by critical care team
    - Continuous monitoring
    - Consider ICU transfer
    - Assess for sepsis, respiratory failure, shock

    CONTRAINDICATIONS TO IGNORE ALERT:
    - None - all high scores require review (palliative care still notified)

    EVIDENCE BASE:
    - Royal College of Physicians UK (2017)
    - NICE CG50 Acutely ill adults in hospital
    - Validated in 35,585 admissions (Smith et al., 2013)
    ═══════════════════════════════════════════════════════════════════════════
  -->

  <decision id="Decision_EWS_NEWS_001" name="NEWS2 Critical Score Evaluation">
    <decisionTable id="DecisionTable_EWS_NEWS_001" hitPolicy="FIRST">

      <!-- INPUT 1: NEWS2 Total Score (0-20 range) -->
      <input id="Input_1" label="NEWS2 Score Total">
        <inputExpression id="InputExpression_1" typeRef="number">
          <text>news2ScoreTotal</text>
        </inputExpression>
      </input>

      <!-- INPUT 2: Has Any Parameter = 3 (Red Flag) -->
      <input id="Input_2" label="Single Parameter Score 3">
        <inputExpression id="InputExpression_2" typeRef="boolean">
          <text>hasParametroScore3</text>
        </inputExpression>
      </input>

      <!-- INPUT 3: Patient Age (for age-adjusted interpretation) -->
      <input id="Input_3" label="Idade Paciente">
        <inputExpression id="InputExpression_3" typeRef="number">
          <text>idadePaciente</text>
        </inputExpression>
      </input>

      <!-- INPUT 4: Is Palliative Care Patient -->
      <input id="Input_4" label="Cuidados Paliativos">
        <inputExpression id="InputExpression_4" typeRef="boolean">
          <text>cuidadosPaliativos</text>
        </inputExpression>
      </input>

      <!-- OUTPUT 1: Alert Level -->
      <output id="Output_1" label="Nivel Alerta" name="nivelAlerta" typeRef="string">
        <outputValues id="OutputValues_1">
          <text>"Alerta", "Atencao", "Informativo", "OK", "Revisar"</text>
        </outputValues>
      </output>

      <!-- OUTPUT 2: Urgency -->
      <output id="Output_2" label="Urgencia" name="urgencia" typeRef="string">
        <outputValues id="OutputValues_2">
          <text>"IMEDIATA", "URGENTE", "ROTINA", "INFORMATIVA"</text>
        </outputValues>
      </output>

      <!-- OUTPUT 3: Required Action -->
      <output id="Output_3" label="Acao Requerida" name="acaoRequerida" typeRef="string"/>

      <!-- OUTPUT 4: Clinical Justification -->
      <output id="Output_4" label="Justificativa Cientifica" name="justificativaCientifica" typeRef="string"/>

      <!-- RULE 1: CRITICAL - NEWS2 ≥ 7 (High Risk) -->
      <rule id="Rule_Critical_Score7">
        <description>NEWS2 score ≥7 indicates high risk of clinical deterioration requiring immediate response</description>
        <inputEntry id="InputEntry_1_1">
          <text>&gt;= 7</text>
        </inputEntry>
        <inputEntry id="InputEntry_1_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_1_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_1_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_1_1">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_1_2">
          <text>"IMEDIATA"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_1_3">
          <text>"Avaliacao IMEDIATA por medico senior/equipe de resposta rapida. Monitoramento continuo de sinais vitais. Considerar transferencia para UTI. Investigar sepse, insuficiencia respiratoria, choque."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_1_4">
          <text>"NEWS2 ≥7 apresenta risco agregado elevado de deterioracao clinica (mortalidade hospitalar 8.7%, RCP 2017). Sensibilidade 89.4% para detectar eventos adversos graves nas proximas 24h. Requer resposta clinica urgente."</text>
        </outputEntry>
      </rule>

      <!-- RULE 2: CRITICAL - Single Parameter Score 3 (Red Flag) -->
      <rule id="Rule_Critical_RedFlag">
        <description>Any single parameter scoring 3 points is a red flag requiring urgent assessment</description>
        <inputEntry id="InputEntry_2_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_2_2">
          <text>true</text>
        </inputEntry>
        <inputEntry id="InputEntry_2_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_2_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_2_1">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_2_2">
          <text>"IMEDIATA"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_2_3">
          <text>"Avaliacao URGENTE por medico clinico dentro de 30 minutos. Parametro extremo detectado (score 3). Monitoramento rigoroso ate estabilizacao. Identificar causa subjacente."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_2_4">
          <text>"Parametro unico pontuando 3 indica desvio fisiologico extremo (ex: FR ≤8 ou ≥25, SpO2 ≤91%, nivel consciencia V/P/U, PA ≤90). Associado a risco independente de deterioracao mesmo com score total baixo."</text>
        </outputEntry>
      </rule>

      <!-- RULE 3: HIGH RISK - Score 5-6 + Elderly -->
      <rule id="Rule_HighRisk_Elderly">
        <description>Medium-risk score in elderly requires enhanced surveillance</description>
        <inputEntry id="InputEntry_3_1">
          <text>[5..6]</text>
        </inputEntry>
        <inputEntry id="InputEntry_3_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_3_3">
          <text>&gt;= 75</text>
        </inputEntry>
        <inputEntry id="InputEntry_3_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_3_1">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_3_2">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_3_3">
          <text>"Avaliacao por medico clinico dentro de 1 hora. Paciente idoso com risco medio-elevado. Aumentar frequencia de monitorizacao (minimo a cada 1 hora). Reavaliar necessidade de suporte adicional."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_3_4">
          <text>"NEWS2 5-6 em idosos ≥75 anos tem maior probabilidade de progressao para deterioracao (mortalidade 3.1%). Idade avancada reduz reserva fisiologica. Necessaria vigilancia intensificada."</text>
        </outputEntry>
      </rule>

      <!-- RULE 4: PALLIATIVE - High score but comfort care -->
      <rule id="Rule_Palliative_Notification">
        <description>High NEWS2 in palliative patient - notify team but focus on comfort</description>
        <inputEntry id="InputEntry_4_1">
          <text>&gt;= 5</text>
        </inputEntry>
        <inputEntry id="InputEntry_4_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_4_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_4_4">
          <text>true</text>
        </inputEntry>
        <outputEntry id="OutputEntry_4_1">
          <text>"Informativo"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_4_2">
          <text>"INFORMATIVA"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_4_3">
          <text>"Notificar equipe de cuidados paliativos. Score elevado detectado mas objetivo e conforto, nao intervencao agressiva. Reavaliar metas de cuidado com familia. Otimizar controle de sintomas."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_4_4">
          <text>"Paciente em cuidados paliativos com deterioracao fisiologica esperada. Score elevado nao indica falha de cuidado. Foco em qualidade de vida, controle de dor, dignidade. Comunicacao com familia essencial."</text>
        </outputEntry>
      </rule>

      <!-- RULE 5: FALLBACK - Unexpected pattern -->
      <rule id="Rule_Fallback_EWS_NEWS_001">
        <description>Dados incompletos ou score invalido - requer revisao manual</description>
        <inputEntry id="InputEntry_F_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_F_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_F_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_F_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_F_1">
          <text>"Revisar"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_F_2">
          <text>"ROTINA"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_F_3">
          <text>"Verificar calculo do NEWS2. Confirmar coleta completa de sinais vitais. Revisar parametros fora da faixa esperada (0-20). Contatar equipe de resposta rapida se houver duvida."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_F_4">
          <text>"Score NEWS2 fora dos padroes esperados ou dados incompletos. Necessario revisao manual para garantir calculo correto e resposta clinica apropriada."</text>
        </outputEntry>
      </rule>

    </decisionTable>
  </decision>

  <dmndi:DMNDI>
    <dmndi:DMNDiagram id="DMNDiagram_EWS_NEWS_001">
      <dmndi:DMNShape id="DMNShape_Decision_EWS_NEWS_001" dmnElementRef="Decision_EWS_NEWS_001">
        <dc:Bounds height="80" width="180" x="160" y="100"/>
      </dmndi:DMNShape>
    </dmndi:DMNDiagram>
  </dmndi:DMNDI>

</definitions>
