<?xml version="1.0" encoding="UTF-8"?>
<!--
  ============================================================================
  EWS-PEWS-004: PEWS Respiratory Component - Age-Adjusted Thresholds
  ============================================================================

  Pediatric Early Warning Score - Respiratory Assessment.
  This rule uses age-adjusted respiratory rate thresholds.

  Evidence Base: Pediatric vital sign references
  Age-Adjusted Respiratory Rate (Normal):
  - 0-3 months: 30-60/min
  - 3-6 months: 25-40/min
  - 6-12 months: 20-30/min
  - 1-3 years: 20-30/min
  - 3-6 years: 18-25/min
  - 6-12 years: 16-20/min
  - >12 years: 12-18/min

  ============================================================================
-->
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"
             xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/"
             xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/"
             id="Definitions_EWS_PEWS_004"
             name="PEWS Respiratory Component"
             targetNamespace="http://camunda.org/schema/1.0/dmn">

  <!--
    ═══════════════════════════════════════════════════════════════════════════
    EWS-PEWS-004: PEWS Respiratory Component Assessment
    Version: 1.0.0 (2026-02-06)
    Clinical Domain: Pediatric Pulmonology / Emergency Medicine
    ═══════════════════════════════════════════════════════════════════════════

    RESPIRATORY ASSESSMENT:
    - Respiratory rate (age-adjusted)
    - Work of breathing (accessory muscles, retractions)
    - Oxygen saturation
    - Supplemental oxygen requirement

    CLINICAL SIGNIFICANCE:
    - Respiratory failure is #1 cause of pediatric arrest
    - Early detection prevents progression
    ═══════════════════════════════════════════════════════════════════════════
  -->

  <decision id="Decision_EWS_PEWS_004" name="PEWS Respiratory Component Evaluation">
    <decisionTable id="DecisionTable_EWS_PEWS_004" hitPolicy="FIRST">

      <!-- INPUT 1: Age in Months -->
      <input id="Input_1" label="Idade Meses">
        <inputExpression id="InputExpression_1" typeRef="number">
          <text>idadeMeses</text>
        </inputExpression>
      </input>

      <!-- INPUT 2: Respiratory Rate -->
      <input id="Input_2" label="Frequencia Respiratoria">
        <inputExpression id="InputExpression_2" typeRef="number">
          <text>frequenciaRespiratoria</text>
        </inputExpression>
      </input>

      <!-- INPUT 3: Oxygen Saturation -->
      <input id="Input_3" label="Saturacao O2">
        <inputExpression id="InputExpression_3" typeRef="number">
          <text>saturacaoO2</text>
        </inputExpression>
      </input>

      <!-- INPUT 4: Respiratory Effort Score (0-3) -->
      <input id="Input_4" label="Esforco Respiratorio">
        <inputExpression id="InputExpression_4" typeRef="number">
          <text>esforcoRespiratorio</text>
        </inputExpression>
      </input>

      <!-- OUTPUT 1: Alert Level -->
      <output id="Output_1" label="Nivel Alerta" name="nivelAlerta" typeRef="string">
        <outputValues id="OutputValues_1">
          <text>"Alerta", "Atencao", "Informativo", "OK", "Revisar"</text>
        </outputValues>
      </output>

      <!-- OUTPUT 2: Urgency -->
      <output id="Output_2" label="Urgencia" name="urgencia" typeRef="string">
        <outputValues id="OutputValues_2">
          <text>"IMEDIATA", "URGENTE", "ROTINA", "INFORMATIVA"</text>
        </outputValues>
      </output>

      <!-- OUTPUT 3: Required Action -->
      <output id="Output_3" label="Acao Requerida" name="acaoRequerida" typeRef="string"/>

      <!-- OUTPUT 4: Clinical Justification -->
      <output id="Output_4" label="Justificativa Cientifica" name="justificativaCientifica" typeRef="string"/>

      <!-- RULE 1: CRITICAL - Apnea/Gasping (effort score 3) -->
      <rule id="Rule_Critical_ApneaGasping">
        <description>Apnea or gasping - impending respiratory arrest</description>
        <inputEntry id="InputEntry_1_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_1_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_1_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_1_4">
          <text>3</text>
        </inputEntry>
        <outputEntry id="OutputEntry_1_1">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_1_2">
          <text>"IMEDIATA"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_1_3">
          <text>"APNEIA/GASPING - PARADA RESPIRATORIA IMINENTE. Chamar equipe de emergencia AGORA. Iniciar BVM com O2 100%. Preparar material de intubacao pediatrica. Monitorar. Acesso venoso urgente. UTIP em alerta."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_1_4">
          <text>"Esforco respiratorio score 3 (apneia/gasping) indica falencia respiratoria. Criancas progridem de taquipneia para bradipneia para apneia em minutos quando esgotam reservas. Ventilacao assistida imediata obrigatoria."</text>
        </outputEntry>
      </rule>

      <!-- RULE 2: CRITICAL - Severe hypoxia (SpO2 <90%) -->
      <rule id="Rule_Critical_SevereHypoxia">
        <description>Severe hypoxia regardless of respiratory rate</description>
        <inputEntry id="InputEntry_2_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_2_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_2_3">
          <text>&lt; 90</text>
        </inputEntry>
        <inputEntry id="InputEntry_2_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_2_1">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_2_2">
          <text>"IMEDIATA"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_2_3">
          <text>"HIPOXIA GRAVE (SpO2&lt;90%). Iniciar O2 alto fluxo imediatamente (mascara com reservatorio). Avaliar via aerea. Preparar VNI ou intubacao se nao responder. Monitorar continuamente. Avaliacao medica URGENTE."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_2_4">
          <text>"SpO2 &lt;90% em crianca indica hipoxemia significativa. Oxigenio deve ser oferecido imediatamente sem esperar avaliacao. Criancas dessaturam mais rapidamente que adultos devido ao maior consumo de O2."</text>
        </outputEntry>
      </rule>

      <!-- RULE 3: HIGH RISK - Infant (<12m) with severe tachypnea -->
      <rule id="Rule_HighRisk_InfantTachypnea">
        <description>Infant with respiratory rate >60 - significant distress</description>
        <inputEntry id="InputEntry_3_1">
          <text>&lt; 12</text>
        </inputEntry>
        <inputEntry id="InputEntry_3_2">
          <text>&gt; 60</text>
        </inputEntry>
        <inputEntry id="InputEntry_3_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_3_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_3_1">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_3_2">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_3_3">
          <text>"LACTENTE com taquipneia grave (FR>60). Avaliar sinais de desconforto respiratorio (BAN, tiragem, gemido). Iniciar O2 se SpO2&lt;94%. Posicionar adequadamente. Avaliar para bronquiolite, pneumonia. Considerar gasometria."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_3_4">
          <text>"FR >60 em lactente &lt;12 meses esta acima do limite superior normal e indica trabalho respiratorio aumentado. Principais causas: bronquiolite, pneumonia, cardiopatia. Lactentes tem menor reserva e fadigam rapidamente."</text>
        </outputEntry>
      </rule>

      <!-- RULE 4: ATTENTION - Child (1-3y) with tachypnea -->
      <rule id="Rule_Attention_ToddlerTachypnea">
        <description>Toddler with respiratory rate >40</description>
        <inputEntry id="InputEntry_4_1">
          <text>[12..36]</text>
        </inputEntry>
        <inputEntry id="InputEntry_4_2">
          <text>&gt; 40</text>
        </inputEntry>
        <inputEntry id="InputEntry_4_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_4_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_4_1">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_4_2">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_4_3">
          <text>"Crianca 1-3 anos com taquipneia (FR>40). Avaliar sinais de esforco (retracao intercostal, subcostal). Monitorar SpO2. Investigar causa (infeccao respiratoria, asma, corpo estranho). Avaliar hidratacao e aceitacao oral."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_4_4">
          <text>"FR >40 em crianca 1-3 anos excede limite superior normal (30). Taquipneia pode ser compensatoria (febre, acidose) ou primariamente respiratoria. Avaliar trabalho respiratorio alem da frequencia."</text>
        </outputEntry>
      </rule>

      <!-- RULE 5: ATTENTION - Moderate effort with normal SpO2 -->
      <rule id="Rule_Attention_ModerateEffort">
        <description>Increased work of breathing with maintained oxygenation</description>
        <inputEntry id="InputEntry_5_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_5_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_5_3">
          <text>&gt;= 92</text>
        </inputEntry>
        <inputEntry id="InputEntry_5_4">
          <text>2</text>
        </inputEntry>
        <outputEntry id="OutputEntry_5_1">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_5_2">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_5_3">
          <text>"Esforco respiratorio MODERADO com SpO2 mantida. Crianca compensando mas pode fatigar. Monitorar de perto. Iniciar O2 suplementar se SpO2 cair. Avaliar causa. Preparar para possivel escalonamento."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_5_4">
          <text>"Esforco respiratorio score 2 (retracao moderada, uso de acessorios) indica compensacao ativa. SpO2 mantida por agora, mas criancas podem descompensar subitamente quando fadigam. Intervencao precoce previne falencia."</text>
        </outputEntry>
      </rule>

      <!-- RULE 6: FALLBACK -->
      <rule id="Rule_Fallback_EWS_PEWS_004">
        <description>Parametros respiratorios normais ou dados incompletos</description>
        <inputEntry id="InputEntry_F_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_F_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_F_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_F_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_F_1">
          <text>"Revisar"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_F_2">
          <text>"ROTINA"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_F_3">
          <text>"Verificar parametros respiratorios. Usar tabela de referencia por idade. Componente respiratorio PEWS 0-1 se FR e esforco normais para idade. Monitorar de rotina."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_F_4">
          <text>"Frequencia respiratoria normal varia significativamente por idade em pediatria. Sempre comparar com valores de referencia apropriados. Esforco respiratorio e tao importante quanto frequencia."</text>
        </outputEntry>
      </rule>

    </decisionTable>
  </decision>

  <dmndi:DMNDI>
    <dmndi:DMNDiagram id="DMNDiagram_EWS_PEWS_004">
      <dmndi:DMNShape id="DMNShape_Decision_EWS_PEWS_004" dmnElementRef="Decision_EWS_PEWS_004">
        <dc:Bounds height="80" width="180" x="160" y="100"/>
      </dmndi:DMNShape>
    </dmndi:DMNDiagram>
  </dmndi:DMNDI>

</definitions>
