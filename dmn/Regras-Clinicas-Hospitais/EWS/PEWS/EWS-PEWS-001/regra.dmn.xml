<?xml version="1.0" encoding="UTF-8"?>
<!--
  ============================================================================
  EWS-PEWS-001: PEWS Critical Score (>=5) - IMMEDIATE ALERT
  ============================================================================

  Pediatric Early Warning Score for detecting deterioration in children.
  This rule triggers IMMEDIATE clinical response for high-risk pediatric patients.

  Evidence Base: Monaghan (2005), Brighton PEWS validation studies
  PEWS Components:
  - Behavior (0-3): Playing/appropriate to irritable/lethargy to unresponsive
  - Cardiovascular (0-3): Pink to gray/mottled, capillary refill
  - Respiratory (0-3): Normal to severe distress, accessory muscle use

  ============================================================================
-->
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"
             xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/"
             xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/"
             id="Definitions_EWS_PEWS_001"
             name="PEWS Critical Alert"
             targetNamespace="http://camunda.org/schema/1.0/dmn">

  <!--
    ═══════════════════════════════════════════════════════════════════════════
    EWS-PEWS-001: PEWS Critical Score Alert (>=5)
    Version: 1.0.0 (2026-02-06)
    Clinical Domain: Pediatric Emergency / Pediatric Critical Care
    ═══════════════════════════════════════════════════════════════════════════

    TRIGGER CONDITIONS:
    - PEWS total score >= 5 points
    - Any single component score = 3 (critical finding)

    CLINICAL ACTIONS REQUIRED:
    - Immediate medical review by pediatrician/intensivist
    - Continuous monitoring
    - Consider PICU transfer
    - Notify parents

    EVIDENCE BASE:
    - Brighton PEWS validation (Monaghan 2005)
    - PEWS >= 5: Sensitivity 78% for PICU admission
    - Specificity 95% for clinical deterioration
    ═══════════════════════════════════════════════════════════════════════════
  -->

  <decision id="Decision_EWS_PEWS_001" name="PEWS Critical Score Evaluation">
    <decisionTable id="DecisionTable_EWS_PEWS_001" hitPolicy="FIRST">

      <!-- INPUT 1: PEWS Total Score (0-9 range) -->
      <input id="Input_1" label="PEWS Score Total">
        <inputExpression id="InputExpression_1" typeRef="number">
          <text>pewsScoreTotal</text>
        </inputExpression>
      </input>

      <!-- INPUT 2: Has Any Component = 3 -->
      <input id="Input_2" label="Componente Score 3">
        <inputExpression id="InputExpression_2" typeRef="boolean">
          <text>hasComponenteScore3</text>
        </inputExpression>
      </input>

      <!-- INPUT 3: Patient Age (months) -->
      <input id="Input_3" label="Idade Meses">
        <inputExpression id="InputExpression_3" typeRef="number">
          <text>idadeMeses</text>
        </inputExpression>
      </input>

      <!-- INPUT 4: Has Chronic Condition -->
      <input id="Input_4" label="Doenca Cronica">
        <inputExpression id="InputExpression_4" typeRef="boolean">
          <text>doencaCronica</text>
        </inputExpression>
      </input>

      <!-- OUTPUT 1: Alert Level -->
      <output id="Output_1" label="Nivel Alerta" name="nivelAlerta" typeRef="string">
        <outputValues id="OutputValues_1">
          <text>"Alerta", "Atencao", "Informativo", "OK", "Revisar"</text>
        </outputValues>
      </output>

      <!-- OUTPUT 2: Urgency -->
      <output id="Output_2" label="Urgencia" name="urgencia" typeRef="string">
        <outputValues id="OutputValues_2">
          <text>"IMEDIATA", "URGENTE", "ROTINA", "INFORMATIVA"</text>
        </outputValues>
      </output>

      <!-- OUTPUT 3: Required Action -->
      <output id="Output_3" label="Acao Requerida" name="acaoRequerida" typeRef="string"/>

      <!-- OUTPUT 4: Clinical Justification -->
      <output id="Output_4" label="Justificativa Cientifica" name="justificativaCientifica" typeRef="string"/>

      <!-- RULE 1: CRITICAL - PEWS >= 5 (High Risk) -->
      <rule id="Rule_Critical_Score5">
        <description>PEWS score >=5 indicates high risk requiring immediate response</description>
        <inputEntry id="InputEntry_1_1">
          <text>&gt;= 5</text>
        </inputEntry>
        <inputEntry id="InputEntry_1_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_1_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_1_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_1_1">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_1_2">
          <text>"IMEDIATA"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_1_3">
          <text>"EMERGENCIA PEDIATRICA. PEWS critico. Avaliacao IMEDIATA por pediatra/intensivista. Monitoramento continuo. Acesso venoso se ausente. Preparar equipamentos de emergencia (tamanho pediatrico). Notificar UTI Pediatrica. Comunicar pais."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_1_4">
          <text>"PEWS >=5 tem sensibilidade 78% para admissao em UTIP e especificidade 95% para deterioracao clinica (Monaghan 2005). Criancas podem descompensar rapidamente. Intervencao precoce e essencial."</text>
        </outputEntry>
      </rule>

      <!-- RULE 2: CRITICAL - Any component = 3 -->
      <rule id="Rule_Critical_Component3">
        <description>Any single PEWS component scoring 3 is critical regardless of total</description>
        <inputEntry id="InputEntry_2_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_2_2">
          <text>true</text>
        </inputEntry>
        <inputEntry id="InputEntry_2_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_2_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_2_1">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_2_2">
          <text>"IMEDIATA"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_2_3">
          <text>"ACHADO CRITICO ISOLADO. Componente PEWS = 3 (nao responsivo, palidez/cianose, ou apneia/gasping). Equipe de emergencia pediatrica IMEDIATAMENTE. Avaliar ABC. Preparar ressuscitacao. UTIP em alerta."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_2_4">
          <text>"Score 3 em qualquer componente indica falencia de sistema: comportamento (coma/nao responsivo), cardiovascular (choque), respiratorio (falencia respiratoria). Requer intervencao imediata independente do score total."</text>
        </outputEntry>
      </rule>

      <!-- RULE 3: HIGH RISK - Infant (<12 months) with PEWS 4 -->
      <rule id="Rule_HighRisk_Infant">
        <description>Infants have less reserve - lower threshold for concern</description>
        <inputEntry id="InputEntry_3_1">
          <text>4</text>
        </inputEntry>
        <inputEntry id="InputEntry_3_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_3_3">
          <text>&lt; 12</text>
        </inputEntry>
        <inputEntry id="InputEntry_3_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_3_1">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_3_2">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_3_3">
          <text>"LACTENTE em risco. PEWS 4 em menor de 12 meses requer atencao imediata. Lactentes tem menor reserva fisiologica. Avaliacao pediatrica em 30 minutos. Monitorar frequencia cardiaca, respiratoria e perfusao. Manter aquecido."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_3_4">
          <text>"Lactentes &lt;12 meses tem reservas fisiologicas limitadas e podem deteriorar em minutos. PEWS 4 em lactente equivale a risco de PEWS 5 em crianca maior. Limiar mais baixo para intervencao e apropriado."</text>
        </outputEntry>
      </rule>

      <!-- RULE 4: HIGH RISK - Chronic condition with PEWS 4 -->
      <rule id="Rule_HighRisk_ChronicCondition">
        <description>Children with chronic conditions have altered baselines</description>
        <inputEntry id="InputEntry_4_1">
          <text>4</text>
        </inputEntry>
        <inputEntry id="InputEntry_4_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_4_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_4_4">
          <text>true</text>
        </inputEntry>
        <outputEntry id="OutputEntry_4_1">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_4_2">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_4_3">
          <text>"Crianca com doenca cronica e PEWS elevado. Comparar com baseline habitual. Revisar condicao de base. Contactar especialista se necessario. Doencas cronicas (cardiopatia, neuropatia, pneumopatia) reduzem reserva. Monitorar de perto."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_4_4">
          <text>"Criancas com doencas cronicas podem ter parametros basais alterados mas tambem menor capacidade de compensacao. PEWS deve ser interpretado no contexto da doenca de base. Mudanca do baseline e mais significativa."</text>
        </outputEntry>
      </rule>

      <!-- RULE 5: FALLBACK -->
      <rule id="Rule_Fallback_EWS_PEWS_001">
        <description>Dados incompletos ou score invalido</description>
        <inputEntry id="InputEntry_F_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_F_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_F_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_F_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_F_1">
          <text>"Revisar"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_F_2">
          <text>"ROTINA"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_F_3">
          <text>"Verificar calculo do PEWS. Confirmar avaliacao completa dos 3 componentes (comportamento, cardiovascular, respiratorio). Usar tabela de referencia por idade para sinais vitais pediatricos."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_F_4">
          <text>"PEWS depende de avaliacao adequada. Parametros vitais pediatricos variam por idade. Consultar tabelas de referencia. PEWS nao substitui julgamento clinico - se preocupado, escalar independente do score."</text>
        </outputEntry>
      </rule>

    </decisionTable>
  </decision>

  <dmndi:DMNDI>
    <dmndi:DMNDiagram id="DMNDiagram_EWS_PEWS_001">
      <dmndi:DMNShape id="DMNShape_Decision_EWS_PEWS_001" dmnElementRef="Decision_EWS_PEWS_001">
        <dc:Bounds height="80" width="180" x="160" y="100"/>
      </dmndi:DMNShape>
    </dmndi:DMNDiagram>
  </dmndi:DMNDI>

</definitions>
