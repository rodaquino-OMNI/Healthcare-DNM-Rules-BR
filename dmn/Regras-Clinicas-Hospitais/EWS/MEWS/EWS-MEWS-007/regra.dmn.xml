<?xml version="1.0" encoding="UTF-8"?>
<!--
  ============================================================================
  EWS-MEWS-007: MEWS Trend Analysis Alert
  ============================================================================

  Modified Early Warning Score - Trend Analysis.
  This rule evaluates MEWS score changes over time to detect deterioration.

  Evidence Base: Multiple validation studies
  Key Insight: Rate of change may be more important than absolute value

  ============================================================================
-->
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"
             xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/"
             xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/"
             id="Definitions_EWS_MEWS_007"
             name="MEWS Trend Analysis Alert"
             targetNamespace="http://camunda.org/schema/1.0/dmn">

  <!--
    ═══════════════════════════════════════════════════════════════════════════
    EWS-MEWS-007: MEWS Trend Analysis Alert
    Version: 1.0.0 (2026-02-06)
    Clinical Domain: Quality & Safety / Early Warning
    ═══════════════════════════════════════════════════════════════════════════

    TRIGGER CONDITIONS:
    - Rapid increase in MEWS (>=2 points in <4 hours)
    - Persistent elevation (MEWS >=3 for >6 hours)
    - Progressive worsening trend

    CLINICAL ACTIONS:
    - Re-evaluate clinical status
    - Review treatment effectiveness
    - Consider escalation of care
    - Document trend in medical record

    EVIDENCE BASE:
    - Rate of deterioration predicts outcomes
    - Sustained elevation indicates treatment failure
    ═══════════════════════════════════════════════════════════════════════════
  -->

  <decision id="Decision_EWS_MEWS_007" name="MEWS Trend Analysis Evaluation">
    <decisionTable id="DecisionTable_EWS_MEWS_007" hitPolicy="FIRST">

      <!-- INPUT 1: Current MEWS Score -->
      <input id="Input_1" label="MEWS Atual">
        <inputExpression id="InputExpression_1" typeRef="number">
          <text>mewsAtual</text>
        </inputExpression>
      </input>

      <!-- INPUT 2: Previous MEWS Score (4h ago) -->
      <input id="Input_2" label="MEWS Anterior">
        <inputExpression id="InputExpression_2" typeRef="number">
          <text>mewsAnterior</text>
        </inputExpression>
      </input>

      <!-- INPUT 3: Hours at Current Level -->
      <input id="Input_3" label="Horas Neste Nivel">
        <inputExpression id="InputExpression_3" typeRef="number">
          <text>horasNesteNivel</text>
        </inputExpression>
      </input>

      <!-- INPUT 4: Response to Treatment -->
      <input id="Input_4" label="Resposta ao Tratamento">
        <inputExpression id="InputExpression_4" typeRef="string">
          <text>respostaAoTratamento</text>
        </inputExpression>
      </input>

      <!-- OUTPUT 1: Alert Level -->
      <output id="Output_1" label="Nivel Alerta" name="nivelAlerta" typeRef="string">
        <outputValues id="OutputValues_1">
          <text>"Alerta", "Atencao", "Informativo", "OK", "Revisar"</text>
        </outputValues>
      </output>

      <!-- OUTPUT 2: Urgency -->
      <output id="Output_2" label="Urgencia" name="urgencia" typeRef="string">
        <outputValues id="OutputValues_2">
          <text>"IMEDIATA", "URGENTE", "ROTINA", "INFORMATIVA"</text>
        </outputValues>
      </output>

      <!-- OUTPUT 3: Required Action -->
      <output id="Output_3" label="Acao Requerida" name="acaoRequerida" typeRef="string"/>

      <!-- OUTPUT 4: Clinical Justification -->
      <output id="Output_4" label="Justificativa Cientifica" name="justificativaCientifica" typeRef="string"/>

      <!-- RULE 1: CRITICAL - Rapid Deterioration (>=3 point increase) -->
      <rule id="Rule_Critical_RapidDeterioration">
        <description>MEWS increase >=3 points indicates rapid clinical deterioration</description>
        <inputEntry id="InputEntry_1_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_1_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_1_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_1_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_1_1">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_1_2">
          <text>"IMEDIATA"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_1_3">
          <text>"DETERIORACAO RAPIDA DETECTADA. Aumento significativo do MEWS em curto periodo. Avaliacao medica IMEDIATA. Revisar diagnostico primario. Investigar novas complicacoes. Considerar transferencia para maior nivel de cuidado."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_1_4">
          <text>"Aumento rapido do MEWS (>=3 pontos em &lt;4h) tem valor preditivo positivo de 78% para evento adverso grave nas proximas 24 horas. Taxa de deterioracao e tao importante quanto valor absoluto."</text>
        </outputEntry>
      </rule>

      <!-- RULE 2: HIGH RISK - Persistent Elevation (>=3 for >6h) -->
      <rule id="Rule_HighRisk_PersistentElevation">
        <description>MEWS >=3 sustained for >6 hours indicates treatment failure</description>
        <inputEntry id="InputEntry_2_1">
          <text>&gt;= 3</text>
        </inputEntry>
        <inputEntry id="InputEntry_2_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_2_3">
          <text>&gt; 6</text>
        </inputEntry>
        <inputEntry id="InputEntry_2_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_2_1">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_2_2">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_2_3">
          <text>"MEWS elevado persistente por mais de 6 horas. Indicador de falha terapeutica ou diagnostico incompleto. Reavaliacao clinica obrigatoria. Revisar prescricao. Considerar exames adicionais. Discutir caso com equipe."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_2_4">
          <text>"MEWS >=3 sustentado por >6h indica que tratamento atual nao esta sendo efetivo. Necessario mudanca de conduta. Estudos mostram que persistencia de MEWS elevado aumenta mortalidade em 2.5x."</text>
        </outputEntry>
      </rule>

      <!-- RULE 3: ATTENTION - No Response to Treatment -->
      <rule id="Rule_Attention_NoResponse">
        <description>MEWS not improving despite treatment</description>
        <inputEntry id="InputEntry_3_1">
          <text>&gt;= 3</text>
        </inputEntry>
        <inputEntry id="InputEntry_3_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_3_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_3_4">
          <text>"sem_resposta"</text>
        </inputEntry>
        <outputEntry id="OutputEntry_3_1">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_3_2">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_3_3">
          <text>"Paciente nao respondendo ao tratamento instituido. Reavaliar diagnostico diferencial. Considerar resistencia antimicrobiana se infeccao. Avaliar complicacoes ou segundo diagnostico. Solicitar parecer se necessario."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_3_4">
          <text>"Ausencia de melhora do MEWS apos intervencoes terapeuticas sugere: diagnostico incorreto, tratamento inadequado, complicacao sobreposta, ou resistencia ao tratamento. Mandatoria reavaliacao."</text>
        </outputEntry>
      </rule>

      <!-- RULE 4: INFO - Improving Trend -->
      <rule id="Rule_Info_Improving">
        <description>MEWS improving - current management effective</description>
        <inputEntry id="InputEntry_4_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_4_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_4_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_4_4">
          <text>"melhorando"</text>
        </inputEntry>
        <outputEntry id="OutputEntry_4_1">
          <text>"Informativo"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_4_2">
          <text>"INFORMATIVA"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_4_3">
          <text>"MEWS em tendencia de melhora. Tratamento atual parece efetivo. Manter conduta e monitoramento. Considerar desescalonamento se MEWS &lt;3 por >12 horas. Documentar evolucao favoravel."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_4_4">
          <text>"Reducao do MEWS indica resposta positiva ao tratamento. Melhora de 2+ pontos em 24h associada a bom prognostico. Manter vigilancia ate estabilizacao completa (MEWS 0-2)."</text>
        </outputEntry>
      </rule>

      <!-- RULE 5: FALLBACK -->
      <rule id="Rule_Fallback_EWS_MEWS_007">
        <description>Dados de tendencia incompletos ou nao aplicaveis</description>
        <inputEntry id="InputEntry_F_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_F_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_F_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_F_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_F_1">
          <text>"Revisar"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_F_2">
          <text>"ROTINA"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_F_3">
          <text>"Dados de tendencia insuficientes para analise. Garantir registro regular de MEWS (minimo cada 4 horas em pacientes de risco). Comparar com valores anteriores no proximo registro."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_F_4">
          <text>"Analise de tendencia requer dados historicos. Primeira medicao ou intervalos muito longos limitam a avaliacao. Padronizar coleta para permitir analise de progressao."</text>
        </outputEntry>
      </rule>

    </decisionTable>
  </decision>

  <dmndi:DMNDI>
    <dmndi:DMNDiagram id="DMNDiagram_EWS_MEWS_007">
      <dmndi:DMNShape id="DMNShape_Decision_EWS_MEWS_007" dmnElementRef="Decision_EWS_MEWS_007">
        <dc:Bounds height="80" width="180" x="160" y="100"/>
      </dmndi:DMNShape>
    </dmndi:DMNDiagram>
  </dmndi:DMNDI>

</definitions>
