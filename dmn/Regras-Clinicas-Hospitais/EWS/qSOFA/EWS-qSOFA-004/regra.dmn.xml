<?xml version="1.0" encoding="UTF-8"?>
<!--
  ============================================================================
  EWS-qSOFA-004: qSOFA for Elderly Patients (>=65 years)
  ============================================================================

  Quick SOFA adapted for elderly patients with modified thresholds.
  Elderly have different baseline parameters and higher risk.

  Evidence Base: Sepsis-3 + Geriatric Medicine literature
  Considerations:
  - Baseline hypotension may be lower
  - Cognitive changes may mask altered mentation
  - Atypical presentations common

  ============================================================================
-->
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"
             xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/"
             xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/"
             id="Definitions_EWS_qSOFA_004"
             name="qSOFA Elderly Alert"
             targetNamespace="http://camunda.org/schema/1.0/dmn">

  <!--
    ═══════════════════════════════════════════════════════════════════════════
    EWS-qSOFA-004: qSOFA for Elderly Patients (>=65 years)
    Version: 1.0.0 (2026-02-06)
    Clinical Domain: Geriatric Medicine / Emergency Medicine
    ═══════════════════════════════════════════════════════════════════════════

    GERIATRIC CONSIDERATIONS:
    - Atypical presentations (confusion without fever)
    - Reduced physiological reserve
    - Polypharmacy effects on vital signs
    - Baseline cognitive impairment

    MODIFIED APPROACH:
    - Lower threshold for investigation
    - Compare to patient's baseline
    - Consider frailty score
    ═══════════════════════════════════════════════════════════════════════════
  -->

  <decision id="Decision_EWS_qSOFA_004" name="qSOFA Elderly Patient Evaluation">
    <decisionTable id="DecisionTable_EWS_qSOFA_004" hitPolicy="FIRST">

      <!-- INPUT 1: Patient Age -->
      <input id="Input_1" label="Idade">
        <inputExpression id="InputExpression_1" typeRef="number">
          <text>idade</text>
        </inputExpression>
      </input>

      <!-- INPUT 2: qSOFA Score -->
      <input id="Input_2" label="qSOFA Score">
        <inputExpression id="InputExpression_2" typeRef="number">
          <text>qsofaScore</text>
        </inputExpression>
      </input>

      <!-- INPUT 3: Change from Baseline Mental Status -->
      <input id="Input_3" label="Mudanca Estado Mental">
        <inputExpression id="InputExpression_3" typeRef="boolean">
          <text>mudancaEstadoMentalBaseline</text>
        </inputExpression>
      </input>

      <!-- INPUT 4: Known Frailty -->
      <input id="Input_4" label="Fragilidade">
        <inputExpression id="InputExpression_4" typeRef="boolean">
          <text>fragilidade</text>
        </inputExpression>
      </input>

      <!-- OUTPUT 1: Alert Level -->
      <output id="Output_1" label="Nivel Alerta" name="nivelAlerta" typeRef="string">
        <outputValues id="OutputValues_1">
          <text>"Alerta", "Atencao", "Informativo", "OK", "Revisar"</text>
        </outputValues>
      </output>

      <!-- OUTPUT 2: Urgency -->
      <output id="Output_2" label="Urgencia" name="urgencia" typeRef="string">
        <outputValues id="OutputValues_2">
          <text>"IMEDIATA", "URGENTE", "ROTINA", "INFORMATIVA"</text>
        </outputValues>
      </output>

      <!-- OUTPUT 3: Required Action -->
      <output id="Output_3" label="Acao Requerida" name="acaoRequerida" typeRef="string"/>

      <!-- OUTPUT 4: Clinical Justification -->
      <output id="Output_4" label="Justificativa Cientifica" name="justificativaCientifica" typeRef="string"/>

      <!-- RULE 1: CRITICAL - Very Elderly (>=80) with qSOFA >=2 -->
      <rule id="Rule_Critical_VeryElderly_qSOFA2">
        <description>Very elderly with positive qSOFA - extremely high risk</description>
        <inputEntry id="InputEntry_1_1">
          <text>&gt;= 80</text>
        </inputEntry>
        <inputEntry id="InputEntry_1_2">
          <text>&gt;= 2</text>
        </inputEntry>
        <inputEntry id="InputEntry_1_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_1_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_1_1">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_1_2">
          <text>"IMEDIATA"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_1_3">
          <text>"IDOSO MUITO IDOSO (>=80) com qSOFA positivo. Risco extremamente elevado. Protocolo sepse IMEDIATO. Considerar limitacao de reserva fisiologica. Discutir metas de cuidado com familia se nao definido. Antibiotico urgente."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_1_4">
          <text>"Pacientes >=80 anos com qSOFA >=2 tem mortalidade 45-55%. Reserva fisiologica severamente limitada. Recuperacao mais lenta e incompleta. Decisoes sobre UTI devem considerar fragilidade e preferencias do paciente."</text>
        </outputEntry>
      </rule>

      <!-- RULE 2: HIGH RISK - Elderly with mental status change -->
      <rule id="Rule_HighRisk_Elderly_MentalChange">
        <description>Elderly with change from baseline mental status - sepsis atypical presentation</description>
        <inputEntry id="InputEntry_2_1">
          <text>&gt;= 65</text>
        </inputEntry>
        <inputEntry id="InputEntry_2_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_2_3">
          <text>true</text>
        </inputEntry>
        <inputEntry id="InputEntry_2_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_2_1">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_2_2">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_2_3">
          <text>"DELIRIUM ou confusao aguda em idoso - considerar sepse mesmo sem febre. Buscar ativamente foco infeccioso (ITU, pneumonia, pele). Hemograma, urina, lactato. Rx torax. Inicio precoce de antibiotico se alta suspeita."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_2_4">
          <text>"Em idosos, confusao aguda (delirium) pode ser o UNICO sinal de sepse - apresentacao atipica em 30-50% dos casos. Febre ausente em 20-30% dos idosos com infeccao grave. Mudanca do baseline e mais importante que GCS absoluto."</text>
        </outputEntry>
      </rule>

      <!-- RULE 3: HIGH RISK - Frail elderly with qSOFA 1 -->
      <rule id="Rule_HighRisk_Frail_qSOFA1">
        <description>Frail elderly with even single qSOFA criterion - lower threshold</description>
        <inputEntry id="InputEntry_3_1">
          <text>&gt;= 65</text>
        </inputEntry>
        <inputEntry id="InputEntry_3_2">
          <text>&gt;= 1</text>
        </inputEntry>
        <inputEntry id="InputEntry_3_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_3_4">
          <text>true</text>
        </inputEntry>
        <outputEntry id="OutputEntry_3_1">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_3_2">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_3_3">
          <text>"Idoso FRAGIL com criterio qSOFA presente. Limiar reduzido para investigacao em frageis. Investigar ativamente infeccao. Monitoramento intensificado. Baixo limiar para antibiotico empirico se suspeita clinica."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_3_4">
          <text>"Fragilidade amplifica risco de desfecho adverso em qualquer nivel de qSOFA. Idosos frageis deterioram mais rapidamente. Um unico criterio qSOFA em fragil equivale a risco de qSOFA >=2 em nao-fragil."</text>
        </outputEntry>
      </rule>

      <!-- RULE 4: ATTENTION - Elderly (65-79) with qSOFA 1 -->
      <rule id="Rule_Attention_Elderly_qSOFA1">
        <description>Elderly with single qSOFA criterion - enhanced monitoring</description>
        <inputEntry id="InputEntry_4_1">
          <text>[65..79]</text>
        </inputEntry>
        <inputEntry id="InputEntry_4_2">
          <text>1</text>
        </inputEntry>
        <inputEntry id="InputEntry_4_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_4_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_4_1">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_4_2">
          <text>"ROTINA"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_4_3">
          <text>"Idoso com 1 criterio qSOFA. Vigilancia aumentada. Reavaliar em 2-4 horas. Investigar possivel infeccao se contexto clinico sugestivo. Comparar com baseline do paciente. Orientar equipe para mudancas sutis."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_4_4">
          <text>"Em idosos 65-79 anos, qSOFA 1 merece atencao especial devido a menor reserva fisiologica. Progressao para qSOFA >=2 pode ser rapida. Monitoramento proximo permite intervencao precoce."</text>
        </outputEntry>
      </rule>

      <!-- RULE 5: FALLBACK -->
      <rule id="Rule_Fallback_EWS_qSOFA_004">
        <description>Paciente nao idoso ou dados incompletos</description>
        <inputEntry id="InputEntry_F_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_F_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_F_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_F_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="OutputEntry_F_1">
          <text>"Revisar"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_F_2">
          <text>"ROTINA"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_F_3">
          <text>"Paciente &lt;65 anos ou dados incompletos. Usar regras qSOFA padrao (EWS-qSOFA-001 a 003). Idade e fator de risco independente mas regras geriatricas aplicam-se especificamente a >=65 anos."</text>
        </outputEntry>
        <outputEntry id="OutputEntry_F_4">
          <text>"Esta regra e especifica para pacientes >=65 anos. Pacientes mais jovens devem ser avaliados pelas regras qSOFA padrao, que ja incorporam os limiares validados pelo Sepsis-3."</text>
        </outputEntry>
      </rule>

    </decisionTable>
  </decision>

  <dmndi:DMNDI>
    <dmndi:DMNDiagram id="DMNDiagram_EWS_qSOFA_004">
      <dmndi:DMNShape id="DMNShape_Decision_EWS_qSOFA_004" dmnElementRef="Decision_EWS_qSOFA_004">
        <dc:Bounds height="80" width="180" x="160" y="100"/>
      </dmndi:DMNShape>
    </dmndi:DMNDiagram>
  </dmndi:DMNDI>

</definitions>
