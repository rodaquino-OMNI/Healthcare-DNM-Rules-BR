<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/" xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/" xmlns:biodi="http://bpmn.io/schema/dmn/biodi/2.0" id="definitions_LAB-ELECTRO-MG-001" name="LAB-ELECTRO-MG-001" namespace="http://camunda.org/schema/1.0/dmn">
  <decision id="decision_LAB_ELECTRO_MG_001" name="Hipomagnesemia Critica">
    <decisionTable id="decisionTable_LAB_ELECTRO_MG_001" hitPolicy="FIRST">
      <input id="input_magnesio" label="Magnesio (mg/dL)">
        <inputExpression id="inputExpression_magnesio" typeRef="number">
          <text>magnesio</text>
        </inputExpression>
      </input>
      <input id="input_uso_diureticos" label="Uso de Diureticos de Alca">
        <inputExpression id="inputExpression_diureticos" typeRef="boolean">
          <text>usoDiureticosAlca</text>
        </inputExpression>
      </input>

      <output id="output_nivelAlerta" label="Nivel de Alerta" name="nivelAlerta" typeRef="string">
        <outputValues id="outputValues_nivelAlerta">
          <text>"Alerta","Atencao","OK"</text>
        </outputValues>
      </output>
      <output id="output_urgencia" label="Urgencia" name="urgencia" typeRef="string">
        <outputValues id="outputValues_urgencia">
          <text>"IMEDIATA","ALTA","MEDIA","BAIXA"</text>
        </outputValues>
      </output>
      <output id="output_classificacao" label="Classificacao" name="classificacao" typeRef="string" />
      <output id="output_tendencia" label="Tendencia" name="tendencia" typeRef="string" />
      <output id="output_acaoRequerida" label="Acao Requerida" name="acaoRequerida" typeRef="string" />
      <output id="output_justificativa" label="Justificativa Cientifica" name="justificativaCientifica" typeRef="string" />

      <!-- Critical hypomagnesemia: Mg <1.0 mg/dL - High risk of arrhythmias -->
      <rule id="rule_001">
        <inputEntry id="inputEntry_001_1">
          <text>&lt; 1.0</text>
        </inputEntry>
        <inputEntry id="inputEntry_001_2">
          <text>-</text>
        </inputEntry>
        <outputEntry id="outputEntry_001_1">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="outputEntry_001_2">
          <text>"IMEDIATA"</text>
        </outputEntry>
        <outputEntry id="outputEntry_001_3">
          <text>"CRITICO_BAIXO"</text>
        </outputEntry>
        <outputEntry id="outputEntry_001_4">
          <text>"PERIGOSAMENTE_BAIXO"</text>
        </outputEntry>
        <outputEntry id="outputEntry_001_5">
          <text>"EMERGENCIA: Hipomagnesemia severa. Sulfato de magnesio 2g IV em 15-20min, seguido de infusao 4-6g em 24h. Monitoramento cardiaco continuo (risco de torsades de pointes). Verificar potassio e calcio (hipoMg causa refratariedade a reposicao de K e Ca). ECG urgente. Avaliar causas: alcoolismo, diureticos, diarreia, IBP cronico."</text>
        </outputEntry>
        <outputEntry id="outputEntry_001_6">
          <text>"Hipomagnesemia severa (&lt;1.0 mg/dL) causa arritmias graves (torsades de pointes, fibrilacao ventricular), especialmente com QT prolongado ou uso de digoxina. Impede correcao eficaz de hipocalemia e hipocalcemia associadas. Reposicao IV e mandatoria."</text>
        </outputEntry>
      </rule>

      <!-- Severe hypomagnesemia with diuretics: 1.0-1.2 mg/dL on loop diuretics -->
      <rule id="rule_002">
        <inputEntry id="inputEntry_002_1">
          <text>[1.0..1.2]</text>
        </inputEntry>
        <inputEntry id="inputEntry_002_2">
          <text>true</text>
        </inputEntry>
        <outputEntry id="outputEntry_002_1">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="outputEntry_002_2">
          <text>"ALTA"</text>
        </outputEntry>
        <outputEntry id="outputEntry_002_3">
          <text>"SEVERO_COM_DIURETICO"</text>
        </outputEntry>
        <outputEntry id="outputEntry_002_4">
          <text>"MUITO_BAIXO"</text>
        </outputEntry>
        <outputEntry id="outputEntry_002_5">
          <text>"Hipomagnesemia em uso de diureticos de alca. Alto risco de arritmias. Considerar reposicao IV. Avaliar necessidade de suplementacao diaria. Considerar adicionar amilorida ou trocar para diuretico poupador de magnesio. Monitorar potassio concomitantemente."</text>
        </outputEntry>
        <outputEntry id="outputEntry_002_6">
          <text>"Diureticos de alca causam perda renal continua de magnesio. Pacientes em uso cronico frequentemente necessitam suplementacao. Hipomagnesemia aumenta toxicidade de digoxina e risco de arritmias."</text>
        </outputEntry>
      </rule>

      <!-- Moderate hypomagnesemia: 1.0-1.2 mg/dL without diuretics -->
      <rule id="rule_003">
        <inputEntry id="inputEntry_003_1">
          <text>[1.0..1.2]</text>
        </inputEntry>
        <inputEntry id="inputEntry_003_2">
          <text>false</text>
        </inputEntry>
        <outputEntry id="outputEntry_003_1">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="outputEntry_003_2">
          <text>"ALTA"</text>
        </outputEntry>
        <outputEntry id="outputEntry_003_3">
          <text>"MODERADO_BAIXO"</text>
        </outputEntry>
        <outputEntry id="outputEntry_003_4">
          <text>"BAIXO"</text>
        </outputEntry>
        <outputEntry id="outputEntry_003_5">
          <text>"Hipomagnesemia moderada. Reposicao oral ou IV conforme sintomas. Investigar causa: ma absorcao, alcoolismo, IBP cronico. Verificar potassio e calcio. ECG se sintomas cardiacos."</text>
        </outputEntry>
        <outputEntry id="outputEntry_003_6">
          <text>"Hipomagnesemia moderada (1.0-1.2 mg/dL) pode ser assintomatica ou causar fadiga, caimbras, tremores. Reposicao oral geralmente suficiente se paciente assintomatico e tolerando VO."</text>
        </outputEntry>
      </rule>

      <!-- Fallback -->
      <rule id="rule_fallback">
        <inputEntry id="inputEntry_fallback_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="inputEntry_fallback_2">
          <text>-</text>
        </inputEntry>
        <outputEntry id="outputEntry_fallback_1">
          <text>"OK"</text>
        </outputEntry>
        <outputEntry id="outputEntry_fallback_2">
          <text>"BAIXA"</text>
        </outputEntry>
        <outputEntry id="outputEntry_fallback_3">
          <text>"FORA_CRITERIO"</text>
        </outputEntry>
        <outputEntry id="outputEntry_fallback_4">
          <text>"NAO_APLICAVEL"</text>
        </outputEntry>
        <outputEntry id="outputEntry_fallback_5">
          <text>"Magnesio nao atende criterio de hipomagnesemia critica desta regra."</text>
        </outputEntry>
        <outputEntry id="outputEntry_fallback_6">
          <text>"Esta regra monitora hipomagnesemia critica com magnesio &lt;1.2 mg/dL."</text>
        </outputEntry>
      </rule>
    </decisionTable>
  </decision>
</definitions>
