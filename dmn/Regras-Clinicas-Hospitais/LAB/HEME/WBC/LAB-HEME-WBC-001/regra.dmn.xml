<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/" xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/" xmlns:biodi="http://bpmn.io/schema/dmn/biodi/2.0" id="definitions_LAB-HEME-WBC-001" name="LAB-HEME-WBC-001" namespace="http://camunda.org/schema/1.0/dmn">
  <decision id="decision_LAB_HEME_WBC_001" name="Leucopenia Critica">
    <decisionTable id="decisionTable_LAB_HEME_WBC_001" hitPolicy="FIRST">
      <input id="input_leucocitos" label="Leucocitos (/uL)">
        <inputExpression id="inputExpression_leucocitos" typeRef="number">
          <text>leucocitos</text>
        </inputExpression>
      </input>
      <input id="input_febre" label="Temperatura (C)">
        <inputExpression id="inputExpression_temp" typeRef="number">
          <text>temperatura</text>
        </inputExpression>
      </input>

      <output id="output_nivelAlerta" label="Nivel de Alerta" name="nivelAlerta" typeRef="string">
        <outputValues id="outputValues_nivelAlerta">
          <text>"Alerta","Atencao","OK"</text>
        </outputValues>
      </output>
      <output id="output_urgencia" label="Urgencia" name="urgencia" typeRef="string">
        <outputValues id="outputValues_urgencia">
          <text>"IMEDIATA","ALTA","MEDIA","BAIXA"</text>
        </outputValues>
      </output>
      <output id="output_classificacao" label="Classificacao" name="classificacao" typeRef="string" />
      <output id="output_tendencia" label="Tendencia" name="tendencia" typeRef="string" />
      <output id="output_acaoRequerida" label="Acao Requerida" name="acaoRequerida" typeRef="string" />
      <output id="output_justificativa" label="Justificativa Cientifica" name="justificativaCientifica" typeRef="string" />

      <!-- Critical leukopenia with fever: Neutropenic fever emergency -->
      <rule id="rule_001">
        <inputEntry id="inputEntry_001_1">
          <text>&lt; 1000</text>
        </inputEntry>
        <inputEntry id="inputEntry_001_2">
          <text>&gt;= 38.0</text>
        </inputEntry>
        <outputEntry id="outputEntry_001_1">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="outputEntry_001_2">
          <text>"IMEDIATA"</text>
        </outputEntry>
        <outputEntry id="outputEntry_001_3">
          <text>"NEUTROPENIA_FEBRIL"</text>
        </outputEntry>
        <outputEntry id="outputEntry_001_4">
          <text>"CRITICO_INFECCAO"</text>
        </outputEntry>
        <outputEntry id="outputEntry_001_5">
          <text>"EMERGENCIA ONCOLOGICA: Neutropenia febril. Antibiotico de amplo espectro IV EM ATE 1 HORA (cefepime, piperacilina-tazobactam ou meropenem). Culturas (sangue x2, urina) ANTES se possivel, mas NAO ATRASAR ATB. Nao fazer toque retal. Isolamento protetor. Considerar G-CSF. Avaliar foco infeccioso (mucosites, cateteres). Notificar onco-hematologista."</text>
        </outputEntry>
        <outputEntry id="outputEntry_001_6">
          <text>"Neutropenia febril (ANC &lt;500 ou WBC &lt;1000 com febre) tem mortalidade de 5-10% se nao tratada rapidamente. Cada hora de atraso no antibiotico aumenta mortalidade. Protocolo de primeira hora e mandatorio. Infeccoes podem progredir rapidamente sem resposta inflamatoria adequada."</text>
        </outputEntry>
      </rule>

      <!-- Critical leukopenia without fever: High risk for infection -->
      <rule id="rule_002">
        <inputEntry id="inputEntry_002_1">
          <text>&lt; 1000</text>
        </inputEntry>
        <inputEntry id="inputEntry_002_2">
          <text>&lt; 38.0</text>
        </inputEntry>
        <outputEntry id="outputEntry_002_1">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="outputEntry_002_2">
          <text>"ALTA"</text>
        </outputEntry>
        <outputEntry id="outputEntry_002_3">
          <text>"NEUTROPENIA_SEVERA"</text>
        </outputEntry>
        <outputEntry id="outputEntry_002_4">
          <text>"CRITICO_BAIXO"</text>
        </outputEntry>
        <outputEntry id="outputEntry_002_5">
          <text>"Neutropenia severa sem febre. Isolamento protetor. Profilaxia antimicrobiana conforme protocolo. Evitar procedimentos invasivos. Monitorar temperatura rigorosamente (qualquer febre e emergencia). Higiene de maos rigorosa. Considerar G-CSF. Investigar causa: quimioterapia, drogas, aplasia medular."</text>
        </outputEntry>
        <outputEntry id="outputEntry_002_6">
          <text>"Neutropenia severa (WBC &lt;1000 ou ANC &lt;500) confere alto risco de infeccoes bacterianas e fungicas graves. Paciente pode evoluir para sepse fulminante em horas. Vigilancia continua para febre e mandatoria."</text>
        </outputEntry>
      </rule>

      <!-- Moderate leukopenia with fever -->
      <rule id="rule_003">
        <inputEntry id="inputEntry_003_1">
          <text>[1000..2000]</text>
        </inputEntry>
        <inputEntry id="inputEntry_003_2">
          <text>&gt;= 38.0</text>
        </inputEntry>
        <outputEntry id="outputEntry_003_1">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="outputEntry_003_2">
          <text>"ALTA"</text>
        </outputEntry>
        <outputEntry id="outputEntry_003_3">
          <text>"LEUCOPENIA_FEBRIL"</text>
        </outputEntry>
        <outputEntry id="outputEntry_003_4">
          <text>"MUITO_BAIXO"</text>
        </outputEntry>
        <outputEntry id="outputEntry_003_5">
          <text>"Leucopenia moderada com febre. Calcular ANC (se &lt;500, tratar como neutropenia febril). Culturas e antibiotico empirico de amplo espectro. Investigar foco infeccioso. Considerar internacao para monitoramento."</text>
        </outputEntry>
        <outputEntry id="outputEntry_003_6">
          <text>"Leucopenia moderada (1000-2000) com febre requer avaliacao do ANC. Se neutrofilos &lt;500, considerar neutropenia febril. Mesmo com ANC &gt;500, pacientes tem risco aumentado de infeccoes."</text>
        </outputEntry>
      </rule>

      <!-- Fallback -->
      <rule id="rule_fallback">
        <inputEntry id="inputEntry_fallback_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="inputEntry_fallback_2">
          <text>-</text>
        </inputEntry>
        <outputEntry id="outputEntry_fallback_1">
          <text>"OK"</text>
        </outputEntry>
        <outputEntry id="outputEntry_fallback_2">
          <text>"BAIXA"</text>
        </outputEntry>
        <outputEntry id="outputEntry_fallback_3">
          <text>"FORA_CRITERIO"</text>
        </outputEntry>
        <outputEntry id="outputEntry_fallback_4">
          <text>"NAO_APLICAVEL"</text>
        </outputEntry>
        <outputEntry id="outputEntry_fallback_5">
          <text>"Leucocitos nao atendem criterio de leucopenia critica desta regra."</text>
        </outputEntry>
        <outputEntry id="outputEntry_fallback_6">
          <text>"Esta regra monitora leucopenia critica com leucocitos &lt;2000/uL."</text>
        </outputEntry>
      </rule>
    </decisionTable>
  </decision>
</definitions>
