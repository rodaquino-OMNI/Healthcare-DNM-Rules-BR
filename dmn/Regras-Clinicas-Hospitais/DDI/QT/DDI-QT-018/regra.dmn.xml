<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/" xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/" xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/" id="DDI_QT_018" name="DDI-QT-018: Hidroxicloroquina + Azitromicina" namespace="http://camunda.org/schema/1.0/dmn">
  <decision id="ddi_qt_018_decision" name="Hidroxicloroquina + Azitromicina QT Prolongation">
    <decisionTable id="ddi_qt_018_table" hitPolicy="FIRST">
      <input id="input_medicamentos_ativos" label="Medicamentos Ativos">
        <inputExpression id="input_expr_medicamentos_ativos" typeRef="string">
          <text>medicamentosAtivos</text>
        </inputExpression>
      </input>
      <input id="input_medicamento_novo" label="Medicamento Novo">
        <inputExpression id="input_expr_medicamento_novo" typeRef="string">
          <text>medicamentoNovo</text>
        </inputExpression>
      </input>
      <input id="input_duracao_azitro" label="Duração Azitromicina (dias)">
        <inputExpression id="input_expr_duracao" typeRef="number">
          <text>duracaoAzitromicina</text>
        </inputExpression>
      </input>
      <input id="input_contexto_clinico" label="Contexto Clínico">
        <inputExpression id="input_expr_contexto" typeRef="string">
          <text>contextoClinico</text>
        </inputExpression>
      </input>

      <output id="output_nivel_alerta" name="nivelAlerta" typeRef="string">
        <outputValues>
          <text>"Alerta","Atencao","OK"</text>
        </outputValues>
      </output>
      <output id="output_urgencia" name="urgencia" typeRef="string">
        <outputValues>
          <text>"IMEDIATA","URGENTE","ROTINA"</text>
        </outputValues>
      </output>
      <output id="output_medicamentos_conflitantes" name="medicamentosConflitantes" typeRef="string" />
      <output id="output_mecanismo_interacao" name="mecanismoInteracao" typeRef="string" />
      <output id="output_acao_requerida" name="acaoRequerida" typeRef="string" />

      <!-- Rule 1: COVID-19 context (controversial, high scrutiny) -->
      <rule id="rule_hcq_azitro_covid">
        <inputEntry id="input_medicamentos_hcq">
          <text>list contains(medicamentosAtivos, "HIDROXICLOROQUINA")</text>
        </inputEntry>
        <inputEntry id="input_novo_azitro">
          <text>"AZITROMICINA"</text>
        </inputEntry>
        <inputEntry id="input_duracao_qualquer">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_contexto_covid">
          <text>"COVID19" or "PNEUMONIA_VIRAL"</text>
        </inputEntry>
        <outputEntry id="output_alerta_covid">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_covid">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_covid">
          <text>"Hidroxicloroquina + Azitromicina (contexto COVID-19)"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_covid">
          <text>"QT aditivo CRÍTICO pacientes graves. HCQ +10-20ms + Azitro +5-15ms. RECOVERY trial (2020) NÃO mostrou benefício HCQ COVID-19. WHO/FDA/EMA NÃO RECOMENDAM associação. Risco Torsades SEM benefício clínico."</text>
        </outputEntry>
        <outputEntry id="output_acao_covid">
          <text>"NÃO RECOMENDAR: (1) HCQ+Azitro NÃO benefício COVID-19 (RECOVERY, SOLIDARITY trials), (2) Risco QT inaceitável sem eficácia, (3) Tratamento COVID: dexametasona, anticoagulação, suporte O2, (4) Se pneumonia bacteriana secundária: ceftriaxona, levofloxacino (sem HCQ), (5) ECG obrigatório se associação inevitável."</text>
        </outputEntry>
      </rule>

      <!-- Rule 2: Lupus/RA context + prolonged azithromycin (>5 days) -->
      <rule id="rule_hcq_azitro_lupus_prolongado">
        <inputEntry id="input_medicamentos_hcq2">
          <text>list contains(medicamentosAtivos, "HIDROXICLOROQUINA")</text>
        </inputEntry>
        <inputEntry id="input_novo_azitro2">
          <text>"AZITROMICINA"</text>
        </inputEntry>
        <inputEntry id="input_duracao_prolongada">
          <text>&gt; 5</text>
        </inputEntry>
        <inputEntry id="input_contexto_lupus">
          <text>"LUPUS" or "ARTRITE_REUMATOIDE"</text>
        </inputEntry>
        <outputEntry id="output_alerta_lupus_prolongado">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_lupus_prolongado">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_lupus_prolongado">
          <text>"Hidroxicloroquina crônica + Azitromicina &gt;5 dias"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_lupus_prolongado">
          <text>"HCQ uso crônico acúmulo tecidual (meia-vida 40 dias). Azitro &gt;5 dias QT +10-15ms (curso prolongado maior risco que curso curto 3-5 dias +5-8ms)."</text>
        </outputEntry>
        <outputEntry id="output_acao_lupus_prolongado">
          <text>"REDUZIR duração azitro: MAX 5 dias. Alternativa antibiótico: doxiciclina 100mg 12/12h (SEM QT), amoxicilina-clavulanato, levofloxacino (QT +5-10ms menor que azitro prolongado). ECG baseline + 7 dias se azitro &gt;5 dias. K+&gt;4.0, Mg&gt;2.0."</text>
        </outputEntry>
      </rule>

      <!-- Rule 3: Lupus/RA context + short azithromycin (≤5 days) -->
      <rule id="rule_hcq_azitro_lupus_curto">
        <inputEntry id="input_medicamentos_hcq3">
          <text>list contains(medicamentosAtivos, "HIDROXICLOROQUINA")</text>
        </inputEntry>
        <inputEntry id="input_novo_azitro3">
          <text>"AZITROMICINA"</text>
        </inputEntry>
        <inputEntry id="input_duracao_curta">
          <text>&lt;= 5</text>
        </inputEntry>
        <inputEntry id="input_contexto_lupus2">
          <text>"LUPUS" or "ARTRITE_REUMATOIDE"</text>
        </inputEntry>
        <outputEntry id="output_alerta_lupus_curto">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_lupus_curto">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_lupus_curto">
          <text>"Hidroxicloroquina crônica + Azitromicina ≤5 dias"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_lupus_curto">
          <text>"QT aditivo moderado. HCQ crônica +10-15ms, Azitro curso curto ≤5 dias +5-8ms (menor que curso prolongado). Risco Torsades baixo."</text>
        </outputEntry>
        <outputEntry id="output_acao_lupus_curto">
          <text>"ACEITÁVEL com precauções: ECG baseline recomendado (opcional se baixo risco). Azitro MAX 5 dias (500mg D1 → 250mg D2-5). K+/Mg normais. Monitorar sintomas (palpitações, tontura). Alternativa: doxiciclina, amoxicilina-clavulanato."</text>
        </outputEntry>
      </rule>

      <!-- Rule 4: HCQ chronic use, alternative antibiotic preferred -->
      <rule id="rule_hcq_alternativa_preferida">
        <inputEntry id="input_medicamentos_hcq4">
          <text>list contains(medicamentosAtivos, "HIDROXICLOROQUINA")</text>
        </inputEntry>
        <inputEntry id="input_novo_azitro4">
          <text>"AZITROMICINA"</text>
        </inputEntry>
        <inputEntry id="input_duracao_qualquer2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_contexto_qualquer">
          <text>-</text>
        </inputEntry>
        <outputEntry id="output_alerta_geral">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_geral">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_geral">
          <text>"Hidroxicloroquina + Azitromicina"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_geral">
          <text>"Prolongamento QT aditivo. HCQ uso crônico acúmulo tecidual (meia-vida 40 dias), QT +10-20ms. Azitro +5-15ms dose/duração dependente."</text>
        </outputEntry>
        <outputEntry id="output_acao_geral">
          <text>"PREFERIR alternativa antibiótico: Doxiciclina 100mg 12/12h (SEM QT), Amoxicilina-clavulanato 875/125mg 12/12h, Levofloxacino 500-750mg/dia (QT menor). Se azitro ESSENCIAL: curso curto ≤5 dias, ECG baseline, K+/Mg normais."</text>
        </outputEntry>
      </rule>

      <!-- Fallback Rule -->
      <rule id="rule_fallback">
        <inputEntry id="input_fallback_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="output_fallback_1">
          <text>"OK"</text>
        </outputEntry>
        <outputEntry id="output_fallback_2">
          <text>"ROTINA"</text>
        </outputEntry>
        <outputEntry id="output_fallback_3">
          <text>""</text>
        </outputEntry>
        <outputEntry id="output_fallback_4">
          <text>""</text>
        </outputEntry>
        <outputEntry id="output_fallback_5">
          <text>""</text>
        </outputEntry>
      </rule>
    </decisionTable>
  </decision>
</definitions>
