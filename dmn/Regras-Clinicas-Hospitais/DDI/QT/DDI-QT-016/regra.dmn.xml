<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/" xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/" xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/" id="DDI_QT_016" name="DDI-QT-016: Escitalopram + Claritromicina" namespace="http://camunda.org/schema/1.0/dmn">
  <decision id="ddi_qt_016_decision" name="Escitalopram + Claritromicina QT Prolongation">
    <decisionTable id="ddi_qt_016_table" hitPolicy="FIRST">
      <input id="input_medicamentos_ativos" label="Medicamentos Ativos">
        <inputExpression id="input_expr_medicamentos_ativos" typeRef="string">
          <text>medicamentosAtivos</text>
        </inputExpression>
      </input>
      <input id="input_medicamento_novo" label="Medicamento Novo">
        <inputExpression id="input_expr_medicamento_novo" typeRef="string">
          <text>medicamentoNovo</text>
        </inputExpression>
      </input>
      <input id="input_dose_escitalopram" label="Dose Escitalopram (mg/dia)">
        <inputExpression id="input_expr_dose" typeRef="number">
          <text>doseEscitalopram</text>
        </inputExpression>
      </input>
      <input id="input_idade" label="Idade (anos)">
        <inputExpression id="input_expr_idade" typeRef="number">
          <text>idade</text>
        </inputExpression>
      </input>

      <output id="output_nivel_alerta" name="nivelAlerta" typeRef="string">
        <outputValues>
          <text>"Alerta","Atencao","OK"</text>
        </outputValues>
      </output>
      <output id="output_urgencia" name="urgencia" typeRef="string">
        <outputValues>
          <text>"IMEDIATA","URGENTE","ROTINA"</text>
        </outputValues>
      </output>
      <output id="output_medicamentos_conflitantes" name="medicamentosConflitantes" typeRef="string" />
      <output id="output_mecanismo_interacao" name="mecanismoInteracao" typeRef="string" />
      <output id="output_acao_requerida" name="acaoRequerida" typeRef="string" />

      <!-- Rule 1: High dose escitalopram (>10mg) + clarithromycin, age >65 -->
      <rule id="rule_escit_alta_claritro_idoso">
        <inputEntry id="input_medicamentos_escit">
          <text>list contains(medicamentosAtivos, "ESCITALOPRAM")</text>
        </inputEntry>
        <inputEntry id="input_novo_claritro">
          <text>"CLARITROMICINA"</text>
        </inputEntry>
        <inputEntry id="input_dose_alta">
          <text>&gt; 10</text>
        </inputEntry>
        <inputEntry id="input_idade_idoso">
          <text>&gt; 65</text>
        </inputEntry>
        <outputEntry id="output_alerta_alta_idoso">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_alta_idoso">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_alta_idoso">
          <text>"Escitalopram &gt;10mg + Claritromicina (idade &gt;65)"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_alta_idoso">
          <text>"QT aditivo CRÍTICO idade &gt;65. Escitalopram 20mg +10ms, Claritromicina +15-20ms (MAIOR QT entre macrolídeos). FDA recomenda MAX 10mg/dia escitalopram &gt;65 anos."</text>
        </outputEntry>
        <outputEntry id="output_acao_alta_idoso">
          <text>"REDUZIR escitalopram MAX 10mg/dia (recomendação FDA &gt;65 anos). ECG baseline + 48h obrigatório. Alternativa antibiótico: azitromicina 5 dias, doxiciclina, amoxicilina-clavulanato. K+&gt;4.0, Mg&gt;2.0. Suspender claritromicina se QTc&gt;500ms."</text>
        </outputEntry>
      </rule>

      <!-- Rule 2: Standard dose escitalopram (≤10mg) + clarithromycin, age >65 -->
      <rule id="rule_escit_padrao_claritro_idoso">
        <inputEntry id="input_medicamentos_escit2">
          <text>list contains(medicamentosAtivos, "ESCITALOPRAM")</text>
        </inputEntry>
        <inputEntry id="input_novo_claritro2">
          <text>"CLARITROMICINA"</text>
        </inputEntry>
        <inputEntry id="input_dose_padrao">
          <text>&lt;= 10</text>
        </inputEntry>
        <inputEntry id="input_idade_idoso2">
          <text>&gt; 65</text>
        </inputEntry>
        <outputEntry id="output_alerta_padrao_idoso">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_padrao_idoso">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_padrao_idoso">
          <text>"Escitalopram ≤10mg + Claritromicina (idade &gt;65)"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_padrao_idoso">
          <text>"QT aditivo moderado. Claritromicina MAIOR QT entre macrolídeos (+15-20ms). Risco aumentado idade &gt;65."</text>
        </outputEntry>
        <outputEntry id="output_acao_padrao_idoso">
          <text>"ECG baseline obrigatório. Curso claritromicina CURTO (5-7 dias). Preferir azitromicina 5 dias ou doxiciclina. K+&gt;4.0, Mg&gt;2.0. Monitorar sintomas (tontura, palpitações). Considerar trocar escitalopram por sertralina se antibiótico prolongado."</text>
        </outputEntry>
      </rule>

      <!-- Rule 3: High dose escitalopram (>10mg) + clarithromycin, age ≤65 -->
      <rule id="rule_escit_alta_claritro_jovem">
        <inputEntry id="input_medicamentos_escit3">
          <text>list contains(medicamentosAtivos, "ESCITALOPRAM")</text>
        </inputEntry>
        <inputEntry id="input_novo_claritro3">
          <text>"CLARITROMICINA"</text>
        </inputEntry>
        <inputEntry id="input_dose_alta2">
          <text>&gt; 10</text>
        </inputEntry>
        <inputEntry id="input_idade_jovem">
          <text>&lt;= 65</text>
        </inputEntry>
        <outputEntry id="output_alerta_alta_jovem">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_alta_jovem">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_alta_jovem">
          <text>"Escitalopram &gt;10mg + Claritromicina"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_alta_jovem">
          <text>"QT aditivo significativo. Escitalopram 20mg +10ms, Claritromicina +15-20ms. Claritromicina possui MAIOR QT entre macrolídeos."</text>
        </outputEntry>
        <outputEntry id="output_acao_alta_jovem">
          <text>"CONSIDERAR reduzir escitalopram para 10mg/dia. ECG baseline + 48h. Alternativa antibiótico: azitromicina 5 dias (menor QT que claritro), doxiciclina. K+/Mg normais. Suspender claritro se QTc&gt;500ms."</text>
        </outputEntry>
      </rule>

      <!-- Rule 4: Standard dose escitalopram (≤10mg) + clarithromycin, age ≤65 -->
      <rule id="rule_escit_padrao_claritro_jovem">
        <inputEntry id="input_medicamentos_escit4">
          <text>list contains(medicamentosAtivos, "ESCITALOPRAM")</text>
        </inputEntry>
        <inputEntry id="input_novo_claritro4">
          <text>"CLARITROMICINA"</text>
        </inputEntry>
        <inputEntry id="input_dose_padrao2">
          <text>&lt;= 10</text>
        </inputEntry>
        <inputEntry id="input_idade_jovem2">
          <text>&lt;= 65</text>
        </inputEntry>
        <outputEntry id="output_alerta_padrao_jovem">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_padrao_jovem">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_padrao_jovem">
          <text>"Escitalopram ≤10mg + Claritromicina"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_padrao_jovem">
          <text>"QT aditivo moderado. Escitalopram 10mg +5ms, Claritromicina +15-20ms. Risco baixo a moderado."</text>
        </outputEntry>
        <outputEntry id="output_acao_padrao_jovem">
          <text>"ACEITÁVEL com precauções: ECG baseline recomendado. Curso claritromicina curto (5-7 dias). Preferir azitromicina 5 dias ou doxiciclina. K+/Mg normais. Monitorar sintomas. Suspender claritro se sintomas."</text>
        </outputEntry>
      </rule>

      <!-- Fallback Rule -->
      <rule id="rule_fallback">
        <inputEntry id="input_fallback_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="output_fallback_1">
          <text>"OK"</text>
        </outputEntry>
        <outputEntry id="output_fallback_2">
          <text>"ROTINA"</text>
        </outputEntry>
        <outputEntry id="output_fallback_3">
          <text>""</text>
        </outputEntry>
        <outputEntry id="output_fallback_4">
          <text>""</text>
        </outputEntry>
        <outputEntry id="output_fallback_5">
          <text>""</text>
        </outputEntry>
      </rule>
    </decisionTable>
  </decision>
</definitions>
