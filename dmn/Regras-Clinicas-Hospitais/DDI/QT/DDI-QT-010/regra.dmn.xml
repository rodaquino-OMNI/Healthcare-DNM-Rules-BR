<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/" xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/" xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/" id="DDI_QT_010" name="DDI-QT-010: Amiodarona + Haloperidol" namespace="http://camunda.org/schema/1.0/dmn">
  <decision id="ddi_qt_010_decision" name="Amiodarona + Haloperidol QT Prolongation">
    <decisionTable id="ddi_qt_010_table" hitPolicy="FIRST">
      <input id="input_medicamentos_ativos" label="Medicamentos Ativos">
        <inputExpression id="input_expr_medicamentos_ativos" typeRef="string">
          <text>medicamentosAtivos</text>
        </inputExpression>
      </input>
      <input id="input_medicamento_novo" label="Medicamento Novo">
        <inputExpression id="input_expr_medicamento_novo" typeRef="string">
          <text>medicamentoNovo</text>
        </inputExpression>
      </input>
      <input id="input_potassio" label="Potássio (mmol/L)">
        <inputExpression id="input_expr_potassio" typeRef="number">
          <text>potassio</text>
        </inputExpression>
      </input>
      <input id="input_historico_qt" label="Histórico QT Longo">
        <inputExpression id="input_expr_historico" typeRef="boolean">
          <text>historicoQTLongo</text>
        </inputExpression>
      </input>

      <output id="output_nivel_alerta" name="nivelAlerta" typeRef="string">
        <outputValues>
          <text>"Alerta","Atencao","OK"</text>
        </outputValues>
      </output>
      <output id="output_urgencia" name="urgencia" typeRef="string">
        <outputValues>
          <text>"IMEDIATA","URGENTE","ROTINA"</text>
        </outputValues>
      </output>
      <output id="output_medicamentos_conflitantes" name="medicamentosConflitantes" typeRef="string" />
      <output id="output_mecanismo_interacao" name="mecanismoInteracao" typeRef="string" />
      <output id="output_acao_requerida" name="acaoRequerida" typeRef="string" />

      <!-- Rule 1: CONTRAINDICATED - Both drugs together -->
      <rule id="rule_amio_halo_contraindicado">
        <inputEntry id="input_medicamentos_amio">
          <text>list contains(medicamentosAtivos, "AMIODARONA")</text>
        </inputEntry>
        <inputEntry id="input_novo_halo">
          <text>"HALOPERIDOL"</text>
        </inputEntry>
        <inputEntry id="input_k_qualquer">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_qt_qualquer">
          <text>-</text>
        </inputEntry>
        <outputEntry id="output_alerta_contraindicado">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_contraindicado">
          <text>"IMEDIATA"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_contraindicado">
          <text>"Amiodarona + Haloperidol (CONTRAINDICADO)"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_contraindicado">
          <text>"Bloqueio aditivo severo canais K+ (IKr/hERG). Amiodarona prolonga QTc 40-60ms + Haloperidol 20-35ms (dose IV &gt;2mg). Risco Torsades de pointes CRITICO, morte súbita documentada."</text>
        </outputEntry>
        <outputEntry id="output_acao_contraindicado">
          <text>"CONTRAINDICAÇÃO ABSOLUTA: (1) NÃO iniciar haloperidol se amiodarona ativa, (2) Alternativas: olanzapina, quetiapina (menor QT), risperidona baixa dose, (3) Se ESSENCIAL: descontinuar amiodarona 30+ dias antes (meia-vida longa), ECG diário, K+&gt;4.5, Mg&gt;2.0, monitorização cardíaca contínua."</text>
        </outputEntry>
      </rule>

      <!-- Rule 2: Haloperidol já ativo, tentativa adicionar amiodarona -->
      <rule id="rule_halo_amio_reverso">
        <inputEntry id="input_medicamentos_halo">
          <text>list contains(medicamentosAtivos, "HALOPERIDOL")</text>
        </inputEntry>
        <inputEntry id="input_novo_amio">
          <text>"AMIODARONA"</text>
        </inputEntry>
        <inputEntry id="input_k_qualquer2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_qt_qualquer2">
          <text>-</text>
        </inputEntry>
        <outputEntry id="output_alerta_reverso">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_reverso">
          <text>"IMEDIATA"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_reverso">
          <text>"Haloperidol + Amiodarona (CONTRAINDICADO)"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_reverso">
          <text>"Associação contraindicada independente da ordem. Risco morte súbita documentado em literatura (FDA black box warning haloperidol IV)."</text>
        </outputEntry>
        <outputEntry id="output_acao_reverso">
          <text>"BLOQUEAR prescrição: (1) Descontinuar haloperidol antes amiodarona, (2) Antiarrítmico alternativo: sotalol evitar (também QT), considerar flecainida/propafenona (sem QT) se apropriado, (3) Antipsicótico alternativo: olanzapina, quetiapina."</text>
        </outputEntry>
      </rule>

      <!-- Fallback Rule -->
      <rule id="rule_fallback">
        <inputEntry id="input_fallback_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="output_fallback_1">
          <text>"OK"</text>
        </outputEntry>
        <outputEntry id="output_fallback_2">
          <text>"ROTINA"</text>
        </outputEntry>
        <outputEntry id="output_fallback_3">
          <text>""</text>
        </outputEntry>
        <outputEntry id="output_fallback_4">
          <text>""</text>
        </outputEntry>
        <outputEntry id="output_fallback_5">
          <text>""</text>
        </outputEntry>
      </rule>
    </decisionTable>
  </decision>
</definitions>
