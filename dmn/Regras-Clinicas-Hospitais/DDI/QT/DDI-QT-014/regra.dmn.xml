<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/" xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/" xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/" id="DDI_QT_014" name="DDI-QT-014: Metadona + Azólicos" namespace="http://camunda.org/schema/1.0/dmn">
  <decision id="ddi_qt_014_decision" name="Metadona + Azólicos QT Prolongation + CYP3A4">
    <decisionTable id="ddi_qt_014_table" hitPolicy="FIRST">
      <input id="input_medicamentos_ativos" label="Medicamentos Ativos">
        <inputExpression id="input_expr_medicamentos_ativos" typeRef="string">
          <text>medicamentosAtivos</text>
        </inputExpression>
      </input>
      <input id="input_medicamento_novo" label="Medicamento Novo">
        <inputExpression id="input_expr_medicamento_novo" typeRef="string">
          <text>medicamentoNovo</text>
        </inputExpression>
      </input>
      <input id="input_dose_metadona" label="Dose Metadona (mg/dia)">
        <inputExpression id="input_expr_dose" typeRef="number">
          <text>doseMetadona</text>
        </inputExpression>
      </input>
      <input id="input_duracao_azol" label="Duração Azólico (dias)">
        <inputExpression id="input_expr_duracao" typeRef="number">
          <text>duracaoAzolico</text>
        </inputExpression>
      </input>

      <output id="output_nivel_alerta" name="nivelAlerta" typeRef="string">
        <outputValues>
          <text>"Alerta","Atencao","OK"</text>
        </outputValues>
      </output>
      <output id="output_urgencia" name="urgencia" typeRef="string">
        <outputValues>
          <text>"IMEDIATA","URGENTE","ROTINA"</text>
        </outputValues>
      </output>
      <output id="output_medicamentos_conflitantes" name="medicamentosConflitantes" typeRef="string" />
      <output id="output_mecanismo_interacao" name="mecanismoInteracao" typeRef="string" />
      <output id="output_acao_requerida" name="acaoRequerida" typeRef="string" />

      <!-- Rule 1: High dose methadone + systemic azole (MAJOR interaction) -->
      <rule id="rule_metadona_alta_azol_sistemico">
        <inputEntry id="input_medicamentos_metadona">
          <text>list contains(medicamentosAtivos, "METADONA")</text>
        </inputEntry>
        <inputEntry id="input_novo_azol_sistemico">
          <text>"FLUCONAZOL" or "ITRACONAZOL" or "VORICONAZOL" or "POSACONAZOL"</text>
        </inputEntry>
        <inputEntry id="input_dose_alta">
          <text>&gt; 100</text>
        </inputEntry>
        <inputEntry id="input_duracao_qualquer">
          <text>-</text>
        </inputEntry>
        <outputEntry id="output_alerta_alta_sistemico">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_alta_sistemico">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_alta_sistemico">
          <text>"Metadona &gt;100mg/dia + Azólico Sistêmico"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_alta_sistemico">
          <text>"DUPLO MECANISMO: (1) QT aditivo - Metadona QT +20-40ms DOSE-DEPENDENTE (&gt;100mg maior risco) + Fluconazol +5-10ms, (2) CYP3A4 - Azólicos inibem metabolismo metadona → níveis DOBRAM → QT adicional +20-30ms. Risco Torsades ALTO."</text>
        </outputEntry>
        <outputEntry id="output_acao_alta_sistemico">
          <text>"MAJOR: (1) REDUZIR metadona 30-50% ao iniciar azólico, (2) ECG baseline + 48h + 7 dias obrigatório, (3) K+&gt;4.5, Mg&gt;2.0, (4) Monitorar sedação excessiva (toxicidade opioid), (5) Considerar antifúngico alternativo: terbinafina (dor ungueal), anfotericina (infecção grave), (6) Suspender azólico se QTc&gt;500ms."</text>
        </outputEntry>
      </rule>

      <!-- Rule 2: Standard dose methadone + systemic azole -->
      <rule id="rule_metadona_padrao_azol_sistemico">
        <inputEntry id="input_medicamentos_metadona2">
          <text>list contains(medicamentosAtivos, "METADONA")</text>
        </inputEntry>
        <inputEntry id="input_novo_azol_sistemico2">
          <text>"FLUCONAZOL" or "ITRACONAZOL" or "VORICONAZOL" or "POSACONAZOL"</text>
        </inputEntry>
        <inputEntry id="input_dose_padrao">
          <text>&gt;= 30, &lt;= 100</text>
        </inputEntry>
        <inputEntry id="input_duracao_qualquer2">
          <text>-</text>
        </inputEntry>
        <outputEntry id="output_alerta_padrao_sistemico">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_padrao_sistemico">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_padrao_sistemico">
          <text>"Metadona 30-100mg/dia + Azólico Sistêmico"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_padrao_sistemico">
          <text>"Inibição CYP3A4 → níveis metadona aumentam 50-100%. QT aditivo moderado. Risco Torsades + sedação excessiva."</text>
        </outputEntry>
        <outputEntry id="output_acao_padrao_sistemico">
          <text>"REDUZIR metadona 20-30% profilático ao iniciar azólico, ECG baseline + 7 dias, K+/Mg normais, Monitorar sedação (náusea, sonolência = toxicidade), Considerar fluconazol dose única 150mg (menor interação que doses prolongadas), Naloxona disponível se sedação severa."</text>
        </outputEntry>
      </rule>

      <!-- Rule 3: Methadone + prolonged azole therapy (>7 days) -->
      <rule id="rule_metadona_azol_prolongado">
        <inputEntry id="input_medicamentos_metadona3">
          <text>list contains(medicamentosAtivos, "METADONA")</text>
        </inputEntry>
        <inputEntry id="input_novo_azol_sistemico3">
          <text>"FLUCONAZOL" or "ITRACONAZOL" or "VORICONAZOL"</text>
        </inputEntry>
        <inputEntry id="input_dose_qualquer">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_duracao_longa">
          <text>&gt; 7</text>
        </inputEntry>
        <outputEntry id="output_alerta_prolongado">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_prolongado">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_prolongado">
          <text>"Metadona + Azólico &gt;7 dias"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_prolongado">
          <text>"Terapia prolongada azólico → acúmulo metadona gradual (meia-vida 24-36h) → níveis DOBRAM após 5-7 dias. QT piora progressivamente."</text>
        </outputEntry>
        <outputEntry id="output_acao_prolongado">
          <text>"MONITORAMENTO RIGOROSO: (1) ECG semanal durante terapia azólico, (2) Reduzir metadona 30-50%, (3) Avaliar necessidade terapia prolongada azólico (considerar anfotericina alternativa), (4) Sintomas toxicidade: miose, sonolência, náusea = reduzir metadona adicional, (5) QTc &gt;500ms: suspender azólico."</text>
        </outputEntry>
      </rule>

      <!-- Rule 4: Methadone + topical/low-dose azole -->
      <rule id="rule_metadona_azol_topico">
        <inputEntry id="input_medicamentos_metadona4">
          <text>list contains(medicamentosAtivos, "METADONA")</text>
        </inputEntry>
        <inputEntry id="input_novo_azol_topico">
          <text>"CLOTRIMAZOL_TOPICO" or "MICONAZOL_TOPICO" or "FLUCONAZOL" and duracaoAzolico &lt;= 3</text>
        </inputEntry>
        <inputEntry id="input_dose_qualquer2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_duracao_curta">
          <text>&lt;= 3</text>
        </inputEntry>
        <outputEntry id="output_alerta_topico">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_topico">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_topico">
          <text>"Metadona + Azólico Tópico/Dose Única"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_topico">
          <text>"Azólicos tópicos absorção mínima sistêmica. Fluconazol dose única 150mg inibição CYP3A4 transitória (48-72h)."</text>
        </outputEntry>
        <outputEntry id="output_acao_topico">
          <text>"BAIXO RISCO: (1) Azólico tópico (creme, óvulo) absorção mínima - OK usar, (2) Fluconazol 150mg dose única - ECG opcional, monitorar sintomas 48-72h, (3) K+/Mg normais, (4) Não reduzir dose metadona profilaticamente."</text>
        </outputEntry>
      </rule>

      <!-- Fallback Rule -->
      <rule id="rule_fallback">
        <inputEntry id="input_fallback_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="output_fallback_1">
          <text>"OK"</text>
        </outputEntry>
        <outputEntry id="output_fallback_2">
          <text>"ROTINA"</text>
        </outputEntry>
        <outputEntry id="output_fallback_3">
          <text>""</text>
        </outputEntry>
        <outputEntry id="output_fallback_4">
          <text>""</text>
        </outputEntry>
        <outputEntry id="output_fallback_5">
          <text>""</text>
        </outputEntry>
      </rule>
    </decisionTable>
  </decision>
</definitions>
