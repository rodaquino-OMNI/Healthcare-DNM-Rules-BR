<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/" xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/" xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/" id="DDI_QT_011" name="DDI-QT-011: Amiodarona + Ondansetron" namespace="http://camunda.org/schema/1.0/dmn">
  <decision id="ddi_qt_011_decision" name="Amiodarona + Ondansetron QT Prolongation">
    <decisionTable id="ddi_qt_011_table" hitPolicy="FIRST">
      <input id="input_medicamentos_ativos" label="Medicamentos Ativos">
        <inputExpression id="input_expr_medicamentos_ativos" typeRef="string">
          <text>medicamentosAtivos</text>
        </inputExpression>
      </input>
      <input id="input_medicamento_novo" label="Medicamento Novo">
        <inputExpression id="input_expr_medicamento_novo" typeRef="string">
          <text>medicamentoNovo</text>
        </inputExpression>
      </input>
      <input id="input_dose_ondansetron" label="Dose Ondansetron (mg)">
        <inputExpression id="input_expr_dose" typeRef="number">
          <text>doseOndansetron</text>
        </inputExpression>
      </input>
      <input id="input_via_administracao" label="Via Administração">
        <inputExpression id="input_expr_via" typeRef="string">
          <text>viaAdministracao</text>
        </inputExpression>
      </input>

      <output id="output_nivel_alerta" name="nivelAlerta" typeRef="string">
        <outputValues>
          <text>"Alerta","Atencao","OK"</text>
        </outputValues>
      </output>
      <output id="output_urgencia" name="urgencia" typeRef="string">
        <outputValues>
          <text>"IMEDIATA","URGENTE","ROTINA"</text>
        </outputValues>
      </output>
      <output id="output_medicamentos_conflitantes" name="medicamentosConflitantes" typeRef="string" />
      <output id="output_mecanismo_interacao" name="mecanismoInteracao" typeRef="string" />
      <output id="output_acao_requerida" name="acaoRequerida" typeRef="string" />

      <!-- Rule 1: High dose IV ondansetron (>16mg or single 32mg) -->
      <rule id="rule_amio_ondan_dose_alta">
        <inputEntry id="input_medicamentos_amio">
          <text>list contains(medicamentosAtivos, "AMIODARONA")</text>
        </inputEntry>
        <inputEntry id="input_novo_ondan">
          <text>"ONDANSETRON"</text>
        </inputEntry>
        <inputEntry id="input_dose_alta">
          <text>&gt;= 16</text>
        </inputEntry>
        <inputEntry id="input_via_iv">
          <text>"IV"</text>
        </inputEntry>
        <outputEntry id="output_alerta_alta">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_alta">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_alta">
          <text>"Amiodarona + Ondansetron IV &gt;16mg"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_alta">
          <text>"Bloqueio aditivo canais K+ (IKr). Ondansetron DOSE-DEPENDENTE: 32mg dose única FDA RETIRADA (2012) por Torsades. Amiodarona QT +40-60ms, Ondansetron IV &gt;16mg +20ms."</text>
        </outputEntry>
        <outputEntry id="output_acao_alta">
          <text>"REDUZIR dose ondansetron: MAX 8mg dose única IV. Alternativa: ondansetron 8mg VO (menor QT que IV), metoclopramida 10mg, dexametasona 4-8mg. ECG se dose &gt;8mg inevitável. Suspender se QTc&gt;500ms."</text>
        </outputEntry>
      </rule>

      <!-- Rule 2: Standard dose IV ondansetron (8mg) -->
      <rule id="rule_amio_ondan_dose_padrao">
        <inputEntry id="input_medicamentos_amio2">
          <text>list contains(medicamentosAtivos, "AMIODARONA")</text>
        </inputEntry>
        <inputEntry id="input_novo_ondan2">
          <text>"ONDANSETRON"</text>
        </inputEntry>
        <inputEntry id="input_dose_padrao">
          <text>&gt;= 4, &lt; 16</text>
        </inputEntry>
        <inputEntry id="input_via_iv2">
          <text>"IV"</text>
        </inputEntry>
        <outputEntry id="output_alerta_padrao">
          <text>"Alerta"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_padrao">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_padrao">
          <text>"Amiodarona + Ondansetron IV 4-8mg"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_padrao">
          <text>"Prolongamento QT moderado. Ondansetron 8mg IV prolonga QT ~10-15ms. Risco Torsades baixo mas documentado."</text>
        </outputEntry>
        <outputEntry id="output_acao_padrao">
          <text>"MONITORAR: (1) Limitar ondansetron 8mg/dose, MAX 16mg/dia, (2) Preferir via VO se possível (menor QT), (3) K+ e Mg normais, (4) ECG baseline se múltiplas doses, (5) Considerar metoclopramida alternativa."</text>
        </outputEntry>
      </rule>

      <!-- Rule 3: Oral ondansetron (lower risk) -->
      <rule id="rule_amio_ondan_vo">
        <inputEntry id="input_medicamentos_amio3">
          <text>list contains(medicamentosAtivos, "AMIODARONA")</text>
        </inputEntry>
        <inputEntry id="input_novo_ondan3">
          <text>"ONDANSETRON"</text>
        </inputEntry>
        <inputEntry id="input_dose_qualquer">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_via_vo">
          <text>"VO"</text>
        </inputEntry>
        <outputEntry id="output_alerta_vo">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_vo">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_vo">
          <text>"Amiodarona + Ondansetron VO"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_vo">
          <text>"Via oral possui menor efeito QT que IV (absorção gradual, menor pico sérico). Risco Torsades mínimo."</text>
        </outputEntry>
        <outputEntry id="output_acao_vo">
          <text>"ACEITÁVEL com precauções: Ondansetron 8mg VO até 16mg/dia OK. Manter K+/Mg normais. ECG apenas se sintomas (palpitações, tontura). Alternativa: bromoprida, dexametasona."</text>
        </outputEntry>
      </rule>

      <!-- Fallback Rule -->
      <rule id="rule_fallback">
        <inputEntry id="input_fallback_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="output_fallback_1">
          <text>"OK"</text>
        </outputEntry>
        <outputEntry id="output_fallback_2">
          <text>"ROTINA"</text>
        </outputEntry>
        <outputEntry id="output_fallback_3">
          <text>""</text>
        </outputEntry>
        <outputEntry id="output_fallback_4">
          <text>""</text>
        </outputEntry>
        <outputEntry id="output_fallback_5">
          <text>""</text>
        </outputEntry>
      </rule>
    </decisionTable>
  </decision>
</definitions>
