<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/" xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/" xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/" id="DDI_BLEED_012" name="DDI-BLEED-012: Enoxaparina + Clopidogrel" namespace="http://camunda.org/schema/1.0/dmn">
  <decision id="ddi_bleed_012_decision" name="Enoxaparin + Clopidogrel SCA Context">
    <decisionTable id="ddi_bleed_012_table" hitPolicy="FIRST">
      <input id="input_medicamentos_ativos" label="Medicamentos Ativos">
        <inputExpression id="input_expr_medicamentos_ativos" typeRef="string">
          <text>medicamentosAtivos</text>
        </inputExpression>
      </input>
      <input id="input_medicamento_novo" label="Medicamento Novo">
        <inputExpression id="input_expr_medicamento_novo" typeRef="string">
          <text>medicamentoNovo</text>
        </inputExpression>
      </input>
      <input id="input_diagnostico" label="Diagnóstico">
        <inputExpression id="input_expr_diagnostico" typeRef="string">
          <text>diagnostico</text>
        </inputExpression>
      </input>
      <input id="input_peso" label="Peso (kg)">
        <inputExpression id="input_expr_peso" typeRef="number">
          <text>peso</text>
        </inputExpression>
      </input>

      <output id="output_nivel_alerta" name="nivelAlerta" typeRef="string">
        <outputValues>
          <text>"Alerta","Atencao","Informativo","OK"</text>
        </outputValues>
      </output>
      <output id="output_urgencia" name="urgencia" typeRef="string">
        <outputValues>
          <text>"IMEDIATA","URGENTE","ROTINA"</text>
        </outputValues>
      </output>
      <output id="output_medicamentos_conflitantes" name="medicamentosConflitantes" typeRef="string" />
      <output id="output_mecanismo_interacao" name="mecanismoInteracao" typeRef="string" />
      <output id="output_acao_requerida" name="acaoRequerida" typeRef="string" />

      <!-- Rule 1: Enoxaparina + Clopidogrel em contexto SCA (JUSTIFICADO) -->
      <rule id="rule_enox_clopi_sca">
        <inputEntry id="input_medicamentos_enox">
          <text>list contains(medicamentosAtivos, "ENOXAPARINA") or list contains(medicamentosAtivos, "HEPARINA BAIXO PESO MOLECULAR")</text>
        </inputEntry>
        <inputEntry id="input_novo_clopi">
          <text>"CLOPIDOGREL"</text>
        </inputEntry>
        <inputEntry id="input_diagnostico_sca">
          <text>"SINDROME CORONARIANA AGUDA" or "SCA" or "IAM" or "INFARTO AGUDO MIOCARDIO" or "ANGINA INSTAVEL" or "NSTEMI" or "STEMI"</text>
        </inputEntry>
        <inputEntry id="input_peso_any">
          <text>-</text>
        </inputEntry>
        <outputEntry id="output_alerta_sca">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_sca">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_sca">
          <text>"Enoxaparina + Clopidogrel (SCA - protocolo)"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_sca">
          <text>"TRIPLA antitrombose JUSTIFICADA em SCA: (1) Enoxaparina (anticoagulante) inibe fator Xa → bloqueio cascata coagulação, (2) Clopidogrel (antiplaquetário P2Y12) inibe agregação plaquetária via ADP, (3) Aspirina (geralmente associada) inibe COX-1. BENEFÍCIO supera risco sangramento em SCA aguda. Risco sangramento MAIOR 2-3x mas redução eventos isquêmicos 30-40%."</text>
        </outputEntry>
        <outputEntry id="output_acao_sca">
          <text>"PROTOCOLO SCA: (1) Enoxaparina 1mg/kg SC 12/12h (máximo 7-8 dias ou até revascularização), (2) Clopidogrel dose ataque 300-600mg → 75mg/dia, (3) Aspirina 100-200mg/dia, (4) IBP obrigatório (omeprazol 20mg/dia - reduz sangramento GI 50%), (5) Monitorar Hb diariamente, (6) Suspender enoxaparina 24h ANTES ICP programada (evitar sangramento cateter), (7) EVITAR dose enoxaparina >1mg/kg em obesos (usar peso ajustado)."</text>
        </outputEntry>
      </rule>

      <!-- Rule 2: Enoxaparina + Clopidogrel FORA contexto SCA -->
      <rule id="rule_enox_clopi_sem_sca">
        <inputEntry id="input_medicamentos_enox_ss">
          <text>list contains(medicamentosAtivos, "ENOXAPARINA") or list contains(medicamentosAtivos, "HEPARINA BAIXO PESO MOLECULAR")</text>
        </inputEntry>
        <inputEntry id="input_novo_clopi_ss">
          <text>"CLOPIDOGREL"</text>
        </inputEntry>
        <inputEntry id="input_diagnostico_nao_sca">
          <text>not("SINDROME CORONARIANA AGUDA" or "SCA" or "IAM" or "INFARTO AGUDO MIOCARDIO" or "ANGINA INSTAVEL")</text>
        </inputEntry>
        <inputEntry id="input_peso_any_ss">
          <text>-</text>
        </inputEntry>
        <outputEntry id="output_alerta_ss">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_ss">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_ss">
          <text>"Enoxaparina + Clopidogrel (sem indicação SCA)"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_ss">
          <text>"Dupla antitrombose SEM indicação clara = risco-benefício QUESTIONÁVEL. Sangramento MAIOR aumentado 2-3x sem benefício cardiovascular comprovado. Reavaliar necessidade."</text>
        </outputEntry>
        <outputEntry id="output_acao_ss">
          <text>"REAVALIAR indicação: (1) Enoxaparina para TEV profilaxia? Dose: 40mg SC/dia (NÃO 1mg/kg), clopidogrel geralmente desnecessário, (2) Enoxaparina terapêutica para TEV tratamento? Considerar suspender clopidogrel OU reduzir dose (75mg → 37.5mg off-label), (3) Se AMBOS essenciais: IBP obrigatório, monitorar Hb semanalmente, duração mínima possível, (4) Considerar switch para anticoagulação oral (DOAC ou warfarin) e suspender enoxaparina."</text>
        </outputEntry>
      </rule>

      <!-- Rule 3: Enoxaparina dose excessiva + Clopidogrel -->
      <rule id="rule_enox_dose_alta">
        <inputEntry id="input_medicamentos_enox_da">
          <text>list contains(medicamentosAtivos, "ENOXAPARINA") or list contains(medicamentosAtivos, "HEPARINA BAIXO PESO MOLECULAR")</text>
        </inputEntry>
        <inputEntry id="input_novo_clopi_da">
          <text>"CLOPIDOGREL"</text>
        </inputEntry>
        <inputEntry id="input_diagnostico_any_da">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_peso_extremo">
          <text>&lt; 50 or &gt; 120</text>
        </inputEntry>
        <outputEntry id="output_alerta_da">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_da">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_da">
          <text>"Enoxaparina + Clopidogrel (peso extremo)"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_da">
          <text>"RISCO DOSAGEM: Peso extremo requer ajuste dose enoxaparina. (1) Baixo peso (&lt;50kg): risco SOBREDOSAGEM → sangramento, (2) Obesidade (&gt;120kg): usar PESO AJUSTADO (não peso total) = peso ideal + 0.4*(peso real - peso ideal). Dose excessiva + clopidogrel = sangramento GRAVE."</text>
        </outputEntry>
        <outputEntry id="output_acao_da">
          <text>"AJUSTAR DOSE: (1) Baixo peso (&lt;50kg): enoxaparina 1mg/kg SC 12/12h SEM arredondar para cima, considerar anti-Xa 4h após dose (alvo 0.5-1.0), (2) Obesidade (IMC &gt;40): usar PESO AJUSTADO: Peso ideal (homem: 50 + 2.3*polegadas acima 5 pés; mulher: 45.5 + 2.3*polegadas) + 0.4*(peso real - peso ideal), (3) IBP obrigatório, (4) Monitorar Hb a cada 48h, (5) Considerar fondaparinux como alternativa (dose fixa peso-dependente: 5mg &lt;50kg, 7.5mg 50-100kg, 10mg &gt;100kg)."</text>
        </outputEntry>
      </rule>

      <!-- Fallback Rule -->
      <rule id="rule_fallback">
        <inputEntry id="input_fallback_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="output_fallback_1">
          <text>"OK"</text>
        </outputEntry>
        <outputEntry id="output_fallback_2">
          <text>"ROTINA"</text>
        </outputEntry>
        <outputEntry id="output_fallback_3">
          <text>""</text>
        </outputEntry>
        <outputEntry id="output_fallback_4">
          <text>""</text>
        </outputEntry>
        <outputEntry id="output_fallback_5">
          <text>""</text>
        </outputEntry>
      </rule>
    </decisionTable>
  </decision>
</definitions>
