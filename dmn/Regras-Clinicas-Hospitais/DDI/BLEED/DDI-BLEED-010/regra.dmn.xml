<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/" xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/" xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/" id="DDI_BLEED_010" name="DDI-BLEED-010: Varfarina + Aspirina" namespace="http://camunda.org/schema/1.0/dmn">
  <decision id="ddi_bleed_010_decision" name="Warfarin + Aspirin Dual Antithrombotic Review">
    <decisionTable id="ddi_bleed_010_table" hitPolicy="FIRST">
      <input id="input_medicamentos_ativos" label="Medicamentos Ativos">
        <inputExpression id="input_expr_medicamentos_ativos" typeRef="string">
          <text>medicamentosAtivos</text>
        </inputExpression>
      </input>
      <input id="input_medicamento_novo" label="Medicamento Novo">
        <inputExpression id="input_expr_medicamento_novo" typeRef="string">
          <text>medicamentoNovo</text>
        </inputExpression>
      </input>
      <input id="input_indicacao" label="Indicação">
        <inputExpression id="input_expr_indicacao" typeRef="string">
          <text>indicacao</text>
        </inputExpression>
      </input>
      <input id="input_idade" label="Idade (anos)">
        <inputExpression id="input_expr_idade" typeRef="number">
          <text>idade</text>
        </inputExpression>
      </input>

      <output id="output_nivel_alerta" name="nivelAlerta" typeRef="string">
        <outputValues>
          <text>"Alerta","Atencao","Informativo","OK"</text>
        </outputValues>
      </output>
      <output id="output_urgencia" name="urgencia" typeRef="string">
        <outputValues>
          <text>"IMEDIATA","URGENTE","ROTINA"</text>
        </outputValues>
      </output>
      <output id="output_medicamentos_conflitantes" name="medicamentosConflitantes" typeRef="string" />
      <output id="output_mecanismo_interacao" name="mecanismoInteracao" typeRef="string" />
      <output id="output_acao_requerida" name="acaoRequerida" typeRef="string" />

      <!-- Rule 1: Warfarin + Aspirin em idosos ≥75 anos -->
      <rule id="rule_warf_asa_idoso">
        <inputEntry id="input_medicamentos_warf">
          <text>list contains(medicamentosAtivos, "VARFARINA") or list contains(medicamentosAtivos, "WARFARIN")</text>
        </inputEntry>
        <inputEntry id="input_novo_asa">
          <text>"ASPIRINA" or "AAS" or "ACIDO ACETILSALICILICO"</text>
        </inputEntry>
        <inputEntry id="input_indicacao_any">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_idade_alta">
          <text>&gt;= 75</text>
        </inputEntry>
        <outputEntry id="output_alerta_idoso">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_idoso">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_idoso">
          <text>"Warfarin + Aspirina (idade ≥75 anos)"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_idoso">
          <text>"DUPLA antitrombose: Warfarin inibe síntese fatores coagulação + Aspirina inibe agregação plaquetária (COX-1). Risco sangramento DOBRADO em idosos ≥75 anos. Sangramento intracraniano risco 2-3x maior."</text>
        </outputEntry>
        <outputEntry id="output_acao_idoso">
          <text>"REAVALIAR necessidade dupla terapia: (1) Indicação válida? (prótese valvar mecânica + DAC, FA + SCA recente), (2) Considerar reduzir dose aspirina para 81mg/dia (eficácia similar, menos sangramento), (3) HAS-BLED score (≥3 = alto risco sangramento), (4) INR rigoroso 2.0-2.5 (evitar 3.0), (5) IBP obrigatório (omeprazol 20mg/dia), (6) Monitorar Hb trimestral."</text>
        </outputEntry>
      </rule>

      <!-- Rule 2: Warfarin + Aspirin em adultos <75 anos com indicação válida -->
      <rule id="rule_warf_asa_adulto_indicacao">
        <inputEntry id="input_medicamentos_warf_ad">
          <text>list contains(medicamentosAtivos, "VARFARINA") or list contains(medicamentosAtivos, "WARFARIN")</text>
        </inputEntry>
        <inputEntry id="input_novo_asa_ad">
          <text>"ASPIRINA" or "AAS" or "ACIDO ACETILSALICILICO"</text>
        </inputEntry>
        <inputEntry id="input_indicacao_valida">
          <text>"PROTESE VALVAR MECANICA" or "SINDROME CORONARIANA AGUDA" or "SCA" or "IAM" or "STENT"</text>
        </inputEntry>
        <inputEntry id="input_idade_normal">
          <text>&lt; 75</text>
        </inputEntry>
        <outputEntry id="output_alerta_adulto">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_adulto">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_adulto">
          <text>"Warfarin + Aspirina (indicação válida)"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_adulto">
          <text>"Dupla antitrombose justificada para indicações específicas (prótese valvar mecânica + DAC, FA + SCA). Risco sangramento aumentado mas aceitável se monitorado."</text>
        </outputEntry>
        <outputEntry id="output_acao_adulto">
          <text>"CONDUTA: (1) Dose aspirina 81mg/dia (não exceder 100mg), (2) INR alvo 2.0-2.5 (mais baixo que monoterapia), (3) IBP profilático (omeprazol 20mg/dia), (4) Limitar duração aspirina conforme protocolo (SCA: 12 meses pós-evento), (5) HAS-BLED score antes iniciar, (6) Reavaliar necessidade tripla terapia se clopidogrel também prescrito."</text>
        </outputEntry>
      </rule>

      <!-- Rule 3: Warfarin + Aspirin sem indicação clara -->
      <rule id="rule_warf_asa_sem_indicacao">
        <inputEntry id="input_medicamentos_warf_si">
          <text>list contains(medicamentosAtivos, "VARFARINA") or list contains(medicamentosAtivos, "WARFARIN")</text>
        </inputEntry>
        <inputEntry id="input_novo_asa_si">
          <text>"ASPIRINA" or "AAS" or "ACIDO ACETILSALICILICO"</text>
        </inputEntry>
        <inputEntry id="input_indicacao_inespecifica">
          <text>not("PROTESE VALVAR MECANICA" or "SINDROME CORONARIANA AGUDA" or "SCA" or "IAM" or "STENT")</text>
        </inputEntry>
        <inputEntry id="input_idade_any_si">
          <text>-</text>
        </inputEntry>
        <outputEntry id="output_alerta_si">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_si">
          <text>"URGENTE"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_si">
          <text>"Warfarin + Aspirina (sem indicação estabelecida)"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_si">
          <text>"Dupla antitrombose sem indicação formal = risco-benefício NEGATIVO. Sangramento maior aumenta 2x sem benefício cardiovascular adicional na maioria cenários."</text>
        </outputEntry>
        <outputEntry id="output_acao_si">
          <text>"EVITAR associação: Suspender aspirina se warfarin suficiente para indicação (FA, TEV). Warfarin SOZINHO eficaz para prevenção AVC em FA (CHA2DS2-VASc ≥2). Aspirina NÃO adiciona benefício e AUMENTA sangramento. Exceções raras: prótese valvar mecânica + DAC grave."</text>
        </outputEntry>
      </rule>

      <!-- Fallback Rule -->
      <rule id="rule_fallback">
        <inputEntry id="input_fallback_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_4">
          <text>-</text>
        </inputEntry>
        <outputEntry id="output_fallback_1">
          <text>"OK"</text>
        </outputEntry>
        <outputEntry id="output_fallback_2">
          <text>"ROTINA"</text>
        </outputEntry>
        <outputEntry id="output_fallback_3">
          <text>""</text>
        </outputEntry>
        <outputEntry id="output_fallback_4">
          <text>""</text>
        </outputEntry>
        <outputEntry id="output_fallback_5">
          <text>""</text>
        </outputEntry>
      </rule>
    </decisionTable>
  </decision>
</definitions>
