<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/" xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/" xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/" id="DDI_BLEED_016" name="DDI-BLEED-016: SSRIs + Anticoagulantes" namespace="http://camunda.org/schema/1.0/dmn">
  <decision id="ddi_bleed_016_decision" name="SSRIs + Anticoagulants Bleeding Risk">
    <decisionTable id="ddi_bleed_016_table" hitPolicy="FIRST">
      <input id="input_medicamentos_ativos" label="Medicamentos Ativos">
        <inputExpression id="input_expr_medicamentos_ativos" typeRef="string">
          <text>medicamentosAtivos</text>
        </inputExpression>
      </input>
      <input id="input_medicamento_novo" label="Medicamento Novo">
        <inputExpression id="input_expr_medicamento_novo" typeRef="string">
          <text>medicamentoNovo</text>
        </inputExpression>
      </input>
      <input id="input_idade" label="Idade (anos)">
        <inputExpression id="input_expr_idade" typeRef="number">
          <text>idade</text>
        </inputExpression>
      </input>

      <output id="output_nivel_alerta" name="nivelAlerta" typeRef="string">
        <outputValues>
          <text>"Alerta","Atencao","Informativo","OK"</text>
        </outputValues>
      </output>
      <output id="output_urgencia" name="urgencia" typeRef="string">
        <outputValues>
          <text>"IMEDIATA","URGENTE","ROTINA"</text>
        </outputValues>
      </output>
      <output id="output_medicamentos_conflitantes" name="medicamentosConflitantes" typeRef="string" />
      <output id="output_mecanismo_interacao" name="mecanismoInteracao" typeRef="string" />
      <output id="output_acao_requerida" name="acaoRequerida" typeRef="string" />

      <!-- Rule 1: SSRI + Anticoagulante em idosos ≥65 anos -->
      <rule id="rule_ssri_anticoag_idoso">
        <inputEntry id="input_medicamentos_ssri">
          <text>list contains(medicamentosAtivos, "FLUOXETINA") or list contains(medicamentosAtivos, "SERTRALINA") or list contains(medicamentosAtivos, "PAROXETINA") or list contains(medicamentosAtivos, "CITALOPRAM") or list contains(medicamentosAtivos, "ESCITALOPRAM") or list contains(medicamentosAtivos, "FLUVOXAMINA")</text>
        </inputEntry>
        <inputEntry id="input_novo_anticoag">
          <text>"VARFARINA" or "WARFARIN" or "APIXABANA" or "RIVAROXABANA" or "DABIGATRANA" or "EDOXABANA"</text>
        </inputEntry>
        <inputEntry id="input_idade_alta">
          <text>&gt;= 65</text>
        </inputEntry>
        <outputEntry id="output_alerta_idoso">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_idoso">
          <text>"ROTINA"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_idoso">
          <text>"SSRI + Anticoagulante (idade ≥65 anos)"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_idoso">
          <text>"Risco sangramento GI/intracraniano 1.5-2.0x aumentado. Mecanismo: (1) SSRIs bloqueiam recaptação serotonina neuronal → DEPLEÇÃO serotonina PLAQUETÁRIA (serotonina essencial agregação plaquetária), (2) Plaquetas NÃO sintetizam serotonina (captam da circulação via SERT - transportador bloqueado por SSRI), (3) Resultado: disfunção agregação plaquetária LEVE mas SIGNIFICATIVA quando combinada anticoagulação. Risco MAIOR em idosos (múltiplos antitrombóticos, fragilidade vascular)."</text>
        </outputEntry>
        <outputEntry id="output_acao_idoso">
          <text>"MONITORAMENTO: (1) IBP profilático OBRIGATÓRIO (omeprazol 20mg/dia - reduz sangramento GI 50%), (2) Monitorar Hb trimestral, (3) Educar sinais sangramento (melena, hematomas), (4) Considerar antidepressivo alternativo se múltiplos fatores risco sangramento: mirtazapina 15-45mg/noite (sedativo, NÃO afeta plaquetas) OU bupropiona 150-300mg/dia (ativante, NÃO afeta plaquetas), (5) Se SSRI essencial: preferir citalopram/escitalopram (MENOR efeito plaquetário vs fluoxetina/paroxetina)."</text>
        </outputEntry>
      </rule>

      <!-- Rule 2: SSRI + Anticoagulante em adultos <65 anos -->
      <rule id="rule_ssri_anticoag_adulto">
        <inputEntry id="input_medicamentos_ssri_ad">
          <text>list contains(medicamentosAtivos, "FLUOXETINA") or list contains(medicamentosAtivos, "SERTRALINA") or list contains(medicamentosAtivos, "PAROXETINA") or list contains(medicamentosAtivos, "CITALOPRAM") or list contains(medicamentosAtivos, "ESCITALOPRAM") or list contains(medicamentosAtivos, "FLUVOXAMINA")</text>
        </inputEntry>
        <inputEntry id="input_novo_anticoag_ad">
          <text>"VARFARINA" or "WARFARIN" or "APIXABANA" or "RIVAROXABANA" or "DABIGATRANA" or "EDOXABANA"</text>
        </inputEntry>
        <inputEntry id="input_idade_normal">
          <text>&lt; 65</text>
        </inputEntry>
        <outputEntry id="output_alerta_adulto">
          <text>"Atencao"</text>
        </outputEntry>
        <outputEntry id="output_urgencia_adulto">
          <text>"ROTINA"</text>
        </outputEntry>
        <outputEntry id="output_conflitantes_adulto">
          <text>"SSRI + Anticoagulante"</text>
        </outputEntry>
        <outputEntry id="output_mecanismo_adulto">
          <text>"Risco sangramento 1.3-1.5x aumentado vs anticoagulante isolado. SSRIs causam disfunção plaquetária LEVE (depleção serotonina intra-plaquetária). Risco ACEITÁVEL se monitorado."</text>
        </outputEntry>
        <outputEntry id="output_acao_adulto">
          <text>"PRECAUÇÕES: (1) IBP se fatores risco GI: idade >50, úlcera prévia, múltiplos antitrombóticos (omeprazol 20mg/dia), (2) Monitorar sinais sangramento, (3) Evitar associação SSRI + aspirina + anticoagulante (tripla → risco 3-4x), (4) Preferir SSRIs menor potência inibição SERT: citalopram 20mg/dia, escitalopram 10mg/dia (vs fluoxetina/paroxetina alta potência)."</text>
        </outputEntry>
      </rule>

      <!-- Fallback Rule -->
      <rule id="rule_fallback">
        <inputEntry id="input_fallback_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="input_fallback_3">
          <text>-</text>
        </inputEntry>
        <outputEntry id="output_fallback_1">
          <text>"OK"</text>
        </outputEntry>
        <outputEntry id="output_fallback_2">
          <text>"ROTINA"</text>
        </outputEntry>
        <outputEntry id="output_fallback_3">
          <text>""</text>
        </outputEntry>
        <outputEntry id="output_fallback_4">
          <text>""</text>
        </outputEntry>
        <outputEntry id="output_fallback_5">
          <text>""</text>
        </outputEntry>
      </rule>
    </decisionTable>
  </decision>
</definitions>
