<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"
             id="Definitions_31401104" name="Implante_gerador_pulsos_eletrodos" targetNamespace="http://camunda.org/schema/1.0/dmn">
  <!--
    TUSS 31401104 - Implante de gerador de pulsos para eletrodos cerebrais profundos
    Versao: 3.1.0-LEAN-TIER2 (2026-02-08)

    ENRIQUECIMENTO LEAN TIER-2:
    - Input 6: ultimoProcedimentoDias (frequencia/duplicacao)
    - 3 Regras de desperdicio: ESC (escalada sem falha terapeutica), DUP (troca precoce), DOC (sem laudo neurofisiologico)
    - 5 outputs padronizados: resultado, observacao, fundamentacao, alertasDesperdicio, acaoRecomendada

    Indicacoes Clinicas (DUT/ANS):
    - Segunda etapa do DBS: implante de gerador de pulsos (IPG) subcutâneo
    - Após implante bem-sucedido de eletrodos cerebrais profundos (31401090)
    - Teste intraoperatório dos eletrodos confirmando posicionamento adequado
    - Sem sinais de infecção ou complicações nos eletrodos

    Contraindicacoes:
    - Infecção ativa no sítio cirúrgico dos eletrodos
    - Posicionamento inadequado dos eletrodos (requer revisão)
    - Impedância anormal dos eletrodos
    - Complicações neurológicas persistentes da primeira etapa

    Referencias:
    - Diretrizes ABN 2024
    - Movement Disorder Society Guidelines 2023
    - RN ANS 465/2021
  -->
  <decision id="Decision_31401104" name="Indicacao para Implante de gerador de pulsos">
    <decisionTable id="DecisionTable_31401104" hitPolicy="FIRST">
      <!-- Input 1: Eletrodos previamente implantados -->
      <input id="Input_1" label="Eletrodos Implantados">
        <inputExpression id="InputExpression_1" typeRef="boolean"><text>eletrodosImplantados</text></inputExpression>
      </input>
      <!-- Input 2: Teste de impedância dos eletrodos -->
      <input id="Input_2" label="Impedancia Normal">
        <inputExpression id="InputExpression_2" typeRef="boolean"><text>impedanciaNormal</text></inputExpression>
      </input>
      <!-- Input 3: Ausência de infecção -->
      <input id="Input_3" label="Sem Infeccao">
        <inputExpression id="InputExpression_3" typeRef="boolean"><text>semInfeccao</text></inputExpression>
      </input>
      <!-- Input 4: Laudo neurológico confirmando indicação -->
      <input id="Input_4" label="Laudo Neurologico">
        <inputExpression id="InputExpression_4" typeRef="boolean"><text>laudoNeurologico</text></inputExpression>
      </input>
      <!-- Input 5: Expectativa de Vida Superior a 1 Ano -->
      <input id="Input_5" label="Expectativa de Vida Superior a 1 Ano">
        <inputExpression id="InputExpression_5" typeRef="boolean"><text>expectativaVidaSuperior1Ano</text></inputExpression>
      </input>
      <!-- Input 6: Dias desde ultimo procedimento -->
      <input id="Input_ultimoProcedimentoDias" label="Dias Desde Ultimo Procedimento" camunda:inputVariable="ultimoProcedimentoDias">
        <inputExpression id="InputExpression_ultimoProcedimentoDias" typeRef="integer">
          <text>ultimoProcedimentoDias</text>
        </inputExpression>
      </input>
      <!-- Output 1: Resultado da avaliação -->
      <output id="Output_1" label="Resultado" name="resultado" typeRef="string">
        <outputValues id="OutputValues_1">
          <text>"Aprovado","Reprovado","Pendente"</text>
        </outputValues>
      </output>
      <!-- Output 2: Observação clínica -->
      <output id="Output_2" label="Observacao" name="observacao" typeRef="string"/>
      <!-- Output 3: Fundamentação legal/técnica -->
      <output id="Output_3" label="Fundamentacao" name="fundamentacao" typeRef="string"/>
      <!-- Output 4: Alertas de Desperdicio -->
      <output id="Output_4" label="Alertas de Desperdicio" name="alertasDesperdicio" typeRef="string">
        <outputValues>
          <text>"NENHUM","DUP","FREQ","ESC","DOC","PROT","MULTI"</text>
        </outputValues>
      </output>

      <!-- Output 5: Acao Recomendada -->
      <output id="Output_5" label="Acao Recomendada" name="acaoRecomendada" typeRef="string">
        <outputValues>
          <text>"APROVAR","NEGAR","SOLICITAR_INFO","AGUARDAR_PRAZO","SUGERIR_ALTERNATIVA"</text>
        </outputValues>
      </output>


      <!-- CONTRAINDICATIONS -->
      <rule id="Rule_Contraindicacao_SemEletrodos">
        <inputEntry id="IE_1_1"><text>false</text></inputEntry>
        <inputEntry id="IE_1_2"><text>-</text></inputEntry>
        <inputEntry id="IE_1_3"><text>-</text></inputEntry>
        <inputEntry id="IE_1_4"><text>-</text></inputEntry>
        <inputEntry id="IE_1_5"><text>-</text></inputEntry>
        <inputEntry id="IE_1_6"><text>-</text></inputEntry>
        <outputEntry id="OE_1_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_1_2"><text>"Eletrodos cerebrais não implantados. Primeira etapa (TUSS 31401090) obrigatória antes do gerador de pulsos."</text></outputEntry>
        <outputEntry id="OE_1_3"><text>"Diretrizes ABN 2024 - Procedimento em duas etapas"</text></outputEntry>
        <outputEntry id="OE_Rule_Contraindicacao_SemEletrodos_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_Rule_Contraindicacao_SemEletrodos_5"><text>"NEGAR"</text></outputEntry>
      </rule>
      <rule id="Rule_Contraindicacao_Infeccao">
        <inputEntry id="IE_2_1"><text>true</text></inputEntry>
        <inputEntry id="IE_2_2"><text>-</text></inputEntry>
        <inputEntry id="IE_2_3"><text>false</text></inputEntry>
        <inputEntry id="IE_2_4"><text>-</text></inputEntry>
        <inputEntry id="IE_2_5"><text>-</text></inputEntry>
        <inputEntry id="IE_2_6"><text>-</text></inputEntry>
        <outputEntry id="OE_2_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_2_2"><text>"Infecção ativa no sítio cirúrgico dos eletrodos. Tratamento da infecção obrigatório antes do implante do IPG."</text></outputEntry>
        <outputEntry id="OE_2_3"><text>"RN ANS 465/2021 - Segurança do paciente"</text></outputEntry>
        <outputEntry id="OE_Rule_Contraindicacao_Infeccao_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_Rule_Contraindicacao_Infeccao_5"><text>"NEGAR"</text></outputEntry>
      </rule>
      <rule id="Rule_Contraindicacao_ImpedanciaAnormal">
        <inputEntry id="IE_3_1"><text>true</text></inputEntry>
        <inputEntry id="IE_3_2"><text>false</text></inputEntry>
        <inputEntry id="IE_3_3"><text>true</text></inputEntry>
        <inputEntry id="IE_3_4"><text>-</text></inputEntry>
        <inputEntry id="IE_3_5"><text>-</text></inputEntry>
        <inputEntry id="IE_3_6"><text>-</text></inputEntry>
        <outputEntry id="OE_3_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_3_2"><text>"Impedância anormal dos eletrodos sugere mau posicionamento ou defeito técnico. Revisão dos eletrodos necessária antes do IPG."</text></outputEntry>
        <outputEntry id="OE_3_3"><text>"Diretrizes ABN 2024 - Controle de qualidade técnica"</text></outputEntry>
        <outputEntry id="OE_Rule_Contraindicacao_ImpedanciaAnormal_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_Rule_Contraindicacao_ImpedanciaAnormal_5"><text>"NEGAR"</text></outputEntry>
      </rule>

      <!-- WASTE RULES (LEAN TIER-2) -->
      <rule id="Rule_31401104_ESC_Neuromod">
        <description>ESC: Neuromodulacao sem falha de tratamento medicamentoso</description>
        <inputEntry id="IE_31401104_ESC_NM_1"><text>-</text></inputEntry>
        <inputEntry id="IE_31401104_ESC_NM_2"><text>-</text></inputEntry>
        <inputEntry id="IE_31401104_ESC_NM_3"><text>-</text></inputEntry>
        <inputEntry id="IE_31401104_ESC_NM_4"><text>false</text></inputEntry>
        <inputEntry id="IE_31401104_ESC_NM_5"><text>-</text></inputEntry>
        <inputEntry id="IE_31401104_ESC_NM_6"><text>-</text></inputEntry>
        <outputEntry id="OE_31401104_ESC_NM_1"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_31401104_ESC_NM_2"><text>"Neuromodulacao requer documentacao de falha terapeutica medicamentosa"</text></outputEntry>
        <outputEntry id="OE_31401104_ESC_NM_3"><text>"AANS/CNS 2024 - Neuromodulacao indicada apos falha de terapia medicamentosa"</text></outputEntry>
        <outputEntry id="OE_31401104_ESC_NM_4"><text>"ESC"</text></outputEntry>
        <outputEntry id="OE_31401104_ESC_NM_5"><text>"SUGERIR_ALTERNATIVA"</text></outputEntry>
      </rule>

      <rule id="Rule_31401104_DUP_Implante">
        <description>DUP: Troca de dispositivo em menos de 365 dias sem defeito</description>
        <inputEntry id="IE_31401104_DUP_IMP_1"><text>-</text></inputEntry>
        <inputEntry id="IE_31401104_DUP_IMP_2"><text>-</text></inputEntry>
        <inputEntry id="IE_31401104_DUP_IMP_3"><text>-</text></inputEntry>
        <inputEntry id="IE_31401104_DUP_IMP_4"><text>false</text></inputEntry>
        <inputEntry id="IE_31401104_DUP_IMP_5"><text>-</text></inputEntry>
        <inputEntry id="IE_31401104_DUP_IMP_6"><text>&lt; 365</text></inputEntry>
        <outputEntry id="OE_31401104_DUP_IMP_1"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_31401104_DUP_IMP_2"><text>"Troca de dispositivo em menos de 1 ano. Documentar defeito ou complicacao"</text></outputEntry>
        <outputEntry id="OE_31401104_DUP_IMP_3"><text>"ANS RN 465/2021 - Troca precoce requer justificativa tecnica"</text></outputEntry>
        <outputEntry id="OE_31401104_DUP_IMP_4"><text>"DUP"</text></outputEntry>
        <outputEntry id="OE_31401104_DUP_IMP_5"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

      <rule id="Rule_31401104_DOC_Neurofunc">
        <description>DOC: Implante sem laudo neurofisiologico</description>
        <inputEntry id="IE_31401104_DOC_NF_1"><text>-</text></inputEntry>
        <inputEntry id="IE_31401104_DOC_NF_2"><text>true</text></inputEntry>
        <inputEntry id="IE_31401104_DOC_NF_3"><text>true</text></inputEntry>
        <inputEntry id="IE_31401104_DOC_NF_4"><text>false</text></inputEntry>
        <inputEntry id="IE_31401104_DOC_NF_5"><text>-</text></inputEntry>
        <inputEntry id="IE_31401104_DOC_NF_6"><text>-</text></inputEntry>
        <outputEntry id="OE_31401104_DOC_NF_1"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_31401104_DOC_NF_2"><text>"Implante requer laudo neurofisiologico e escala funcional"</text></outputEntry>
        <outputEntry id="OE_31401104_DOC_NF_3"><text>"AANS/CNS 2024 - Avaliacao neurofisiologica obrigatoria"</text></outputEntry>
        <outputEntry id="OE_31401104_DOC_NF_4"><text>"DOC"</text></outputEntry>
        <outputEntry id="OE_31401104_DOC_NF_5"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

      <!-- APPROVALS -->
      <rule id="Rule_Aprovado_Segunda_Etapa">
        <inputEntry id="IE_4_1"><text>true</text></inputEntry>
        <inputEntry id="IE_4_2"><text>true</text></inputEntry>
        <inputEntry id="IE_4_3"><text>true</text></inputEntry>
        <inputEntry id="IE_4_4"><text>true</text></inputEntry>
        <inputEntry id="IE_4_5"><text>-</text></inputEntry>
        <inputEntry id="IE_4_6"><text>-</text></inputEntry>
        <outputEntry id="OE_4_1"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OE_4_2"><text>"Eletrodos implantados com impedância normal e sem infecção. Segunda etapa do DBS aprovada: implante de gerador de pulsos (IPG) subcutâneo em região infraclavicular ou abdominal."</text></outputEntry>
        <outputEntry id="OE_4_3"><text>"Diretrizes ABN 2024 + Movement Disorder Society 2023"</text></outputEntry>
        <outputEntry id="OE_Rule_Aprovado_Segunda_Etapa_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Rule_Aprovado_Segunda_Etapa_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <!-- FALLBACK RULE -->
      <rule id="Rule_Fallback_31401104">
        <inputEntry id="IE_5_1"><text>-</text></inputEntry>
        <inputEntry id="IE_5_2"><text>-</text></inputEntry>
        <inputEntry id="IE_5_3"><text>-</text></inputEntry>
        <inputEntry id="IE_5_4"><text>-</text></inputEntry>
        <inputEntry id="IE_5_5"><text>-</text></inputEntry>
        <inputEntry id="IE_5_6"><text>-</text></inputEntry>
        <outputEntry id="OE_5_1"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_5_2"><text>"Caso não enquadrado nas regras automáticas. Requer avaliação por neurocirurgião funcional e auditor médico."</text></outputEntry>
        <outputEntry id="OE_5_3"><text>"Análise caso a caso conforme RN ANS 465/2021"</text></outputEntry>
        <outputEntry id="OE_Rule_Fallback_31401104_4"><text>"DOC"</text></outputEntry>
        <outputEntry id="OE_Rule_Fallback_31401104_5"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>
    </decisionTable>
  </decision>
</definitions>
