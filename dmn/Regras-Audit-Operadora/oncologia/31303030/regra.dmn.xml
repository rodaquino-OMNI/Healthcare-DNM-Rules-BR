<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"
             id="Definitions_31303030"
             name="Quimioterapia Ambulatorial"
             targetNamespace="http://camunda.org/schema/1.0/dmn">
  <!--
    TUSS 31303030 - Quimioterapia Ambulatorial
    Procedimento: Quimioterapia em regime ambulatorial (hospital-dia)
    Versao: 3.1.0-LEAN-TIER2 (2026-02-08)

    Indicacoes clinicas DUT/ANS:
    - Neoplasia maligna confirmada histologicamente
    - Protocolo quimioterapico definido por oncologista
    - Performance status adequado (ECOG 0-2)
    - Funcao organica preservada (renal, hepatica, medular)
    - Regime quimioterapico compativel com ambulatorio (baixa emetogenicidade)

    Contraindicacoes:
    - Performance status ruim (ECOG 3-4) - considerar cuidados paliativos
    - Funcao organica inadequada para quimioterapia
    - Protocolo de alta toxicidade que requer internacao
    - Ausencia de protocolo terapeutico definido

    Referencias:
    - Portaria SAS/MS 876/2013 (Diretrizes Oncologia)
    - RN ANS 465/2021 Rol de Procedimentos
    - INCA - Protocolos de Quimioterapia
  -->
  <decision id="Decision_31303030" name="Indicacao para Quimioterapia Ambulatorial [LEAN TIER-2]">
    <decisionTable id="DecisionTable_31303030" hitPolicy="FIRST">
      <!-- Input 1: Diagnostico Oncologico -->
      <input id="Input_1" label="Diagnostico Oncologico CID-10">
        <inputExpression id="InputExpression_1" typeRef="string">
          <text>diagnosticoOncologico</text>
        </inputExpression>
      </input>
      <!-- Input 2: Estadiamento TNM -->
      <input id="Input_2" label="Estadiamento TNM">
        <inputExpression id="InputExpression_2" typeRef="string">
          <text>estadiamento</text>
        </inputExpression>
      </input>
      <!-- Input 3: Linhas de Tratamento -->
      <input id="Input_3" label="Linha de Tratamento">
        <inputExpression id="InputExpression_3" typeRef="number">
          <text>linhasTratamento</text>
        </inputExpression>
      </input>
      <!-- Input 4: Performance Status -->
      <input id="Input_4" label="Performance Status ECOG">
        <inputExpression id="InputExpression_4" typeRef="string">
          <text>performanceStatus</text>
        </inputExpression>
        <inputValues id="InputValues_4">
          <text>"ECOG_0", "ECOG_1", "ECOG_2", "ECOG_3", "ECOG_4"</text>
        </inputValues>
      </input>
      <!-- Input 5: Protocolo Terapeutico -->
      <input id="Input_5" label="Protocolo Terapeutico Anexado">
        <inputExpression id="InputExpression_5" typeRef="boolean">
          <text>protocoloTerapeutico</text>
        </inputExpression>
      </input>
      <!-- Output -->
      <!-- Input: Dias desde ultimo procedimento (DUP detection) -->
      <input id="Input_ultimoProcedimentoDias" label="Dias Desde Ultimo Procedimento">
        <inputExpression id="InputExpression_ultimoProcedimentoDias" typeRef="number">
          <text>ultimoProcedimentoDias</text>
        </inputExpression>
      </input>

      <output id="Output_1" label="Resultado" name="resultado" typeRef="string"/>
      <output id="Output_2" label="Observacao" name="observacao" typeRef="string"/>
      <output id="Output_3" label="Fundamentacao" name="fundamentacao" typeRef="string"/>
      <output id="Output_4" label="Alertas de Desperdicio" name="alertasDesperdicio" typeRef="string">
        <outputValues id="OutputValues_4">
          <text>"NENHUM","DUP","FREQ","ESC","DOC","PROT","MULTI"</text>
        </outputValues>
      </output>
      <output id="Output_5" label="Acao Recomendada" name="acaoRecomendada" typeRef="string">
        <outputValues id="OutputValues_5">
          <text>"APROVAR","NEGAR","SOLICITAR_INFO","AGUARDAR_PRAZO","SUGERIR_ALTERNATIVA"</text>
        </outputValues>
      </output>

      <!-- REGRA 1: Contraindicacao - Performance Status ruim -->
      <rule id="Rule_Contraindicacao_PerformanceRuim">
        <description>ECOG 3-4 contraindicado para quimioterapia agressiva</description>
        <inputEntry id="InputEntry_1_1"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_2_1"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_3_1"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_4_1"><text>"ECOG_3", "ECOG_4"</text></inputEntry>
        <inputEntry id="InputEntry_5_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Rule_Contraindicacao_PerformanceRuim_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OutputEntry_1_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OutputEntry_2_1"><text>"Quimioterapia nao indicada - performance status inadequado (ECOG 3-4). Considerar cuidados paliativos."</text></outputEntry>
        <outputEntry id="OutputEntry_3_1"><text>"Diretrizes INCA - Quimioterapia paliativa requer ECOG 0-2 para beneficio clinico."</text></outputEntry>
        <outputEntry id="OutputEntry_4_1"><text>"PROT"</text></outputEntry>
        <outputEntry id="OutputEntry_5_1"><text>"NEGAR"</text></outputEntry>
      </rule>

      <!-- WASTE DETECTION: DUP -->
      <rule id="Rule_31303030_DUP">
        <description>DUP - Ciclo QT ambulatorial repetido em menos de 21 dias</description>
        <inputEntry id="IE_DUP_31303030_1"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_31303030_2"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_31303030_3"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_31303030_4"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_31303030_5"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_31303030_ultimo"><text>&lt; 21</text></inputEntry>
        <outputEntry id="OE_DUP_31303030_resultado"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_DUP_31303030_observacao"><text>"Ciclo QT ambulatorial repetido em menos de 21 dias"</text></outputEntry>
        <outputEntry id="OE_DUP_31303030_fundamentacao"><text>"NCCN 2024: Intervalo minimo entre ciclos QT 21 dias"</text></outputEntry>
        <outputEntry id="OE_DUP_31303030_alertasDesperdicio"><text>"DUP"</text></outputEntry>
        <outputEntry id="OE_DUP_31303030_acaoRecomendada"><text>"AGUARDAR_PRAZO"</text></outputEntry>
      </rule>

      <!-- WASTE DETECTION: DOC -->
      <rule id="Rule_31303030_DOC">
        <description>DOC - Protocolo quimioterapico nao anexado</description>
        <inputEntry id="IE_DOC_31303030_1"><text>starts with(diagnosticoOncologico, "C")</text></inputEntry>
        <inputEntry id="IE_DOC_31303030_2"><text>-</text></inputEntry>
        <inputEntry id="IE_DOC_31303030_3"><text>-</text></inputEntry>
        <inputEntry id="IE_DOC_31303030_4"><text>"ECOG_0", "ECOG_1", "ECOG_2"</text></inputEntry>
        <inputEntry id="IE_DOC_31303030_5"><text>false</text></inputEntry>
        <inputEntry id="IE_DOC_31303030_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_DOC_31303030_resultado"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_DOC_31303030_observacao"><text>"Protocolo quimioterapico nao anexado. Solicitar protocolo completo com drogas, doses e ciclos"</text></outputEntry>
        <outputEntry id="OE_DOC_31303030_fundamentacao"><text>"RN ANS 465/2021: Quimioterapia requer protocolo terapeutico definido por oncologista"</text></outputEntry>
        <outputEntry id="OE_DOC_31303030_alertasDesperdicio"><text>"DOC"</text></outputEntry>
        <outputEntry id="OE_DOC_31303030_acaoRecomendada"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

      <!-- REGRA 2: Contraindicacao - Sem protocolo terapeutico -->
      <rule id="Rule_Contraindicacao_SemProtocolo">
        <description>Ausencia de protocolo quimioterapico</description>
        <inputEntry id="InputEntry_1_2"><text>starts with(diagnosticoOncologico, "C")</text></inputEntry>
        <inputEntry id="InputEntry_2_2"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_3_2"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_4_2"><text>"ECOG_0", "ECOG_1", "ECOG_2"</text></inputEntry>
        <inputEntry id="InputEntry_5_2"><text>false</text></inputEntry>
        <inputEntry id="IE_Rule_Contraindicacao_SemProtocolo_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OutputEntry_1_2"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OutputEntry_2_2"><text>"Protocolo quimioterapico nao anexado. Solicitar protocolo completo com drogas, doses e ciclos."</text></outputEntry>
        <outputEntry id="OutputEntry_3_2"><text>"RN ANS 465/2021 - Quimioterapia requer protocolo terapeutico definido por oncologista."</text></outputEntry>
        <outputEntry id="OutputEntry_4_2"><text>"DOC"</text></outputEntry>
        <outputEntry id="OutputEntry_5_2"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

      <!-- REGRA 3: Aprovado - Primeira linha de tratamento -->
      <rule id="Rule_Aprovado_PrimeiraLinha">
        <description>Primeira linha de quimioterapia com protocolo</description>
        <inputEntry id="InputEntry_1_3"><text>starts with(diagnosticoOncologico, "C")</text></inputEntry>
        <inputEntry id="InputEntry_2_3"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_3_3"><text>1</text></inputEntry>
        <inputEntry id="InputEntry_4_3"><text>"ECOG_0", "ECOG_1", "ECOG_2"</text></inputEntry>
        <inputEntry id="InputEntry_5_3"><text>true</text></inputEntry>
        <inputEntry id="IE_Rule_Aprovado_PrimeiraLinha_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OutputEntry_1_3"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OutputEntry_2_3"><text>"Aprovado - quimioterapia ambulatorial primeira linha para neoplasia maligna (" + diagnosticoOncologico + ")."</text></outputEntry>
        <outputEntry id="OutputEntry_3_3"><text>"Portaria SAS/MS 876/2013 - Primeira linha de tratamento oncologico."</text></outputEntry>
        <outputEntry id="OutputEntry_4_3"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OutputEntry_5_3"><text>"APROVAR"</text></outputEntry>
      </rule>

      <!-- REGRA 4: Aprovado - Segunda linha de tratamento -->
      <rule id="Rule_Aprovado_SegundaLinha">
        <description>Segunda linha apos progressao documentada</description>
        <inputEntry id="InputEntry_1_4"><text>starts with(diagnosticoOncologico, "C")</text></inputEntry>
        <inputEntry id="InputEntry_2_4"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_3_4"><text>2</text></inputEntry>
        <inputEntry id="InputEntry_4_4"><text>"ECOG_0", "ECOG_1", "ECOG_2"</text></inputEntry>
        <inputEntry id="InputEntry_5_4"><text>true</text></inputEntry>
        <inputEntry id="IE_Rule_Aprovado_SegundaLinha_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OutputEntry_1_4"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OutputEntry_2_4"><text>"Aprovado - segunda linha de quimioterapia ambulatorial apos progressao/refratariedade."</text></outputEntry>
        <outputEntry id="OutputEntry_3_4"><text>"Diretrizes INCA - Segunda linha para doenca progressiva com performance adequado."</text></outputEntry>
        <outputEntry id="OutputEntry_4_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OutputEntry_5_4"><text>"APROVAR"</text></outputEntry>
      </rule>

      <!-- REGRA 5: Aprovado - Terceira linha ou subsequente -->
      <rule id="Rule_Aprovado_LinhasSubsequentes">
        <description>Terceira linha ou mais - requer performance ECOG 0-1</description>
        <inputEntry id="InputEntry_1_5"><text>starts with(diagnosticoOncologico, "C")</text></inputEntry>
        <inputEntry id="InputEntry_2_5"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_3_5"><text>&gt;= 3</text></inputEntry>
        <inputEntry id="InputEntry_4_5"><text>"ECOG_0", "ECOG_1"</text></inputEntry>
        <inputEntry id="InputEntry_5_5"><text>true</text></inputEntry>
        <inputEntry id="IE_Rule_Aprovado_LinhasSubsequentes_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OutputEntry_1_5"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OutputEntry_2_5"><text>"Aprovado - quimioterapia ambulatorial linha avancada. Requer performance ECOG 0-1."</text></outputEntry>
        <outputEntry id="OutputEntry_3_5"><text>"Diretrizes INCA - Linhas avancadas para pacientes com bom performance status."</text></outputEntry>
        <outputEntry id="OutputEntry_4_5"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OutputEntry_5_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <!-- REGRA 6: Pendente - Linhas avancadas com ECOG 2 -->
      <rule id="Rule_Pendente_LinhaAvancadaECOG2">
        <description>Linhas avancadas com ECOG 2 - requer justificativa</description>
        <inputEntry id="InputEntry_1_6"><text>starts with(diagnosticoOncologico, "C")</text></inputEntry>
        <inputEntry id="InputEntry_2_6"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_3_6"><text>&gt;= 3</text></inputEntry>
        <inputEntry id="InputEntry_4_6"><text>"ECOG_2"</text></inputEntry>
        <inputEntry id="InputEntry_5_6"><text>true</text></inputEntry>
        <inputEntry id="IE_Rule_Pendente_LinhaAvancadaECOG2_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OutputEntry_1_6"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OutputEntry_2_6"><text>"Linha avancada com ECOG 2 - requer justificativa do oncologista sobre beneficio esperado vs toxicidade."</text></outputEntry>
        <outputEntry id="OutputEntry_3_6"><text>"Avaliar relacao risco-beneficio para linhas avancadas com performance limitado."</text></outputEntry>
        <outputEntry id="OutputEntry_4_6"><text>"DOC"</text></outputEntry>
        <outputEntry id="OutputEntry_5_6"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

      <!-- REGRA 7: Fallback -->
      <rule id="Rule_Fallback_31303030">
        <description>Dados incompletos - requer avaliacao</description>
        <inputEntry id="InputEntry_1_7"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_2_7"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_3_7"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_4_7"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_5_7"><text>-</text></inputEntry>
        <inputEntry id="IE_Rule_Fallback_31303030_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OutputEntry_1_7"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OutputEntry_2_7"><text>"Dados incompletos. Necessario: (1) CID-10 neoplasia, (2) Estadiamento, (3) Linha de tratamento, (4) ECOG, (5) Protocolo."</text></outputEntry>
        <outputEntry id="OutputEntry_3_7"><text>"Requer avaliacao do auditor medico especializado em oncologia."</text></outputEntry>
        <outputEntry id="OutputEntry_4_7"><text>"DOC"</text></outputEntry>
        <outputEntry id="OutputEntry_5_7"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>
    </decisionTable>
  </decision>
</definitions>
