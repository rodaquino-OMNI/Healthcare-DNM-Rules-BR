<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"
             id="Definitions_31303048"
             name="Quimioterapia em Regime de Internacao"
             targetNamespace="http://camunda.org/schema/1.0/dmn">
  <!--
    TUSS 31303048 - Quimioterapia em Regime de Internacao
    Procedimento: Quimioterapia com internacao hospitalar (alta toxicidade/monitoramento intensivo)
    Versao: 3.1.0-LEAN-TIER2 (2026-02-08)

    Indicacoes clinicas DUT/ANS:
    - Protocolos de alta dose que requerem hidratacao intensiva
    - Regime de hiperemese (alta emetogenicidade) com suporte intravenoso
    - Risco de toxicidade medular grave (neutropenia febril)
    - Comorbidades graves que requerem monitorizacao continua
    - Quimioterapia com infusao continua prolongada (>24h)

    Contraindicacoes:
    - Regime ambulatorial de baixa toxicidade (preferir 31303030)
    - Performance status muito deteriorado (ECOG 4 acamado)
    - Ausencia de protocolo que justifique internacao

    Referencias:
    - Portaria SAS/MS 876/2013 (Diretrizes Oncologia)
    - RN ANS 465/2021 Rol de Procedimentos
    - INCA - Protocolos de Quimioterapia em Internacao
  -->
  <decision id="Decision_31303048" name="Indicacao para Quimioterapia em Regime de Internacao [LEAN TIER-2]">
    <decisionTable id="DecisionTable_31303048" hitPolicy="FIRST">
      <!-- Input 1: Diagnostico Oncologico -->
      <input id="Input_1" label="Diagnostico Oncologico CID-10">
        <inputExpression id="InputExpression_1" typeRef="string">
          <text>diagnosticoOncologico</text>
        </inputExpression>
      </input>
      <!-- Input 2: Estadiamento -->
      <input id="Input_2" label="Estadiamento TNM">
        <inputExpression id="InputExpression_2" typeRef="string">
          <text>estadiamento</text>
        </inputExpression>
      </input>
      <!-- Input 3: Grau de Emetogenicidade -->
      <input id="Input_3" label="Emetogenicidade do Protocolo">
        <inputExpression id="InputExpression_3" typeRef="string">
          <text>grauEmetogenicidade</text>
        </inputExpression>
        <inputValues id="InputValues_3">
          <text>"ALTA", "MODERADA", "BAIXA", "MINIMA"</text>
        </inputValues>
      </input>
      <!-- Input 4: Performance Status -->
      <input id="Input_4" label="Performance Status ECOG">
        <inputExpression id="InputExpression_4" typeRef="string">
          <text>performanceStatus</text>
        </inputExpression>
        <inputValues id="InputValues_4">
          <text>"ECOG_0", "ECOG_1", "ECOG_2", "ECOG_3", "ECOG_4"</text>
        </inputValues>
      </input>
      <!-- Input 5: Protocolo Terapeutico -->
      <input id="Input_5" label="Protocolo com Justificativa de Internacao">
        <inputExpression id="InputExpression_5" typeRef="boolean">
          <text>protocoloTerapeutico</text>
        </inputExpression>
      </input>
      <!-- Output -->
      <!-- Input: Dias desde ultimo procedimento (DUP detection) -->
      <input id="Input_ultimoProcedimentoDias" label="Dias Desde Ultimo Procedimento">
        <inputExpression id="InputExpression_ultimoProcedimentoDias" typeRef="number">
          <text>ultimoProcedimentoDias</text>
        </inputExpression>
      </input>

      <output id="Output_1" label="Resultado" name="resultado" typeRef="string"/>
      <output id="Output_2" label="Observacao" name="observacao" typeRef="string"/>
      <output id="Output_3" label="Fundamentacao" name="fundamentacao" typeRef="string"/>
      <!-- Output 4: Alertas de Desperdicio - Anti-Waste Intelligence -->
      <output id="Output_alertasDesperdicio" label="Alertas de Desperdicio" name="alertasDesperdicio" typeRef="string">
        <outputValues id="OutputValues_alertasDesperdicio">
          <text>"NENHUM","DUP","FREQ","ESC","DOC","PROT","MULTI"</text>
        </outputValues>
      </output>
      <!-- Output 5: Acao Recomendada -->
      <output id="Output_acaoRecomendada" label="Acao Recomendada" name="acaoRecomendada" typeRef="string">
        <outputValues id="OutputValues_acaoRecomendada">
          <text>"APROVAR","NEGAR","SOLICITAR_INFO","AGUARDAR_PRAZO","SUGERIR_ALTERNATIVA"</text>
        </outputValues>
      </output>

      <!-- REGRA 1: Contraindicacao - Performance ECOG 4 -->
      <rule id="Rule_Contraindicacao_ECOG4">
        <description>ECOG 4 contraindicado para quimioterapia agressiva</description>
        <inputEntry id="InputEntry_1_1"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_2_1"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_3_1"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_4_1"><text>"ECOG_4"</text></inputEntry>
        <inputEntry id="InputEntry_5_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Rule_Contraindicacao_ECOG4_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OutputEntry_1_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OutputEntry_2_1"><text>"Quimioterapia nao indicada - paciente acamado (ECOG 4). Considerar exclusivamente cuidados paliativos."</text></outputEntry>
        <outputEntry id="OutputEntry_3_1"><text>"Diretrizes INCA - ECOG 4 contraindicado para quimioterapia ativa."</text></outputEntry>
        <outputEntry id="OE_1_alertasDesperdicio"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_1_acaoRecomendada"><text>"NEGAR"</text></outputEntry>
      </rule>

      <!-- WASTE DETECTION: DUP -->
      <rule id="Rule_31303048_DUP">
        <description>DUP - Ciclo QT internacao repetido em menos de 21 dias</description>
        <inputEntry id="IE_DUP_31303048_1"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_31303048_2"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_31303048_3"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_31303048_4"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_31303048_5"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_31303048_ultimo"><text>&lt; 21</text></inputEntry>
        <outputEntry id="OE_DUP_31303048_resultado"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_DUP_31303048_observacao"><text>"Ciclo QT internacao repetido em menos de 21 dias"</text></outputEntry>
        <outputEntry id="OE_DUP_31303048_fundamentacao"><text>"NCCN 2024: Intervalo minimo entre ciclos QT 21 dias"</text></outputEntry>
        <outputEntry id="OE_DUP_31303048_alertasDesperdicio"><text>"DUP"</text></outputEntry>
        <outputEntry id="OE_DUP_31303048_acaoRecomendada"><text>"AGUARDAR_PRAZO"</text></outputEntry>
      </rule>

      <!-- WASTE DETECTION: DOC -->
      <rule id="Rule_31303048_DOC">
        <description>DOC - Protocolo com justificativa de internacao nao anexado</description>
        <inputEntry id="IE_DOC_31303048_1"><text>starts with(diagnosticoOncologico, "C")</text></inputEntry>
        <inputEntry id="IE_DOC_31303048_2"><text>-</text></inputEntry>
        <inputEntry id="IE_DOC_31303048_3"><text>-</text></inputEntry>
        <inputEntry id="IE_DOC_31303048_4"><text>"ECOG_0", "ECOG_1", "ECOG_2", "ECOG_3"</text></inputEntry>
        <inputEntry id="IE_DOC_31303048_5"><text>false</text></inputEntry>
        <inputEntry id="IE_DOC_31303048_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_DOC_31303048_resultado"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_DOC_31303048_observacao"><text>"Protocolo nao anexado. Solicitar protocolo completo com justificativa clinica para internacao hospitalar"</text></outputEntry>
        <outputEntry id="OE_DOC_31303048_fundamentacao"><text>"RN ANS 465/2021: Internacao requer justificativa de alta toxicidade, monitoramento ou infusao continua"</text></outputEntry>
        <outputEntry id="OE_DOC_31303048_alertasDesperdicio"><text>"DOC"</text></outputEntry>
        <outputEntry id="OE_DOC_31303048_acaoRecomendada"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

      <!-- REGRA 2: Contraindicacao - Sem protocolo justificando internacao -->
      <rule id="Rule_Contraindicacao_SemJustificativa">
        <description>Ausencia de protocolo que justifique internacao</description>
        <inputEntry id="InputEntry_1_2"><text>starts with(diagnosticoOncologico, "C")</text></inputEntry>
        <inputEntry id="InputEntry_2_2"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_3_2"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_4_2"><text>"ECOG_0", "ECOG_1", "ECOG_2", "ECOG_3"</text></inputEntry>
        <inputEntry id="InputEntry_5_2"><text>false</text></inputEntry>
        <inputEntry id="IE_Rule_Contraindicacao_SemJustificativa_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OutputEntry_1_2"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OutputEntry_2_2"><text>"Protocolo nao anexado. Solicitar protocolo completo com justificativa clinica para internacao hospitalar."</text></outputEntry>
        <outputEntry id="OutputEntry_3_2"><text>"RN ANS 465/2021 - Internacao requer justificativa de alta toxicidade, monitoramento ou infusao continua."</text></outputEntry>
        <outputEntry id="OE_2_alertasDesperdicio"><text>"DOC"</text></outputEntry>
        <outputEntry id="OE_2_acaoRecomendada"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

      <!-- REGRA 3: Reprovado - Baixa emetogenicidade (ambulatorio) -->
      <rule id="Rule_Reprovado_BaixaEmetogenicidade">
        <description>Baixa emetogenicidade pode ser ambulatorial</description>
        <inputEntry id="InputEntry_1_3"><text>starts with(diagnosticoOncologico, "C")</text></inputEntry>
        <inputEntry id="InputEntry_2_3"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_3_3"><text>"BAIXA", "MINIMA"</text></inputEntry>
        <inputEntry id="InputEntry_4_3"><text>"ECOG_0", "ECOG_1", "ECOG_2"</text></inputEntry>
        <inputEntry id="InputEntry_5_3"><text>true</text></inputEntry>
        <inputEntry id="IE_Rule_Reprovado_BaixaEmetogenicidade_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OutputEntry_1_3"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OutputEntry_2_3"><text>"Protocolo de baixa emetogenicidade pode ser realizado em regime ambulatorial (TUSS 31303030)."</text></outputEntry>
        <outputEntry id="OutputEntry_3_3"><text>"Diretrizes INCA - Internacao reservada para protocolos de alta toxicidade."</text></outputEntry>
        <outputEntry id="OE_3_alertasDesperdicio"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_3_acaoRecomendada"><text>"SUGERIR_ALTERNATIVA"</text></outputEntry>
      </rule>

      <!-- REGRA 4: Aprovado - Alta emetogenicidade -->
      <rule id="Rule_Aprovado_AltaEmetogenicidade">
        <description>Alta emetogenicidade requer internacao</description>
        <inputEntry id="InputEntry_1_4"><text>starts with(diagnosticoOncologico, "C")</text></inputEntry>
        <inputEntry id="InputEntry_2_4"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_3_4"><text>"ALTA"</text></inputEntry>
        <inputEntry id="InputEntry_4_4"><text>"ECOG_0", "ECOG_1", "ECOG_2", "ECOG_3"</text></inputEntry>
        <inputEntry id="InputEntry_5_4"><text>true</text></inputEntry>
        <inputEntry id="IE_Rule_Aprovado_AltaEmetogenicidade_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OutputEntry_1_4"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OutputEntry_2_4"><text>"Aprovado - quimioterapia de alta emetogenicidade com internacao para suporte antiemetico e hidratacao."</text></outputEntry>
        <outputEntry id="OutputEntry_3_4"><text>"Portaria SAS/MS 876/2013 - Alta emetogenicidade requer suporte hospitalar intensivo."</text></outputEntry>
        <outputEntry id="OE_4_alertasDesperdicio"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_4_acaoRecomendada"><text>"APROVAR"</text></outputEntry>
      </rule>

      <!-- REGRA 5: Aprovado - Moderada emetogenicidade com comorbidades -->
      <rule id="Rule_Aprovado_ModeradaComComorbidades">
        <description>Moderada emetogenicidade com performance limitado</description>
        <inputEntry id="InputEntry_1_5"><text>starts with(diagnosticoOncologico, "C")</text></inputEntry>
        <inputEntry id="InputEntry_2_5"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_3_5"><text>"MODERADA"</text></inputEntry>
        <inputEntry id="InputEntry_4_5"><text>"ECOG_2", "ECOG_3"</text></inputEntry>
        <inputEntry id="InputEntry_5_5"><text>true</text></inputEntry>
        <inputEntry id="IE_Rule_Aprovado_ModeradaComComorbidades_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OutputEntry_1_5"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OutputEntry_2_5"><text>"Aprovado - quimioterapia moderada em paciente com performance limitado requer monitorizacao hospitalar."</text></outputEntry>
        <outputEntry id="OutputEntry_3_5"><text>"Diretrizes INCA - ECOG 2-3 com protocolo moderado justifica internacao para seguranca."</text></outputEntry>
        <outputEntry id="OE_5_alertasDesperdicio"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_5_acaoRecomendada"><text>"APROVAR"</text></outputEntry>
      </rule>

      <!-- REGRA 6: Pendente - Moderada emetogenicidade ECOG 0-1 -->
      <rule id="Rule_Pendente_ModeradaBomPerformance">
        <description>Moderada emetogenicidade com bom performance - avaliar</description>
        <inputEntry id="InputEntry_1_6"><text>starts with(diagnosticoOncologico, "C")</text></inputEntry>
        <inputEntry id="InputEntry_2_6"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_3_6"><text>"MODERADA"</text></inputEntry>
        <inputEntry id="InputEntry_4_6"><text>"ECOG_0", "ECOG_1"</text></inputEntry>
        <inputEntry id="InputEntry_5_6"><text>true</text></inputEntry>
        <inputEntry id="IE_Rule_Pendente_ModeradaBomPerformance_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OutputEntry_1_6"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OutputEntry_2_6"><text>"Protocolo moderado com bom performance - avaliar se ambulatorio (31303030) e suficiente. Justificar internacao."</text></outputEntry>
        <outputEntry id="OutputEntry_3_6"><text>"Avaliar se ha indicacao especifica para internacao (hidratacao intensiva, infusao continua, comorbidades)."</text></outputEntry>
        <outputEntry id="OE_6_alertasDesperdicio"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_6_acaoRecomendada"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

      <!-- REGRA 7: Fallback -->
      <rule id="Rule_Fallback_31303048">
        <description>Dados incompletos - requer avaliacao</description>
        <inputEntry id="InputEntry_1_7"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_2_7"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_3_7"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_4_7"><text>-</text></inputEntry>
        <inputEntry id="InputEntry_5_7"><text>-</text></inputEntry>
        <inputEntry id="IE_Rule_Fallback_31303048_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OutputEntry_1_7"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OutputEntry_2_7"><text>"Dados incompletos. Necessario: (1) CID-10, (2) Estadiamento, (3) Emetogenicidade, (4) ECOG, (5) Protocolo com justificativa."</text></outputEntry>
        <outputEntry id="OutputEntry_3_7"><text>"Requer avaliacao do auditor medico especializado em oncologia."</text></outputEntry>
        <outputEntry id="OE_7_alertasDesperdicio"><text>"DOC"</text></outputEntry>
        <outputEntry id="OE_7_acaoRecomendada"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>
    </decisionTable>
  </decision>
</definitions>
