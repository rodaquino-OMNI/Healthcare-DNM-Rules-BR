<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"
             xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/"
             xmlns:dc="http://www.omg.org/spec/DD/20100524/DC/"
             xmlns:di="http://www.omg.org/spec/DD/20100524/DI/"
             id="Definitions_31401011"
             name="Biopsia_de_tumor"
             targetNamespace="http://camunda.org/schema/1.0/dmn">
  <!--
    TUSS 31401011 - Biopsia de Tumor
    Versao: 3.1.0-LEAN-TIER2 (2026-02-08)

    Indicacoes: Suspeita clinica ou radiologica de neoplasia
    Contraindicacoes: Coagulopatia nao controlada, ausencia de consentimento
    Referencias: ANS/TISS 2024, Diretrizes Oncologicas INCA/SBOC
  -->

  <decision id="Decision_31401011" name="Indicacao para Biopsia de Tumor [LEAN TIER-2]">
    <decisionTable id="DecisionTable_31401011" hitPolicy="FIRST">

      <!-- Input: Suspeita Clinica de Neoplasia -->
      <input id="Input_SuspeitaNeoplasia" label="Suspeita Clinica de Neoplasia">
        <inputExpression id="InputExpression_SuspeitaNeoplasia" typeRef="boolean">
          <text>suspeitaClinicaNeoplasia</text>
        </inputExpression>
      </input>

      <!-- Input: Exame de Imagem com Lesao Suspeita -->
      <input id="Input_ImagemLesaoSuspeita" label="Imagem com Lesao Suspeita">
        <inputExpression id="InputExpression_ImagemLesaoSuspeita" typeRef="boolean">
          <text>imagemComLesaoSuspeita</text>
        </inputExpression>
      </input>

      <!-- Input: Localizacao da Lesao -->
      <input id="Input_LocalizacaoLesao" label="Localizacao da Lesao">
        <inputExpression id="InputExpression_LocalizacaoLesao" typeRef="string">
          <text>localizacaoLesao</text>
        </inputExpression>
      </input>

      <!-- Input: Coagulopatia Nao Controlada -->
      <input id="Input_Coagulopatia" label="Coagulopatia Nao Controlada">
        <inputExpression id="InputExpression_Coagulopatia" typeRef="boolean">
          <text>coagulopatiaNaoControlada</text>
        </inputExpression>
      </input>

      <!-- Input: Consentimento Informado -->
      <input id="Input_Consentimento" label="Consentimento Informado">
        <inputExpression id="InputExpression_Consentimento" typeRef="boolean">
          <text>consentimentoInformado</text>
        </inputExpression>
      </input>

      <!-- TIER-1 Standard Outputs -->
      <!-- Input: Dias desde ultimo procedimento (DUP detection) -->
      <input id="Input_ultimoProcedimentoDias" label="Dias Desde Ultimo Procedimento">
        <inputExpression id="InputExpression_ultimoProcedimentoDias" typeRef="number">
          <text>ultimoProcedimentoDias</text>
        </inputExpression>
      </input>

      <output id="Output_resultado" label="Resultado" name="resultado" typeRef="string">
        <outputValues id="OutputValues_resultado">
          <text>"Aprovado","Reprovado","Pendente"</text>
        </outputValues>
      </output>
      <output id="Output_observacao" label="Observacao" name="observacao" typeRef="string"/>
      <output id="Output_fundamentacao" label="Fundamentacao" name="fundamentacao" typeRef="string"/>
      <!-- Output 4: Alertas de Desperdicio -->
      <output id="Output_alertasDesperdicio" label="Alertas de Desperdicio" name="alertasDesperdicio" typeRef="string">
        <outputValues id="OutputValues_alertasDesperdicio">
          <text>"NENHUM","DUP","FREQ","ESC","DOC","PROT","MULTI"</text>
        </outputValues>
      </output>
      <!-- Output 5: Acao Recomendada -->
      <output id="Output_acaoRecomendada" label="Acao Recomendada" name="acaoRecomendada" typeRef="string">
        <outputValues id="OutputValues_acaoRecomendada">
          <text>"APROVAR","NEGAR","SOLICITAR_INFO","AGUARDAR_PRAZO","SUGERIR_ALTERNATIVA"</text>
        </outputValues>
      </output>

      <!-- CONTRAINDICACOES (FIRST) -->

      <rule id="Rule_Contraindicacao_SemSuspeita">
        <description>Ausencia de suspeita clinica ou radiologica de neoplasia</description>
        <inputEntry id="IE_SemSuspeita_1"><text>false</text></inputEntry>
        <inputEntry id="IE_SemSuspeita_2"><text>-</text></inputEntry>
        <inputEntry id="IE_SemSuspeita_3"><text>-</text></inputEntry>
        <inputEntry id="IE_SemSuspeita_4"><text>-</text></inputEntry>
        <inputEntry id="IE_SemSuspeita_5"><text>-</text></inputEntry>
        <inputEntry id="IE_Rule_Contraindicacao_SemSuspeita_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_SemSuspeita_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_SemSuspeita_2"><text>"Ausencia de suspeita clinica de neoplasia. Biopsia nao indicada sem indicacao anatomopatologica comprovada"</text></outputEntry>
        <outputEntry id="OE_SemSuspeita_3"><text>"RN ANS 465/2021, INCA Diretrizes - Biopsia requer suspeita fundamentada"</text></outputEntry>
        <outputEntry id="OE_SemSuspeita_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_SemSuspeita_5"><text>"NEGAR"</text></outputEntry>
      </rule>

      <rule id="Rule_Contraindicacao_Coagulopatia">
        <description>Coagulopatia nao controlada contraindica biopsia</description>
        <inputEntry id="IE_Coag_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Coag_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Coag_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Coag_4"><text>true</text></inputEntry>
        <inputEntry id="IE_Coag_5"><text>-</text></inputEntry>
        <inputEntry id="IE_Rule_Contraindicacao_Coagulopatia_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Coag_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_Coag_2"><text>"Coagulopatia nao controlada contraindica biopsia. Risco elevado de sangramento. Realizar correcao de coagulacao antes"</text></outputEntry>
        <outputEntry id="OE_Coag_3"><text>"Protocolos Oncologia - Contraindicacao para procedimentos invasivos"</text></outputEntry>
        <outputEntry id="OE_Coag_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_Coag_5"><text>"NEGAR"</text></outputEntry>
      </rule>

      <rule id="Rule_Contraindicacao_SemConsentimento">
        <description>Ausencia de consentimento informado</description>
        <inputEntry id="IE_NoConsent_1"><text>-</text></inputEntry>
        <inputEntry id="IE_NoConsent_2"><text>-</text></inputEntry>
        <inputEntry id="IE_NoConsent_3"><text>-</text></inputEntry>
        <inputEntry id="IE_NoConsent_4"><text>-</text></inputEntry>
        <inputEntry id="IE_NoConsent_5"><text>false</text></inputEntry>
        <inputEntry id="IE_Rule_Contraindicacao_SemConsentimento_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_NoConsent_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_NoConsent_2"><text>"Consentimento informado nao documentado. Requerido documento assinado antes do procedimento"</text></outputEntry>
        <outputEntry id="OE_NoConsent_3"><text>"Resolucion CFM 2000/2013, Lei 8078/1990 (Codigo de Defesa do Consumidor)"</text></outputEntry>
        <outputEntry id="OE_NoConsent_4"><text>"DOC"</text></outputEntry>
        <outputEntry id="OE_NoConsent_5"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

      <!-- WASTE DETECTION: DUP -->
      <rule id="Rule_31401011_DUP">
        <description>DUP - Biopsia tumoral repetida em menos de 30 dias sem justificativa</description>
        <inputEntry id="IE_DUP_31401011_1"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_31401011_2"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_31401011_3"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_31401011_4"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_31401011_5"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_31401011_ultimo"><text>&lt; 30</text></inputEntry>
        <outputEntry id="OE_DUP_31401011_resultado"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_DUP_31401011_observacao"><text>"Biopsia tumoral repetida em menos de 30 dias sem justificativa"</text></outputEntry>
        <outputEntry id="OE_DUP_31401011_fundamentacao"><text>"NCCN 2024: Rebiopsia indicada apenas se material insuficiente ou progressao"</text></outputEntry>
        <outputEntry id="OE_DUP_31401011_alertasDesperdicio"><text>"DUP"</text></outputEntry>
        <outputEntry id="OE_DUP_31401011_acaoRecomendada"><text>"AGUARDAR_PRAZO"</text></outputEntry>
      </rule>


      <!-- APROVACAO RULES -->

      <rule id="Rule_Aprovacao_SuspeitaCompleta">
        <description>Suspeita clinica e radiologica com consentimento e sem coagulopatia</description>
        <inputEntry id="IE_Aprov1_1"><text>true</text></inputEntry>
        <inputEntry id="IE_Aprov1_2"><text>true</text></inputEntry>
        <inputEntry id="IE_Aprov1_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Aprov1_4"><text>false</text></inputEntry>
        <inputEntry id="IE_Aprov1_5"><text>true</text></inputEntry>
        <inputEntry id="IE_Rule_Aprovacao_SuspeitaCompleta_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Aprov1_1"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OE_Aprov1_2"><text>"Suspeita clinica e radiologica de neoplasia com consentimento documentado. Coagulopatia controlada. Biopsia indicada para confirmacao diagnostica"</text></outputEntry>
        <outputEntry id="OE_Aprov1_3"><text>"INCA Diretrizes, ANS RN 465/2021 - Biopsia indicada para estadiamento e planejamento terapeutico"</text></outputEntry>
        <outputEntry id="OE_Aprov1_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Aprov1_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <rule id="Rule_Aprovacao_ApenasSuspeitaClin">
        <description>Suspeita clinica com consentimento, aguardando confirmacao radiologica</description>
        <inputEntry id="IE_Aprov2_1"><text>true</text></inputEntry>
        <inputEntry id="IE_Aprov2_2"><text>false</text></inputEntry>
        <inputEntry id="IE_Aprov2_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Aprov2_4"><text>false</text></inputEntry>
        <inputEntry id="IE_Aprov2_5"><text>true</text></inputEntry>
        <inputEntry id="IE_Rule_Aprovacao_ApenasSuspeitaClin_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Aprov2_1"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_Aprov2_2"><text>"Suspeita clinica presente mas sem confirmacao radiologica. Solicitar imagem complementar (TC, RNM, US) antes de biopsia"</text></outputEntry>
        <outputEntry id="OE_Aprov2_3"><text>"INCA Diretrizes - Biopsia recomendada apos confirmacao por imagem"</text></outputEntry>
        <outputEntry id="OE_Aprov2_4"><text>"DOC"</text></outputEntry>
        <outputEntry id="OE_Aprov2_5"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

      <!-- FALLBACK -->
      <rule id="Rule_Fallback_31401011">
        <description>Dados incompletos - requer avaliacao medica</description>
        <inputEntry id="IE_Fallback_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_4"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_5"><text>-</text></inputEntry>
        <inputEntry id="IE_Rule_Fallback_31401011_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Fallback_1"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_Fallback_2"><text>"Dados incompletos. Requer avaliacao manual por auditor medico. Solicitar: suspeita clinica, exame imagem, coagulacao, consentimento"</text></outputEntry>
        <outputEntry id="OE_Fallback_3"><text>"Auditoria medica conforme RN 428/2017"</text></outputEntry>
        <outputEntry id="OE_Fallback_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Fallback_5"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

    </decisionTable>
  </decision>
</definitions>
