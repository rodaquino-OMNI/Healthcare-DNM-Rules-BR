<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"
             xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/"
             xmlns:dc="http://www.omg.org/spec/DD/20100524/DC/"
             xmlns:di="http://www.omg.org/spec/DD/20100524/DI/"
             id="Definitions_40501333"
             name="Quimioterapia Paliativa 3a Linha ou Mais"
             namespace="http://camunda.org/schema/1.0/dmn"
             exporter="Camunda Modeler"
             exporterVersion="5.0.0">
  <!--
    TUSS 40501333 - Quimioterapia Paliativa 3a Linha ou Mais
    Versao: 3.1.0-LEAN-TIER2 (2026-02-08)
    Especialidade: Oncologia Clinica
    Categoria: Quimioterapia Paliativa Linhas Avancadas

    Indicacoes Clinicas (DUT ANS 2024):
    - Doenca metastatica progressiva apos 2 ou mais linhas previas de tratamento
    - Performance Status ECOG 0-2 adequado para quimioterapia
    - Protocolo terapeutico CONITEC/NCCN validado para terceira linha ou superior
    - Beneficio clinico potencial documentado por oncologista especializado

    Contraindicacoes:
    - Performance Status ECOG 3-4 (contraindicacao relativa/absoluta)
    - Mais de 5 linhas previas sem biomarcador acionavel ou teste genomico
    - Ausencia de protocolo institucional aprovado para linhas avancadas
    - Progressao rapida (<2 meses) nas linhas anteriores sem mudanca de classe terapeutica

    Documentacao Obrigatoria:
    - Diagnostico confirmado (CID-10) com laudo anatomopatologico detalhado
    - Estadiamento TNM atual e documentacao de progressao pos-linhas previas
    - Avaliacao Performance Status ECOG por oncologista
    - Laudo de indicacao assinado por oncologista especialista
    - Termo de consentimento informado assinado
    - Protocolos das linhas previas e resultados de resposta terapeutica

    Referencias Normativas:
    - SBOC Diretrizes Oncologia 2024
    - NCCN Clinical Practice Guidelines in Oncology 2024
    - CONITEC Protocolos Clinicos e Diretrizes Terapeuticas Oncologia
    - ESMO Clinical Practice Guidelines 2024
  -->

  <decision id="Decision_40501333" name="Criterios de Autorizacao - Quimioterapia Paliativa 3a Linha ou Mais [LEAN TIER-2]">
    <decisionTable id="DecisionTable_40501333" hitPolicy="FIRST">

      <!-- Input 1: Diagnostico Oncologico -->
      <input id="Input_diagnosticoOncologico" label="Diagnostico Oncologico">
        <inputExpression id="InputExpr_diagnosticoOncologico" typeRef="string">
          <text>diagnosticoOncologico</text>
        </inputExpression>
        <inputValues id="InputValues_diagnosticoOncologico">
          <text>"Colorretal_Metastatico","Mama_Metastatica","Pulmao_NSCLC_IV","Pancreas_Avancado","Gastrico_Irressecavel"</text>
        </inputValues>
      </input>

      <!-- Input 2: Estadiamento TNM -->
      <input id="Input_estadiamentoTNM" label="Estadiamento TNM">
        <inputExpression id="InputExpr_estadiamentoTNM" typeRef="string">
          <text>estadiamentoTNM</text>
        </inputExpression>
        <inputValues id="InputValues_estadiamentoTNM">
          <text>"III","IV","Recidiva"</text>
        </inputValues>
      </input>

      <!-- Input 3: Performance Status ECOG -->
      <input id="Input_performanceStatusECOG" label="Performance Status ECOG">
        <inputExpression id="InputExpr_performanceStatusECOG" typeRef="string">
          <text>performanceStatusECOG</text>
        </inputExpression>
        <inputValues id="InputValues_performanceStatusECOG">
          <text>"ECOG_0","ECOG_1","ECOG_2","ECOG_3","ECOG_4"</text>
        </inputValues>
      </input>

      <!-- Input 4: Linhas Tratamento Previas -->
      <input id="Input_linhasTratamentoPrevias" label="Linhas Tratamento Previas">
        <inputExpression id="InputExpr_linhasTratamentoPrevias" typeRef="string">
          <text>linhasTratamentoPrevias</text>
        </inputExpression>
        <inputValues id="InputValues_linhasTratamentoPrevias">
          <text>"2_Linhas","3_ou_Mais"</text>
        </inputValues>
      </input>

      <!-- Input 5: Protocolo Terapeutico -->
      <input id="Input_protocoloTerapeutico" label="Protocolo Terapeutico Validado">
        <inputExpression id="InputExpr_protocoloTerapeutico" typeRef="boolean">
          <text>protocoloTerapeutico</text>
        </inputExpression>
      </input>

      <!-- Output 1: Resultado -->
      <!-- Input: Dias desde ultimo procedimento (DUP detection) -->
      <input id="Input_ultimoProcedimentoDias" label="Dias Desde Ultimo Procedimento">
        <inputExpression id="InputExpression_ultimoProcedimentoDias" typeRef="number">
          <text>ultimoProcedimentoDias</text>
        </inputExpression>
      </input>

      <output id="Output_resultado" label="Resultado" name="resultado" typeRef="string">
        <outputValues id="OutputValues_resultado">
          <text>"Aprovado","Reprovado","Pendente"</text>
        </outputValues>
      </output>

      <!-- Output 2: Observacao -->
      <output id="Output_observacao" label="Observacao Clinica" name="observacao" typeRef="string" />

      <!-- Output 3: Fundamentacao -->
      <output id="Output_fundamentacao" label="Fundamentacao Legal/Tecnica" name="fundamentacao" typeRef="string" />

      <!-- Output 4: Alertas de Desperdicio -->
      <output id="Output_alertasDesperdicio" label="Alertas de Desperdicio" name="alertasDesperdicio" typeRef="string">
        <outputValues id="OutputValues_alertasDesperdicio">
          <text>"NENHUM","DUP","FREQ","ESC","DOC","PROT","MULTI"</text>
        </outputValues>
      </output>

      <!-- Output 5: Acao Recomendada -->
      <output id="Output_acaoRecomendada" label="Acao Recomendada" name="acaoRecomendada" typeRef="string">
        <outputValues id="OutputValues_acaoRecomendada">
          <text>"APROVAR","NEGAR","SOLICITAR_INFO","AGUARDAR_PRAZO","SUGERIR_ALTERNATIVA"</text>
        </outputValues>
      </output>

      <!-- ============================================== -->
      <!-- CONTRAINDICATION RULES (FIRST PRIORITY)       -->
      <!-- ============================================== -->

      <rule id="Rule_40501333_Contraindicacao_1">
        <description>ECOG 3-4: contraindicacao quimioterapia 3a linha ou superior</description>
        <inputEntry id="IE_Contra1_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Contra1_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Contra1_3"><text>"ECOG_3","ECOG_4"</text></inputEntry>
        <inputEntry id="IE_Contra1_4"><text>"2_Linhas","3_ou_Mais"</text></inputEntry>
        <inputEntry id="IE_Contra1_5"><text>-</text></inputEntry>
        <inputEntry id="IE_Rule_40501333_Contraindicacao_1_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Contra1_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_Contra1_2"><text>"ECOG 3-4: contraindicacao quimioterapia 3a linha ou superior"</text></outputEntry>
        <outputEntry id="OE_Contra1_3"><text>"NCCN/SBOC: ECOG >=3 em 3L+ sem beneficio comprovado, risco toxicidade alta"</text></outputEntry>
        <outputEntry id="OE_Contra1_alertasDesperdicio"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_Contra1_acaoRecomendada"><text>"NEGAR"</text></outputEntry>
      </rule>

      <rule id="Rule_40501333_Contraindicacao_2">
        <description>Ausencia protocolo CONITEC/NCCN validado para 3a linha ou superior</description>
        <inputEntry id="IE_Contra2_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Contra2_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Contra2_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Contra2_4"><text>-</text></inputEntry>
        <inputEntry id="IE_Contra2_5"><text>false</text></inputEntry>
        <inputEntry id="IE_Rule_40501333_Contraindicacao_2_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Contra2_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_Contra2_2"><text>"Ausencia protocolo CONITEC/NCCN validado para 3a linha ou superior"</text></outputEntry>
        <outputEntry id="OE_Contra2_3"><text>"CONITEC: exigencia protocolo institucional aprovado para linhas avancadas"</text></outputEntry>
        <outputEntry id="OE_Contra2_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_Contra2_5"><text>"NEGAR"</text></outputEntry>
      </rule>

      <rule id="Rule_40501333_Contraindicacao_3">
        <description>Mais de 5 linhas previas sem teste genomico ou biomarcador acionavel</description>
        <inputEntry id="IE_Contra3_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Contra3_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Contra3_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Contra3_4"><text>"3_ou_Mais"</text></inputEntry>
        <inputEntry id="IE_Contra3_5"><text>-</text></inputEntry>
        <inputEntry id="IE_Rule_40501333_Contraindicacao_3_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Contra3_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_Contra3_2"><text>"Mais de 5 linhas previas sem teste genomico ou biomarcador acionavel"</text></outputEntry>
        <outputEntry id="OE_Contra3_3"><text>"ESMO/SBOC: >5L sem terapia alvo demonstra beneficio clinico limitado"</text></outputEntry>
        <outputEntry id="OE_Contra3_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_Contra3_5"><text>"NEGAR"</text></outputEntry>
      </rule>

      <!-- WASTE DETECTION: DUP -->
      <rule id="Rule_40501333_DUP">
        <description>DUP - Ciclo QT paliativa 3L+ repetido em menos de 21 dias</description>
        <inputEntry id="IE_DUP_40501333_1"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_40501333_2"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_40501333_3"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_40501333_4"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_40501333_5"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_40501333_ultimo"><text>&lt; 21</text></inputEntry>
        <outputEntry id="OE_DUP_40501333_resultado"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_DUP_40501333_observacao"><text>"Ciclo QT paliativa 3L+ repetido em menos de 21 dias"</text></outputEntry>
        <outputEntry id="OE_DUP_40501333_fundamentacao"><text>"NCCN 2024: Intervalo minimo entre ciclos QT 21 dias"</text></outputEntry>
        <outputEntry id="OE_DUP_40501333_alertasDesperdicio"><text>"DUP"</text></outputEntry>
        <outputEntry id="OE_DUP_40501333_acaoRecomendada"><text>"AGUARDAR_PRAZO"</text></outputEntry>
      </rule>

      <!-- WASTE DETECTION: FREQ -->
      <rule id="Rule_40501333_FREQ">
        <description>FREQ - Verificar limite ciclos QT paliativa 3L+ sem resposta documentada</description>
        <inputEntry id="IE_FREQ_40501333_1"><text>-</text></inputEntry>
        <inputEntry id="IE_FREQ_40501333_2"><text>-</text></inputEntry>
        <inputEntry id="IE_FREQ_40501333_3"><text>-</text></inputEntry>
        <inputEntry id="IE_FREQ_40501333_4"><text>"3_ou_Mais"</text></inputEntry>
        <inputEntry id="IE_FREQ_40501333_5"><text>-</text></inputEntry>
        <inputEntry id="IE_FREQ_40501333_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_FREQ_40501333_resultado"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_FREQ_40501333_observacao"><text>"QT paliativa 3L+: reavaliar beneficio apos 3-4 ciclos sem resposta"</text></outputEntry>
        <outputEntry id="OE_FREQ_40501333_fundamentacao"><text>"SBOC/ESMO 2024: QT paliativa linhas avancadas deve ser limitada, evitar tratamento futil"</text></outputEntry>
        <outputEntry id="OE_FREQ_40501333_alertasDesperdicio"><text>"FREQ"</text></outputEntry>
        <outputEntry id="OE_FREQ_40501333_acaoRecomendada"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

      <!-- WASTE DETECTION: DOC -->
      <rule id="Rule_40501333_DOC">
        <description>DOC - QT 3L+ sem protocolo institucional documentado</description>
        <inputEntry id="IE_DOC_40501333_1"><text>-</text></inputEntry>
        <inputEntry id="IE_DOC_40501333_2"><text>-</text></inputEntry>
        <inputEntry id="IE_DOC_40501333_3"><text>-</text></inputEntry>
        <inputEntry id="IE_DOC_40501333_4"><text>-</text></inputEntry>
        <inputEntry id="IE_DOC_40501333_5"><text>false</text></inputEntry>
        <inputEntry id="IE_DOC_40501333_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_DOC_40501333_resultado"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_DOC_40501333_observacao"><text>"QT 3L+ sem protocolo institucional CONITEC/NCCN documentado"</text></outputEntry>
        <outputEntry id="OE_DOC_40501333_fundamentacao"><text>"CONITEC 2024: QT linhas avancadas requer protocolo institucional aprovado e termo consentimento"</text></outputEntry>
        <outputEntry id="OE_DOC_40501333_alertasDesperdicio"><text>"DOC"</text></outputEntry>
        <outputEntry id="OE_DOC_40501333_acaoRecomendada"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>


      <!-- ============================================== -->
      <!-- APPROVAL RULES (AFTER CONTRAINDICATIONS)      -->
      <!-- ============================================== -->

      <rule id="Rule_40501333_Aprovacao_1">
        <description>Quimioterapia 3a linha ECOG 0-1 com protocolo validado</description>
        <inputEntry id="IE_Aprov1_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Aprov1_2"><text>"IV","Recidiva"</text></inputEntry>
        <inputEntry id="IE_Aprov1_3"><text>"ECOG_0","ECOG_1"</text></inputEntry>
        <inputEntry id="IE_Aprov1_4"><text>"2_Linhas"</text></inputEntry>
        <inputEntry id="IE_Aprov1_5"><text>true</text></inputEntry>
        <inputEntry id="IE_Rule_40501333_Aprovacao_1_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Aprov1_1"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OE_Aprov1_2"><text>"Quimioterapia 3a linha ECOG 0-1 com protocolo validado"</text></outputEntry>
        <outputEntry id="OE_Aprov1_3"><text>"NCCN: 3L recomendada ECOG 0-1, protocolos FOLFIRI/FOLFOX/paclitaxel"</text></outputEntry>
        <outputEntry id="OE_Aprov1_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Aprov1_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <rule id="Rule_40501333_Aprovacao_2">
        <description>Terapia alvo molecular pos-teste genomico (EGFR/ALK/ROS1/KRAS/BRAF/NTRK)</description>
        <inputEntry id="IE_Aprov2_1"><text>"Colorretal_Metastatico","Pulmao_NSCLC_IV"</text></inputEntry>
        <inputEntry id="IE_Aprov2_2"><text>"IV"</text></inputEntry>
        <inputEntry id="IE_Aprov2_3"><text>"ECOG_0","ECOG_1","ECOG_2"</text></inputEntry>
        <inputEntry id="IE_Aprov2_4"><text>"2_Linhas","3_ou_Mais"</text></inputEntry>
        <inputEntry id="IE_Aprov2_5"><text>true</text></inputEntry>
        <inputEntry id="IE_Rule_40501333_Aprovacao_2_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Aprov2_1"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OE_Aprov2_2"><text>"Terapia alvo molecular pos-teste genomico (EGFR/ALK/ROS1/KRAS/BRAF/NTRK)"</text></outputEntry>
        <outputEntry id="OE_Aprov2_3"><text>"SBOC/NCCN: terapia-alvo mutacoes especificas independente linha"</text></outputEntry>
        <outputEntry id="OE_Aprov2_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Aprov2_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <rule id="Rule_40501333_Aprovacao_3">
        <description>Imunoterapia MSI-H/dMMR ou TMB-H (>=10 mut/Mb) pos-2L</description>
        <inputEntry id="IE_Aprov3_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Aprov3_2"><text>"IV","Recidiva"</text></inputEntry>
        <inputEntry id="IE_Aprov3_3"><text>"ECOG_0","ECOG_1"</text></inputEntry>
        <inputEntry id="IE_Aprov3_4"><text>"2_Linhas","3_ou_Mais"</text></inputEntry>
        <inputEntry id="IE_Aprov3_5"><text>true</text></inputEntry>
        <inputEntry id="IE_Rule_40501333_Aprovacao_3_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Aprov3_1"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OE_Aprov3_2"><text>"Imunoterapia MSI-H/dMMR ou TMB-H (>=10 mut/Mb) pos-2L"</text></outputEntry>
        <outputEntry id="OE_Aprov3_3"><text>"FDA/ANVISA: pembrolizumab MSI-H agnostico tumor, nivolumab TMB-H"</text></outputEntry>
        <outputEntry id="OE_Aprov3_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Aprov3_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <!-- ============================================== -->
      <!-- FALLBACK RULE - Casos nao cobertos            -->
      <!-- ============================================== -->
      <rule id="Rule_Fallback_40501333">
        <description>Regra padrao - Casos nao cobertos requerem analise manual por auditor medico especializado</description>
        <inputEntry id="IE_Fallback_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_4"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_5"><text>-</text></inputEntry>
        <inputEntry id="IE_Rule_Fallback_40501333_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Fallback_1"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_Fallback_2"><text>"Dados incompletos para avaliacao 3a linha+"</text></outputEntry>
        <outputEntry id="OE_Fallback_3"><text>"Documentacao obrigatoria: laudo anatomopatologico, ECOG, linhas previas, protocolo institucional"</text></outputEntry>
        <outputEntry id="OE_Fallback_4"><text>"DOC"</text></outputEntry>
        <outputEntry id="OE_Fallback_5"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

    </decisionTable>
  </decision>
</definitions>
