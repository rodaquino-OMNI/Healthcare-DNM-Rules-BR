<?xml version="1.0" encoding="UTF-8"?>
<!--
  ONQ-LINE-005: Bone Marrow Transplant Eligibility
  TUSS: 40501311
  Versao: 3.1.0-LEAN-TIER2 (2026-02-08)
  Especialidade: Oncologia/Hematologia

  ============================================================================
  INDICACOES CLINICAS (Criterios CIBMTR/SBHH):
  ============================================================================
  - Idade: <65 anos preferencial; 65-75 anos com boa funcionalidade
  - Performance Status: Karnofsky >=80% ou ECOG 0-1
  - Status da doenca: Remissao completa ou doenca controlada
  - Disponibilidade de doador: HLA identico aparentado, nao-aparentado ou haploidentico

  ============================================================================
  CONTRAINDICACOES:
  ============================================================================
  - Infeccao ativa nao controlada
  - ECOG 3-4 ou Karnofsky <60%
  - Doenca em progressao refrataria
  - Disfuncao organica grave (cardiaca, hepatica, renal, pulmonar)

  ============================================================================
  DOCUMENTACAO OBRIGATORIA:
  ============================================================================
  - Laudo histopatologico/citogenetico confirmando diagnostico
  - Tipagem HLA paciente e doador
  - Avaliacao cardiologica (ecocardiograma)
  - Avaliacao pulmonar (espirometria, DLCO)
  - Provas de funcao hepatica e renal

  ============================================================================
  REFERENCIAS NORMATIVAS:
  ============================================================================
  - CIBMTR Disease Classification Manual 2024
  - EBMT Handbook 2023
  - SBHH Diretrizes de Transplante 2024
  - ANS RN 465/2021 - Rol de Procedimentos
-->
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/" xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/" xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_ONQ_LINE_005" name="DRD" namespace="http://camunda.org/schema/1.0/dmn" exporter="Camunda Modeler" exporterVersion="5.14.0" modeler:executionPlatform="Camunda Cloud" modeler:executionPlatformVersion="8.2.0">
  <decision id="Decision_ONQ_LINE_005" name="ONQ-LINE-005: Bone Marrow Transplant Eligibility [LEAN TIER-2]">
    <decisionTable id="DecisionTable_ONQ_LINE_005" hitPolicy="FIRST">
      <input id="Input_age" label="Patient Age">
        <inputExpression id="InputExpression_age" typeRef="number">
          <text>age</text>
        </inputExpression>
      </input>
      <input id="Input_karnofsky" label="Karnofsky Score">
        <inputExpression id="InputExpression_karnofsky" typeRef="number">
          <text>karnofskyScore</text>
        </inputExpression>
      </input>
      <input id="Input_disease_status" label="Disease Status">
        <inputExpression id="InputExpression_disease_status" typeRef="string">
          <text>diseaseStatus</text>
        </inputExpression>
      </input>
      <input id="Input_donor_type" label="Donor Type">
        <inputExpression id="InputExpression_donor_type" typeRef="string">
          <text>donorType</text>
        </inputExpression>
      </input>
      <input id="Input_ultimoProcedimentoDias" label="Dias Desde Ultimo Procedimento">
        <inputExpression id="InputExpression_ultimoProcedimentoDias" typeRef="number">
          <text>ultimoProcedimentoDias</text>
        </inputExpression>
      </input>
      <output id="Output_resultado" label="Resultado" name="resultado" typeRef="string">
        <outputValues id="UnaryTests_resultado">
          <text>"Aprovado","Reprovado","Pendente"</text>
        </outputValues>
      </output>
      <output id="Output_observacao" label="Observacao" name="observacao" typeRef="string" />
      <output id="Output_fundamentacao" label="Fundamentacao" name="fundamentacao" typeRef="string" />
      <!-- Output 4: Alertas de Desperdicio - Anti-Waste Intelligence -->
      <output id="Output_alertasDesperdicio" label="Alertas de Desperdicio" name="alertasDesperdicio" typeRef="string">
        <outputValues id="OutputValues_alertasDesperdicio">
          <text>"NENHUM","DUP","FREQ","ESC","DOC","PROT","MULTI"</text>
        </outputValues>
      </output>
      <!-- Output 5: Acao Recomendada -->
      <output id="Output_acaoRecomendada" label="Acao Recomendada" name="acaoRecomendada" typeRef="string">
        <outputValues id="OutputValues_acaoRecomendada">
          <text>"APROVAR","NEGAR","SOLICITAR_INFO","AGUARDAR_PRAZO","SUGERIR_ALTERNATIVA"</text>
        </outputValues>
      </output>
      <rule id="DecisionRule_reject_poor_kps">
        <description>Reject patients with poor performance status (Karnofsky less than 60%)</description>
        <inputEntry id="InputEntry_age_reject_kps">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_karnofsky_reject">
          <text>&lt; 60</text>
        </inputEntry>
        <inputEntry id="InputEntry_disease_status_reject_kps">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_donor_type_reject_kps">
          <text>-</text>
        </inputEntry>
        <inputEntry id="IE_DecisionRule_reject_poor_kps_ultimo"><text>-</text></inputEntry>
                <inputEntry id="IE_DecisionRule_reject_poor_kps_ultimo">
          <text>-</text>
        </inputEntry>
<outputEntry id="OutputEntry_resultado_reject_kps">
          <text>"Reprovado"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_observacao_reject_kps">
          <text>"Karnofsky &lt;60%: Alto risco de mortalidade relacionada ao transplante (TRM &gt;50%)"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_fundamentacao_reject_kps">
          <text>"Performance status e principal preditor de TRM; Karnofsky &lt;60% contraindica TMO per CIBMTR"</text>
        </outputEntry>
        <outputEntry id="OE_DecisionRule_reject_poor_kps_alertasDesperdicio">
          <text>"PROT"</text>
        </outputEntry>
        <outputEntry id="OE_DecisionRule_reject_poor_kps_acaoRecomendada">
          <text>"NEGAR"</text>
        </outputEntry>
      </rule>
      <rule id="Rule_40501311_ESC_escalonamento">
        <description>ESC - Escalonamento inadequado sem falha linha anterior documentada</description>
        <inputEntry id="IE_ESC_1">
          <text>-</text>
        </inputEntry>
        <inputEntry id="IE_ESC_2">
          <text>-</text>
        </inputEntry>
        <inputEntry id="IE_ESC_3">
          <text>-</text>
        </inputEntry>
        <inputEntry id="IE_ESC_4">
          <text>-</text>
        </inputEntry>
        <inputEntry id="IE_ESC_5">
          <text>-</text>
        </inputEntry>
        <inputEntry id="IE_ESC_6">
          <text>-</text>
        </inputEntry>

        <outputEntry id="OE_ESC_resultado">
          <text>"Pendente"</text>
        </outputEntry>
        <outputEntry id="OE_ESC_observacao">
          <text>"Documentar falha/intolerancia linha terapeutica anterior antes de escalonar"</text>
        </outputEntry>
        <outputEntry id="OE_ESC_fundamentacao">
          <text>"NCCN/CONITEC 2024: Step therapy obrigatoria - documentar falha antes de progredir para proxima linha"</text>
        </outputEntry>
        <outputEntry id="OE_ESC_alertasDesperdicio">
          <text>"ESC"</text>
        </outputEntry>
        <outputEntry id="OE_ESC_acaoRecomendada">
          <text>"SUGERIR_ALTERNATIVA"</text>
        </outputEntry>
      </rule>
      <rule id="DecisionRule_reject_progressive">
        <description>Reject patients with refractory progressive disease</description>
        <inputEntry id="InputEntry_age_reject_prog">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_karnofsky_reject_prog">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_disease_status_reject">
          <text>"refractory_progressive","active_infection"</text>
        </inputEntry>
        <inputEntry id="InputEntry_donor_type_reject_prog">
          <text>-</text>
        </inputEntry>
        <inputEntry id="IE_DecisionRule_reject_progressive_ultimo"><text>-</text></inputEntry>
                <inputEntry id="IE_DecisionRule_reject_progressive_ultimo">
          <text>-</text>
        </inputEntry>
<outputEntry id="OutputEntry_resultado_reject_prog">
          <text>"Reprovado"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_observacao_reject_prog">
          <text>"Doenca refrataria em progressao ou infeccao ativa: contraindicacao absoluta para TMO"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_fundamentacao_reject_prog">
          <text>"Doenca refrataria primaria tem sobrevida &lt;10% pos-TMO; infeccao ativa aumenta TRM para &gt;80%"</text>
        </outputEntry>
        <outputEntry id="OE_DecisionRule_reject_progressive_alertasDesperdicio">
          <text>"PROT"</text>
        </outputEntry>
        <outputEntry id="OE_DecisionRule_reject_progressive_acaoRecomendada">
          <text>"NEGAR"</text>
        </outputEntry>
      </rule>
      <rule id="DecisionRule_reject_elderly">
        <description>Reject patients over 75 years for allogeneic transplant</description>
        <inputEntry id="InputEntry_age_reject_elderly">
          <text>&gt; 75</text>
        </inputEntry>
        <inputEntry id="InputEntry_karnofsky_reject_elderly">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_disease_status_reject_elderly">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_donor_type_reject_elderly">
          <text>-</text>
        </inputEntry>
        <inputEntry id="IE_DecisionRule_reject_elderly_ultimo"><text>-</text></inputEntry>
                <inputEntry id="IE_DecisionRule_reject_elderly_ultimo">
          <text>-</text>
        </inputEntry>
<outputEntry id="OutputEntry_resultado_reject_elderly">
          <text>"Reprovado"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_observacao_reject_elderly">
          <text>"Idade &gt;75 anos: TMO alogenico nao indicado pela maioria dos centros"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_fundamentacao_reject_elderly">
          <text>"Dados limitados em &gt;75 anos; TRM &gt;40% mesmo com RIC; considerar terapias alternativas"</text>
        </outputEntry>
        <outputEntry id="OE_DecisionRule_reject_elderly_alertasDesperdicio">
          <text>"PROT"</text>
        </outputEntry>
        <outputEntry id="OE_DecisionRule_reject_elderly_acaoRecomendada">
          <text>"NEGAR"</text>
        </outputEntry>
      </rule>

      <!-- WASTE DETECTION: DUP -->
      <rule id="Rule_40501311_DUP">
        <description>DUP - TMO repetido em menos de 90 dias</description>
        <inputEntry id="IE_DUP_40501311_1"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_40501311_2"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_40501311_3"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_40501311_4"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_40501311_ultimo"><text>&lt; 90</text></inputEntry>
        <outputEntry id="OE_DUP_40501311_resultado"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_DUP_40501311_observacao"><text>"TMO repetido em menos de 90 dias sem justificativa"</text></outputEntry>
        <outputEntry id="OE_DUP_40501311_fundamentacao"><text>"SBTMO 2024: TMO e procedimento unico, reavaliacoes a cada 3 meses no pos-transplante"</text></outputEntry>
        <outputEntry id="OE_DUP_40501311_alertasDesperdicio"><text>"DUP"</text></outputEntry>
        <outputEntry id="OE_DUP_40501311_acaoRecomendada"><text>"AGUARDAR_PRAZO"</text></outputEntry>
      </rule>

      <!-- WASTE DETECTION: ESC -->
      <rule id="Rule_40501311_ESC">
        <description>ESC - TMO sem documentacao criterios elegibilidade e linhas previas</description>
        <inputEntry id="IE_ESC_40501311_1"><text>-</text></inputEntry>
        <inputEntry id="IE_ESC_40501311_2"><text>-</text></inputEntry>
        <inputEntry id="IE_ESC_40501311_3"><text>-</text></inputEntry>
        <inputEntry id="IE_ESC_40501311_4"><text>-</text></inputEntry>
        <inputEntry id="IE_ESC_40501311_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_ESC_40501311_resultado"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_ESC_40501311_observacao"><text>"TMO sem documentacao criterios elegibilidade e linhas previas"</text></outputEntry>
        <outputEntry id="OE_ESC_40501311_fundamentacao"><text>"SBTMO/NCCN 2024: TMO requer documentacao completa criterios elegibilidade"</text></outputEntry>
        <outputEntry id="OE_ESC_40501311_alertasDesperdicio"><text>"ESC"</text></outputEntry>
        <outputEntry id="OE_ESC_40501311_acaoRecomendada"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

      <rule id="DecisionRule_approve_standard">
        <description>Approve standard-risk transplant candidates</description>
        <inputEntry id="InputEntry_age_approve">
          <text>&lt; 65</text>
        </inputEntry>
        <inputEntry id="InputEntry_karnofsky_approve">
          <text>&gt;= 80</text>
        </inputEntry>
        <inputEntry id="InputEntry_disease_status_approve">
          <text>"complete_remission","partial_remission","stable_disease"</text>
        </inputEntry>
        <inputEntry id="InputEntry_donor_type_approve">
          <text>"matched_related","matched_unrelated"</text>
        </inputEntry>
        <inputEntry id="IE_DecisionRule_approve_standard_ultimo"><text>-</text></inputEntry>
                <inputEntry id="IE_DecisionRule_approve_standard_ultimo">
          <text>-</text>
        </inputEntry>
<outputEntry id="OutputEntry_resultado_approve">
          <text>"Aprovado"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_observacao_approve">
          <text>"Candidato elegivel para TMO: idade &lt;65, KPS &gt;=80%, doenca controlada, doador compativel"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_fundamentacao_approve">
          <text>"Criterios padrao CIBMTR atendidos; expectativa de sobrevida livre de doenca 40-70% dependendo do diagnostico conforme CIBMTR 2024"</text>
        </outputEntry>
        <outputEntry id="OE_DecisionRule_approve_standard_alertasDesperdicio">
          <text>"NENHUM"</text>
        </outputEntry>
        <outputEntry id="OE_DecisionRule_approve_standard_acaoRecomendada">
          <text>"APROVAR"</text>
        </outputEntry>
      </rule>
      <rule id="DecisionRule_approve_haplo">
        <description>Approve haploidentical transplant if no matched donor</description>
        <inputEntry id="InputEntry_age_haplo">
          <text>&lt; 65</text>
        </inputEntry>
        <inputEntry id="InputEntry_karnofsky_haplo">
          <text>&gt;= 70</text>
        </inputEntry>
        <inputEntry id="InputEntry_disease_status_haplo">
          <text>"complete_remission","partial_remission"</text>
        </inputEntry>
        <inputEntry id="InputEntry_donor_type_haplo">
          <text>"haploidentical"</text>
        </inputEntry>
        <inputEntry id="IE_DecisionRule_approve_haplo_ultimo"><text>-</text></inputEntry>
                <inputEntry id="IE_DecisionRule_approve_haplo_ultimo">
          <text>-</text>
        </inputEntry>
<outputEntry id="OutputEntry_resultado_haplo">
          <text>"Aprovado"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_observacao_haplo">
          <text>"TMO haploidentico aprovado com PTCy; alternativa viavel quando doador compativel indisponivel"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_fundamentacao_haplo">
          <text>"Haplo-PTCy mostra resultados comparaveis a MUD conforme Blood Advances 2020; NRM similar em centros experientes per SBHH 2024"</text>
        </outputEntry>
        <outputEntry id="OE_DecisionRule_approve_haplo_alertasDesperdicio">
          <text>"NENHUM"</text>
        </outputEntry>
        <outputEntry id="OE_DecisionRule_approve_haplo_acaoRecomendada">
          <text>"APROVAR"</text>
        </outputEntry>
      </rule>
      <rule id="DecisionRule_pending_elderly_fit">
        <description>Pending review for fit elderly patients (65-75 years)</description>
        <inputEntry id="InputEntry_age_pending">
          <text>[65..75]</text>
        </inputEntry>
        <inputEntry id="InputEntry_karnofsky_pending">
          <text>&gt;= 70</text>
        </inputEntry>
        <inputEntry id="InputEntry_disease_status_pending">
          <text>"complete_remission","partial_remission"</text>
        </inputEntry>
        <inputEntry id="InputEntry_donor_type_pending">
          <text>-</text>
        </inputEntry>
        <inputEntry id="IE_DecisionRule_pending_elderly_fit_ultimo"><text>-</text></inputEntry>
                <inputEntry id="IE_DecisionRule_pending_elderly_fit_ultimo">
          <text>-</text>
        </inputEntry>
<outputEntry id="OutputEntry_resultado_pending">
          <text>"Pendente"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_observacao_pending">
          <text>"Idade 65-75 com bom PS: avaliacao individualizada pelo comite de transplante"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_fundamentacao_pending">
          <text>"RIC pode ser considerado em idosos fit; HCT-CI e decisivo (score 0-2 favoravel conforme Sorror et al. 2024)"</text>
        </outputEntry>
        <outputEntry id="OE_DecisionRule_pending_elderly_fit_alertasDesperdicio">
          <text>"NENHUM"</text>
        </outputEntry>
        <outputEntry id="OE_DecisionRule_pending_elderly_fit_acaoRecomendada">
          <text>"SOLICITAR_INFO"</text>
        </outputEntry>
      </rule>
      <rule id="DecisionRule_pending_no_donor">
        <description>Pending if donor search ongoing</description>
        <inputEntry id="InputEntry_age_no_donor">
          <text>&lt; 70</text>
        </inputEntry>
        <inputEntry id="InputEntry_karnofsky_no_donor">
          <text>&gt;= 70</text>
        </inputEntry>
        <inputEntry id="InputEntry_disease_status_no_donor">
          <text>"complete_remission","partial_remission","stable_disease"</text>
        </inputEntry>
        <inputEntry id="InputEntry_donor_type_no_donor">
          <text>"searching","not_identified"</text>
        </inputEntry>
        <inputEntry id="IE_DecisionRule_pending_no_donor_ultimo"><text>-</text></inputEntry>
                <inputEntry id="IE_DecisionRule_pending_no_donor_ultimo">
          <text>-</text>
        </inputEntry>
<outputEntry id="OutputEntry_resultado_no_donor">
          <text>"Pendente"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_observacao_no_donor">
          <text>"Busca de doador em andamento; reavaliar em 30-60 dias ou considerar haplo/cordao umbilical"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_fundamentacao_no_donor">
          <text>"REDOME/NMDP busca ativa; tempo medio 2-4 meses; alternativas: haplo, duplo cordao umbilical conforme SBTMO 2024"</text>
        </outputEntry>
        <outputEntry id="OE_DecisionRule_pending_no_donor_alertasDesperdicio">
          <text>"NENHUM"</text>
        </outputEntry>
        <outputEntry id="OE_DecisionRule_pending_no_donor_acaoRecomendada">
          <text>"AGUARDAR_PRAZO"</text>
        </outputEntry>
      </rule>
      <rule id="DecisionRule_fallback">
        <description>Fallback rule for incomplete data</description>
        <inputEntry id="InputEntry_age_fallback">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_karnofsky_fallback">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_disease_status_fallback">
          <text>-</text>
        </inputEntry>
        <inputEntry id="InputEntry_donor_type_fallback">
          <text>-</text>
        </inputEntry>
        <inputEntry id="IE_DecisionRule_fallback_ultimo"><text>-</text></inputEntry>
                <inputEntry id="IE_DecisionRule_fallback_ultimo">
          <text>-</text>
        </inputEntry>
<outputEntry id="OutputEntry_resultado_fallback">
          <text>"Pendente"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_observacao_fallback">
          <text>"Dados insuficientes para avaliacao de elegibilidade para TMO"</text>
        </outputEntry>
        <outputEntry id="OutputEntry_fundamentacao_fallback">
          <text>"Encaminhar ao comite de transplante com documentacao completa: tipagem HLA, funcao organica, status doenca conforme SBTMO 2024"</text>
        </outputEntry>
        <outputEntry id="OE_DecisionRule_fallback_alertasDesperdicio">
          <text>"DOC"</text>
        </outputEntry>
        <outputEntry id="OE_DecisionRule_fallback_acaoRecomendada">
          <text>"SOLICITAR_INFO"</text>
        </outputEntry>
      </rule>
    </decisionTable>
  </decision>
  <dmndi:DMNDI>
    <dmndi:DMNDiagram>
      <dmndi:DMNShape dmnElementRef="Decision_ONQ_LINE_005">
        <dc:Bounds height="80" width="180" x="160" y="100" />
      </dmndi:DMNShape>
    </dmndi:DMNDiagram>
  </dmndi:DMNDI>
</definitions>
