<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"
             xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/"
             xmlns:dc="http://www.omg.org/spec/DD/20100524/DC/"
             xmlns:di="http://www.omg.org/spec/DD/20100524/DI/"
             id="Definitions_30801023"
             name="Imunoterapia com Checkpoint Inhibitor"
             namespace="http://camunda.org/schema/1.0/dmn"
             exporter="Camunda Modeler"
             exporterVersion="5.0.0">
  <!--
    TUSS 30801023 - Imunoterapia com Checkpoint Inhibitor (Anti-PD1/PD-L1/CTLA-4)
    Versao: 3.1.0-LEAN-TIER2 (2026-02-08)
    Especialidade: Oncologia
    Categoria: Imunoterapia Oncologica

    Indicacoes Clinicas (NCCN/ESMO 2024):
    - Melanoma avancado/metastatico (pembrolizumab, nivolumab, ipilimumab)
    - NSCLC PD-L1 positivo ou alto TMB
    - Carcinoma urotelial avancado
    - Carcinoma de celulas renais
    - Linfoma de Hodgkin refratario
    - MSI-H/dMMR tumores solidos

    Contraindicacoes:
    - Doenca autoimune ativa grave (LES, AR grave, DII ativa)
    - Transplante de orgao solido (risco de rejeicao)
    - Uso cronico de corticoides em dose imunossupressora
    - Pneumonite ou hepatite autoimune previa grave

    Documentacao Obrigatoria:
    - Diagnostico histopatologico com subtipo tumoral
    - Resultado de PD-L1 (IHC) ou MSI/dMMR quando indicado
    - Estadiamento atualizado (imagem e laboratorio)
    - Avaliacao de comorbidades autoimunes
    - Termo de consentimento informado

    Referencias Normativas:
    - NCCN Guidelines por tipo tumoral (2024)
    - ESMO Clinical Practice Guidelines (2024)
    - SBOC Diretrizes Imunoterapia (2023)
    - ANS RN 465/2021 - Rol de Procedimentos
    - DUT ANS 2024
  -->

  <decision id="Decision_30801023" name="Criterios de Autorizacao - Imunoterapia Checkpoint Inhibitor [LEAN TIER-2]">
    <decisionTable id="DecisionTable_30801023" hitPolicy="FIRST">

      <!-- Input 1: Condicao Paciente -->
      <input id="Input_condicaoPaciente" label="Condicao Clinica do Paciente">
        <inputExpression id="InputExpr_condicaoPaciente" typeRef="string">
          <text>condicaoPaciente</text>
        </inputExpression>
        <inputValues id="InputValues_condicaoPaciente">
          <text>"Melanoma PD-L1+ avancado","NSCLC PD-L1 alto (>=50%)","NSCLC PD-L1 baixo (1-49%)","CCR avancado","Urotelial avancado","MSI-H tumor solido","Doenca autoimune ativa","Transplantado","Outra"</text>
        </inputValues>
      </input>

      <!-- Input 2: Historico Clinico -->
      <input id="Input_historicoClinico" label="Historico Clinico Documentado">
        <inputExpression id="InputExpr_historicoClinico" typeRef="string">
          <text>historicoClinico</text>
        </inputExpression>
        <inputValues id="InputValues_historicoClinico">
          <text>"Adequado","Incompleto","NaoDocumentado"</text>
        </inputValues>
      </input>

      <!-- Input 3: Classe Indicacao -->
      <input id="Input_classeIndicacao" label="Classe de Indicacao (NCCN/ESMO)">
        <inputExpression id="InputExpr_classeIndicacao" typeRef="string">
          <text>classeIndicacao</text>
        </inputExpression>
        <inputValues id="InputValues_classeIndicacao">
          <text>"Categoria 1","Categoria 2A","Categoria 2B","Categoria 3"</text>
        </inputValues>
      </input>

      <!-- Input 4: Exames Comprobatorios -->
      <input id="Input_examesComprobatorios" label="Exames Comprobatorios (PD-L1/MSI)">
        <inputExpression id="InputExpr_examesComprobatorios" typeRef="string">
          <text>examesComprobatorios</text>
        </inputExpression>
        <inputValues id="InputValues_examesComprobatorios">
          <text>"PD-L1 positivo confirmado","MSI-H/dMMR confirmado","Biomarcador nao testado","Biomarcador negativo","Exames incompletos"</text>
        </inputValues>
      </input>

      <!-- Input 5: Expectativa de Vida -->
      <input id="Input_expectativaVida" label="Expectativa de Vida Superior a 1 Ano">
        <inputExpression id="InputExpr_expectativaVida" typeRef="boolean">
          <text>expectativaVidaSuperior1Ano</text>
        </inputExpression>
      </input>

      <!-- Output 1: Resultado -->
      <!-- Input: Dias desde ultimo procedimento (DUP detection) -->
      <input id="Input_ultimoProcedimentoDias" label="Dias Desde Ultimo Procedimento">
        <inputExpression id="InputExpression_ultimoProcedimentoDias" typeRef="number">
          <text>ultimoProcedimentoDias</text>
        </inputExpression>
      </input>

      <output id="Output_resultado" label="Resultado" name="resultado" typeRef="string">
        <outputValues id="OutputValues_resultado">
          <text>"Aprovado","Reprovado","Pendente"</text>
        </outputValues>
      </output>

      <!-- Output 2: Observacao -->
      <output id="Output_observacao" label="Observacao Clinica" name="observacao" typeRef="string" />

      <!-- Output 3: Fundamentacao -->
      <output id="Output_fundamentacao" label="Fundamentacao Legal/Tecnica" name="fundamentacao" typeRef="string" />

      <!-- Output 4: Alertas de Desperdicio -->
      <output id="Output_alertasDesperdicio" label="Alertas de Desperdicio" name="alertasDesperdicio" typeRef="string">
        <outputValues id="OutputValues_alertasDesperdicio"><text>"NENHUM","DUP","FREQ","ESC","DOC","PROT","MULTI"</text></outputValues>
      </output>

      <!-- Output 5: Acao Recomendada -->
      <output id="Output_acaoRecomendada" label="Acao Recomendada" name="acaoRecomendada" typeRef="string">
        <outputValues id="OutputValues_acaoRecomendada"><text>"APROVAR","NEGAR","SOLICITAR_INFO","AGUARDAR_PRAZO","SUGERIR_ALTERNATIVA"</text></outputValues>
      </output>

      <!-- REPROVACAO RULES -->
      <rule id="Rule_30801023_Reprovacao_1">
        <description>Reprovacao - Doenca autoimune ativa grave</description>
        <inputEntry id="IE_Rep1_1"><text>"Doenca autoimune ativa"</text></inputEntry>
        <inputEntry id="IE_Rep1_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep1_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep1_4"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep1_5"><text>-</text></inputEntry>
        <inputEntry id="IE_Rule_30801023_Reprovacao_1_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Rep1_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_Rep1_2"><text>"Doenca autoimune ativa grave contraindica imunoterapia. Risco elevado de exacerbacao autoimune potencialmente fatal (colite, pneumonite, hepatite)"</text></outputEntry>
        <outputEntry id="OE_Rep1_3"><text>"NCCN/ESMO 2024 - Contraindicacao relativa/absoluta conforme gravidade"</text></outputEntry>
        <outputEntry id="OE_Rep1_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_Rep1_5"><text>"NEGAR"</text></outputEntry>
      </rule>

      <rule id="Rule_30801023_Reprovacao_2">
        <description>Reprovacao - Transplantado de orgao solido</description>
        <inputEntry id="IE_Rep2_1"><text>"Transplantado"</text></inputEntry>
        <inputEntry id="IE_Rep2_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep2_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep2_4"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep2_5"><text>-</text></inputEntry>
        <inputEntry id="IE_Rule_30801023_Reprovacao_2_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Rep2_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_Rep2_2"><text>"Receptor de transplante de orgao solido. Imunoterapia pode induzir rejeicao do enxerto. Contraindicacao absoluta na maioria dos casos"</text></outputEntry>
        <outputEntry id="OE_Rep2_3"><text>"ASCO/NCCN Guidelines - Alto risco de rejeicao em transplantados"</text></outputEntry>
        <outputEntry id="OE_Rep2_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_Rep2_5"><text>"NEGAR"</text></outputEntry>
      </rule>

      <rule id="Rule_30801023_Reprovacao_3">
        <description>Reprovacao - Biomarcador negativo sem indicacao</description>
        <inputEntry id="IE_Rep3_1"><text>"NSCLC PD-L1 baixo (1-49%)"</text></inputEntry>
        <inputEntry id="IE_Rep3_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Rep3_3"><text>"Categoria 3"</text></inputEntry>
        <inputEntry id="IE_Rep3_4"><text>"Biomarcador negativo"</text></inputEntry>
        <inputEntry id="IE_Rep3_5"><text>-</text></inputEntry>
        <inputEntry id="IE_Rule_30801023_Reprovacao_3_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Rep3_1"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_Rep3_2"><text>"PD-L1 negativo/baixo sem outras indicacoes para monoterapia. Considerar quimioterapia combinada ou regimes alternativos"</text></outputEntry>
        <outputEntry id="OE_Rep3_3"><text>"KEYNOTE-042, NCCN NSCLC 2024 - Monoterapia preferencial em PD-L1 >=50%"</text></outputEntry>
        <outputEntry id="OE_Rep3_4"><text>"PROT"</text></outputEntry>
        <outputEntry id="OE_Rep3_5"><text>"NEGAR"</text></outputEntry>
      </rule>

      <!-- WASTE DETECTION: DUP -->
      <rule id="Rule_30801023_DUP">
        <description>DUP - Dose imunoterapia checkpoint repetida em menos de 14 dias</description>
        <inputEntry id="IE_DUP_30801023_1"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_30801023_2"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_30801023_3"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_30801023_4"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_30801023_5"><text>-</text></inputEntry>
        <inputEntry id="IE_DUP_30801023_ultimo"><text>&lt; 14</text></inputEntry>
        <outputEntry id="OE_DUP_30801023_resultado"><text>"Reprovado"</text></outputEntry>
        <outputEntry id="OE_DUP_30801023_observacao"><text>"Dose imunoterapia checkpoint repetida em menos de 14 dias"</text></outputEntry>
        <outputEntry id="OE_DUP_30801023_fundamentacao"><text>"NCCN 2024: Intervalo minimo entre doses imunoterapia 14-21 dias conforme protocolo"</text></outputEntry>
        <outputEntry id="OE_DUP_30801023_alertasDesperdicio"><text>"DUP"</text></outputEntry>
        <outputEntry id="OE_DUP_30801023_acaoRecomendada"><text>"AGUARDAR_PRAZO"</text></outputEntry>
      </rule>

      <!-- WASTE DETECTION: ESC -->
      <rule id="Rule_30801023_ESC">
        <description>ESC - Imunoterapia sem teste PD-L1 previo documentado</description>
        <inputEntry id="IE_ESC_30801023_1"><text>-</text></inputEntry>
        <inputEntry id="IE_ESC_30801023_2"><text>-</text></inputEntry>
        <inputEntry id="IE_ESC_30801023_3"><text>-</text></inputEntry>
        <inputEntry id="IE_ESC_30801023_4"><text>-</text></inputEntry>
        <inputEntry id="IE_ESC_30801023_5"><text>-</text></inputEntry>
        <inputEntry id="IE_ESC_30801023_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_ESC_30801023_resultado"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_ESC_30801023_observacao"><text>"Imunoterapia sem teste PD-L1 previo documentado"</text></outputEntry>
        <outputEntry id="OE_ESC_30801023_fundamentacao"><text>"NCCN 2024: PD-L1 IHC obrigatorio antes de pembrolizumab 1L NSCLC. MSI-H/dMMR dispensa PD-L1"</text></outputEntry>
        <outputEntry id="OE_ESC_30801023_alertasDesperdicio"><text>"ESC"</text></outputEntry>
        <outputEntry id="OE_ESC_30801023_acaoRecomendada"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>


      <!-- APROVACAO RULES -->
      <rule id="Rule_30801023_Aprovacao_1">
        <description>Aprovacao - Melanoma avancado PD-L1 positivo</description>
        <inputEntry id="IE_Aprov1_1"><text>"Melanoma PD-L1+ avancado"</text></inputEntry>
        <inputEntry id="IE_Aprov1_2"><text>"Adequado"</text></inputEntry>
        <inputEntry id="IE_Aprov1_3"><text>"Categoria 1"</text></inputEntry>
        <inputEntry id="IE_Aprov1_4"><text>"PD-L1 positivo confirmado"</text></inputEntry>
        <inputEntry id="IE_Aprov1_5"><text>true</text></inputEntry>
        <inputEntry id="IE_Rule_30801023_Aprovacao_1_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Aprov1_1"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OE_Aprov1_2"><text>"Melanoma avancado com indicacao Categoria 1 para imunoterapia. Pembrolizumab ou nivolumab primeira linha. Taxa de resposta 40-45%, beneficio de sobrevida comprovado"</text></outputEntry>
        <outputEntry id="OE_Aprov1_3"><text>"KEYNOTE-006, CheckMate-067, NCCN Melanoma 2024 - Categoria 1"</text></outputEntry>
        <outputEntry id="OE_Aprov1_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Aprov1_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <rule id="Rule_30801023_Aprovacao_2">
        <description>Aprovacao - NSCLC PD-L1 alto primeira linha</description>
        <inputEntry id="IE_Aprov2_1"><text>"NSCLC PD-L1 alto (>=50%)"</text></inputEntry>
        <inputEntry id="IE_Aprov2_2"><text>"Adequado"</text></inputEntry>
        <inputEntry id="IE_Aprov2_3"><text>"Categoria 1"</text></inputEntry>
        <inputEntry id="IE_Aprov2_4"><text>"PD-L1 positivo confirmado"</text></inputEntry>
        <inputEntry id="IE_Aprov2_5"><text>true</text></inputEntry>
        <inputEntry id="IE_Rule_30801023_Aprovacao_2_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Aprov2_1"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OE_Aprov2_2"><text>"NSCLC avancado PD-L1 >=50% sem EGFR/ALK. Pembrolizumab monoterapia primeira linha. Sobrevida global superior a quimioterapia"</text></outputEntry>
        <outputEntry id="OE_Aprov2_3"><text>"KEYNOTE-024, KEYNOTE-042, NCCN NSCLC 2024 - Categoria 1"</text></outputEntry>
        <outputEntry id="OE_Aprov2_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Aprov2_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <rule id="Rule_30801023_Aprovacao_3">
        <description>Aprovacao - MSI-H tumor solido agnostico</description>
        <inputEntry id="IE_Aprov3_1"><text>"MSI-H tumor solido"</text></inputEntry>
        <inputEntry id="IE_Aprov3_2"><text>"Adequado"</text></inputEntry>
        <inputEntry id="IE_Aprov3_3"><text>"Categoria 1","Categoria 2A"</text></inputEntry>
        <inputEntry id="IE_Aprov3_4"><text>"MSI-H/dMMR confirmado"</text></inputEntry>
        <inputEntry id="IE_Aprov3_5"><text>-</text></inputEntry>
        <inputEntry id="IE_Rule_30801023_Aprovacao_3_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Aprov3_1"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OE_Aprov3_2"><text>"Tumor solido MSI-H/dMMR confirmado. Indicacao agnostica para pembrolizumab/dostarlimab. Taxa de resposta 30-40%"</text></outputEntry>
        <outputEntry id="OE_Aprov3_3"><text>"FDA/ANVISA aprovacao agnostica, KEYNOTE-158, GARNET"</text></outputEntry>
        <outputEntry id="OE_Aprov3_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Aprov3_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <rule id="Rule_30801023_Aprovacao_4">
        <description>Aprovacao - CCR avancado</description>
        <inputEntry id="IE_Aprov4_1"><text>"CCR avancado"</text></inputEntry>
        <inputEntry id="IE_Aprov4_2"><text>"Adequado"</text></inputEntry>
        <inputEntry id="IE_Aprov4_3"><text>"Categoria 1","Categoria 2A"</text></inputEntry>
        <inputEntry id="IE_Aprov4_4"><text>-</text></inputEntry>
        <inputEntry id="IE_Aprov4_5"><text>true</text></inputEntry>
        <inputEntry id="IE_Rule_30801023_Aprovacao_4_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Aprov4_1"><text>"Aprovado"</text></outputEntry>
        <outputEntry id="OE_Aprov4_2"><text>"Carcinoma de celulas renais avancado. Combinacao imunoterapia + TKI ou duplo checkpoint indicada conforme risco IMDC"</text></outputEntry>
        <outputEntry id="OE_Aprov4_3"><text>"CheckMate-214, KEYNOTE-426, NCCN Kidney Cancer 2024"</text></outputEntry>
        <outputEntry id="OE_Aprov4_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Aprov4_5"><text>"APROVAR"</text></outputEntry>
      </rule>

      <!-- PENDENTE RULE -->
      <rule id="Rule_30801023_Pendente_1">
        <description>Pendente - Biomarcador nao testado</description>
        <inputEntry id="IE_Pend1_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Pend1_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Pend1_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Pend1_4"><text>"Biomarcador nao testado"</text></inputEntry>
        <inputEntry id="IE_Pend1_5"><text>-</text></inputEntry>
        <inputEntry id="IE_Rule_30801023_Pendente_1_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Pend1_1"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_Pend1_2"><text>"Biomarcador preditivo (PD-L1, MSI, TMB) nao testado. Solicitar IHC PD-L1 e/ou MSI/dMMR antes da autorizacao"</text></outputEntry>
        <outputEntry id="OE_Pend1_3"><text>"NCCN/ESMO 2024 - Biomarcador obrigatorio para selecao de tratamento"</text></outputEntry>
        <outputEntry id="OE_Pend1_4"><text>"DOC"</text></outputEntry>
        <outputEntry id="OE_Pend1_5"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

      <!-- FALLBACK -->
      <rule id="Rule_Fallback_30801023">
        <description>Regra padrao - analise manual por auditor medico</description>
        <inputEntry id="IE_Fallback_1"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_2"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_3"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_4"><text>-</text></inputEntry>
        <inputEntry id="IE_Fallback_5"><text>-</text></inputEntry>
        <inputEntry id="IE_Rule_Fallback_30801023_ultimo"><text>-</text></inputEntry>
        <outputEntry id="OE_Fallback_1"><text>"Pendente"</text></outputEntry>
        <outputEntry id="OE_Fallback_2"><text>"Caso requer analise manual por auditor medico oncologista. Documentacao de biomarcadores e estadiamento pode ser solicitada"</text></outputEntry>
        <outputEntry id="OE_Fallback_3"><text>"Auditoria medica conforme RN 428/2017 e DUT ANS 2024"</text></outputEntry>
        <outputEntry id="OE_Fallback_4"><text>"NENHUM"</text></outputEntry>
        <outputEntry id="OE_Fallback_5"><text>"SOLICITAR_INFO"</text></outputEntry>
      </rule>

    </decisionTable>
  </decision>
</definitions>
